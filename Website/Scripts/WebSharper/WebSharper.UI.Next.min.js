(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO;a=window;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Next=c.Next||{};e=d.Array=d.Array||{};f=d.String=d.String||{};g=d.Abbrev=d.Abbrev||{};h=g.Fresh=g.Fresh||{};i=g.HashSet=g.HashSet||{};j=g.Dict=g.Dict||{};k=g.Slot=g.Slot||{};l=g.Async=g.Async||{};m=g.Mailbox=g.Mailbox||{};n=a.StartupCode$WebSharper_UI_Next$Abbrev=a.StartupCode$WebSharper_UI_Next$Abbrev||{};o=d.AppendList=d.AppendList||{};p=a.StartupCode$WebSharper_UI_Next$AppendList=a.StartupCode$WebSharper_UI_Next$AppendList||{};q=d.DomUtility=d.DomUtility||{};r=a.StartupCode$WebSharper_UI_Next$DomUtility=a.StartupCode$WebSharper_UI_Next$DomUtility||{};s=d.Trie=d.Trie||{};t=s.LookupResult=s.LookupResult||{};u=a.StartupCode$WebSharper_UI_Next$Trie=a.StartupCode$WebSharper_UI_Next$Trie||{};v=d.Snap=d.Snap||{};w=d.Var=d.Var||{};x=d.Updates=d.Updates||{};y=d.View=d.View||{};z=d.ViewBuilder=d.ViewBuilder||{};A=d.Submitter=d.Submitter||{};B=d.Key=d.Key||{};C=d.Model=d.Model||{};D=d.Serializer=d.Serializer||{};E=d.Storage=d.Storage||{};F=E.ArrayStorage=E.ArrayStorage||{};G=E.LocalStorageBackend=E.LocalStorageBackend||{};H=d.ListModel=d.ListModel||{};I=d.ListModels=d.ListModels||{};J=a.StartupCode$WebSharper_UI_Next$Models=a.StartupCode$WebSharper_UI_Next$Models||{};K=d.ReactiveExtensions=d.ReactiveExtensions||{};L=d.DoubleInterpolation=d.DoubleInterpolation||{};M=d.Interpolation=d.Interpolation||{};N=d.Easing=d.Easing||{};O=d.Easings=d.Easings||{};P=d.An=d.An||{};Q=d.Anims=d.Anims||{};R=d.Trans=d.Trans||{};S=a.StartupCode$WebSharper_UI_Next$Animation=a.StartupCode$WebSharper_UI_Next$Animation||{};T=d.AnimatedAttrNode=d.AnimatedAttrNode||{};U=d.DynamicAttrNode=d.DynamicAttrNode||{};V=d.AttrProxy=d.AttrProxy||{};W=d.Client=d.Client||{};X=W.Attrs=W.Attrs||{};Y=X.Dyn=X.Dyn||{};Z=d.Attrs=d.Attrs||{};_0=d.CheckedInput=d.CheckedInput||{};_1=d.AttrModule=d.AttrModule||{};_2=a.StartupCode$WebSharper_UI_Next$Attr_Client=a.StartupCode$WebSharper_UI_Next$Attr_Client||{};_3=d.DocElemNode=d.DocElemNode||{};_4=W.Docs=W.Docs||{};_5=_4.DomNodes=_4.DomNodes||{};_6=_4.NodeSet=_4.NodeSet||{};_7=_4.RunState=_4.RunState||{};_8=d.Docs=d.Docs||{};_9=d.Doc=d.Doc||{};_=d.Elt=d.Elt||{};$=W.EltUpdater=W.EltUpdater||{};ba=a.StartupCode$WebSharper_UI_Next$Doc_Client=a.StartupCode$WebSharper_UI_Next$Doc_Client||{};bb=d.Flow=d.Flow||{};bc=d.FlowBuilder=d.FlowBuilder||{};bd=d.Html=d.Html||{};be=bd.attr=bd.attr||{};bf=d.Route=d.Route||{};bg=d.Routing=d.Routing||{};bh=bg.State=bg.State||{};bi=d.RouteMap=d.RouteMap||{};bj=d.Router=d.Router||{};bk=d.Input=d.Input||{};bl=bk.MousePosSt=bk.MousePosSt||{};bm=bk.MouseBtnSt=bk.MouseBtnSt||{};bn=bk.Mouse=bk.Mouse||{};bo=bk.KeyListenerSt=bk.KeyListenerSt||{};bp=bk.Keyboard=bk.Keyboard||{};bq=a.StartupCode$WebSharper_UI_Next$Input=a.StartupCode$WebSharper_UI_Next$Input||{};br=b&&b.List;bs=b&&b.Arrays;bt=b&&b.Enumerator;bu=b&&b.Strings;bv=b&&b.Char;bw=b&&b.Collections;bx=bw&&bw.HashSet;by=b&&b.Seq;bz=a.IntelliFactory;bA=bz&&bz.Runtime;bB=b&&b.Unchecked;bC=a.console;bD=b&&b.Concurrency;bE=bw&&bw.Map;bF=bw&&bw.FSharpMap;bG=b&&b.Operators;bH=b&&b.Queue;bI=b&&b.Lazy;bJ=bw&&bw.Dictionary;bK=a.JSON;bL=b&&b.Numeric;bM=a.Node;bN=a.jQuery;bO=b&&b.Slice;e.mapInPlace=function(bP,bQ){var bR,bS;for(bR=0,bS=bQ.length-1;bR<=bS;bR++)bQ[bR]=bP(bQ[bR]);return bQ;};e.ofSeqNonCopying=function(bP){var bQ,bR;if(bP instanceof a.Array)return bP;else if(bP instanceof br.T)return bs.ofList(bP);else if(bP===null)return[];else{bQ=[];bR=bt.Get(bP);try{while(bR.MoveNext())bQ.push(bR.Current());return bQ;}finally{if("Dispose"in bR)bR.Dispose();}}};e.MapTreeReduce=function(bP,bQ,bR,bS){var bT;function bU(bV,bW){var bX,bY;return bW<=0?bQ:bW===1&&(bV>=0&&bV<bT&&true)?bP(bs.get(bS,bV)):(bY=bW/2>>0,bR(bU(bV,bY),bU(bV+bY,bW-bY)));}bT=bs.length(bS);return bU(0,bT);};e.TreeReduce=function(bP,bQ,bR){var bS;function bT(bU,bV){var bW,bX;return bV<=0?bP:bV===1&&(bU>=0&&bU<bS&&true)?bs.get(bR,bU):(bX=bV/2>>0,bQ(bT(bU,bX),bT(bU+bX,bV-bX)));}bS=bs.length(bR);return bT(0,bS);};f.isBlank=function(bP){return bu.forall(bv.IsWhiteSpace,bP);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){n.$cctor();return n.counter;};h.set_counter=function(bP){n.$cctor();n.counter=bP;};i.Filter=function(bP,bQ){return new bx.New$2(bs.filter(bP,i.ToArray(bQ)));};i.Intersect=function(bP,bQ){var bR;bR=new bx.New$2(i.ToArray(bP));bR.IntersectWith(i.ToArray(bQ));return bR;};i.Except=function(bP,bQ){var bR;bR=new bx.New$2(i.ToArray(bQ));bR.ExceptWith(i.ToArray(bP));return bR;};i.ToArray=function(bP){var bQ;bQ=bs.create(bP.get_Count(),void 0);bP.CopyTo(bQ);return bQ;};j.ToValueArray=function(bP){var bQ;bQ=bs.create(bP.count,void 0);by.iteri(function(bR,bS){return bs.set(bQ,bR,bS.V);},bP);return bQ;};j.ToKeyArray=function(bP){var bQ;bQ=bs.create(bP.count,void 0);by.iteri(function(bR,bS){return bs.set(bQ,bR,bS.K);},bP);return bQ;};k=g.Slot=bA.Class({GetHashCode:function(){return bB.Hash(this.key(this.value));},Equals:function(bP){return bB.Equals(this.key(this.value),this.key(bP.get_Value()));},get_Value:function(){return this.value;}},b.Obj,k);k.New=bA.Ctor(function(bP,bQ){this.key=bP;this.value=bQ;},k);k.Create=function(bP,bQ){return new k.New(bP,bQ);};l.OnError=function(bP){return bC.log("WebSharper UI.Next: Uncaught asynchronous exception",bP);};l.StartTo=function(bP,bQ){bD.StartWithContinuations(bP,bQ,function(bR){l.OnError(bR);},a.ignore,null);};m.StartProcessor=function(bP){var bQ;function bR(){var bS;bS=null;return bD.Delay(function(){return bD.Bind(bP,function(){var bT;bT=bQ[0];return bT===1?(bQ[0]=0,bD.Zero()):bT===2?(bQ[0]=1,bR()):bD.Zero();});});}bQ=[0];return function(){var bS;bS=bQ[0];bS===0?(bQ[0]=1,bD.Start(bR(),null)):bS===1?bQ[0]=2:void 0;};};n.$cctor=function(){n.$cctor=a.ignore;n.counter=0;};o.FromArray=function(bP){var bQ;bQ=bP.length;return bQ===0?{$:0}:bQ===1?{$:1,$0:bs.get(bP,0)}:{$:3,$0:bP.slice()};};o.ToArray=function(bP){var bQ;function bR(bS){if(bS.$==1)bQ.push(bS.$0);else if(bS.$==2){bR(bS.$0);bR(bS.$1);}else if(bS.$==3)bs.iter(function(bT){bQ.push(bT);},bS.$0);}bQ=[];bR(bP);return bQ.slice(0);};o.Single=function(bP){return{$:1,$0:bP};};o.Concat=function(bP){var bQ;bQ=e.ofSeqNonCopying(bP);return e.TreeReduce(o.Empty(),o.Append,bQ);};o.Append=function(bP,bQ){return bP.$==0?bQ:bQ.$==0?bP:{$:2,$0:bP,$1:bQ};};o.Empty=function(){p.$cctor();return p.Empty;};p.$cctor=function(){p.$cctor=a.ignore;p.Empty={$:0};};q.SetProperty=function(bP,bQ,bR){return bP.setProperty(bQ,bR);};q.IterSelector=function(bP,bQ,bR){var bS,bT,bU;bS=bP.querySelectorAll(bQ);for(bT=0,bU=bS.length-1;bT<=bU;bT++)bR(bS[bT]);};q.ChildrenArray=function(bP){var bQ,bR,bS;bQ=[];for(bR=0,bS=bP.childNodes.length-1;bR<=bS;bR++)bQ.push(bP.childNodes[bR]);return bQ;};q.RemoveClass=function(bP,bQ){a.jQuery(bP).removeClass(bQ);};q.AddClass=function(bP,bQ){a.jQuery(bP).addClass(bQ);};q.InsertAt=function(bP,bQ,bR){var bS;if(!(bR.parentNode===bP&&bQ===(bS=bR.nextSibling,bB.Equals(bS,null)?null:bS)))bP.insertBefore(bR,bQ);};q.RemoveNode=function(bP,bQ){if(bQ.parentNode===bP)bP.removeChild(bQ);};q.SetStyle=function(bP,bQ,bR){q.SetProperty(bP.style,bQ,bR);};q.SetAttr=function(bP,bQ,bR){bP.setAttribute(bQ,bR);};q.RemoveAttr=function(bP,bQ){bP.removeAttribute(bQ);};q.CreateAttr=function(bP,bQ){var bR;bR=q.Doc().createAttribute(bP);bR.value=bQ;return bR;};q.CreateText=function(bP){return q.Doc().createTextNode(bP);};q.CreateSvgElement=function(bP){return q.Doc().createElementNS("http://www.w3.org/2000/svg",bP);};q.CreateElement=function(bP){return q.Doc().createElement(bP);};q.Clear=function(bP){while(bP.hasChildNodes())bP.removeChild(bP.firstChild);};q.ClearAttrs=function(bP){while(bP.hasAttributes())bP.removeAttributeNode(bP.attributes.item(0));};q.AppendTo=function(bP,bQ){bP.appendChild(bQ);};q.Doc=function(){r.$cctor();return r.Doc;};r.$cctor=function(){r.$cctor=a.ignore;r.Doc=a.document;};t.NotFound={$:1};s.Empty=function(){u.$cctor();return u.Empty;};s.Lookup=function(bP,bQ){return s.Look(br.ofSeq(bQ),bP);};s.Look=function(bP,bQ){var bR,bS;switch(bQ.$==2?(bR=bQ.$0,0):bQ.$==0?bP.$==1?(bR=[bP.$0,bP.$1,bQ.$0],1):2:2){case 0:return{$:0,$0:bR,$1:bP};break;case 1:bS=bE.TryFind(bR[0],bR[2]);return bS==null?t.NotFound:s.Look(bR[1],bS.$0);break;case 2:return t.NotFound;break;}};s.ToArray=function(bP){var bQ;bQ=[];s.Map(function(){return function(bR){return bQ.push(bR);};},bP);return bQ.slice(0);};s.Mapi=function(bP,bQ){var bR;function bS(){var bT;bT=bR[0];bR[0]=bT+1;return bT;}bR=[0];return s.Map(function(bT){return bP(bS(),bT);},bQ);};s.Map=function(bP,bQ){return s.MapLoop(br.T.Empty,bP,bQ);};s.MapLoop=function(bP,bQ,bR){return bR.$==1?{$:1}:bR.$==2?{$:2,$0:(bQ(bP))(bR.$0)}:s.TrieBranch(bE.Map(function(bS,bT){return s.MapLoop(br.append(bP,br.ofArray([bS])),bQ,bT);},bR.$0));};s.Merge=function(bP){var bQ,bR,bS;bQ=e.ofSeqNonCopying(bP);bR=bs.length(bQ);return bR===0?{$:1,$0:{$:1}}:bR===1?{$:1,$0:bs.get(bQ,0)}:bs.exists(s.IsLeaf,bQ)?null:(bS=s.MergeMaps(s.Merge,by.choose(function(bT){return bT.$==0?{$:1,$0:bT.$0}:null;},bQ)),bS==null?null:{$:1,$0:s.TrieBranch(bS.$0)});};s.IsLeaf=function(bP){return bP.$==2&&true;};s.MergeMaps=function(bP,bQ){var bR;function bS(bT,bU){var bV;bV=bP(bU);return bV==null?null:{$:1,$0:[bT,bV.$0]};}bR=s.AllSome(by.map(function(bT){return bS(bT[0],bT[1]);},bE.ToSeq(by.fold(function(bT,bU){return s.MultiAdd(bU[0],bU[1],bT);},new bF.New([]),by.collect(bE.ToSeq,bQ)))));return bR==null?null:{$:1,$0:bE.OfArray(bs.ofSeq(bR.$0))};};s.AllSome=function(bP){var bQ,bR,bS,bT;bR=bt.Get(bP);bS=[];bQ=true;while(bQ&&bR.MoveNext()){bT=bR.Current();bT!=null&&bT.$==1?bS.push(bT.$0):bQ=false;}return bQ?{$:1,$0:bS.slice()}:null;};s.MultiAdd=function(bP,bQ,bR){return bR.Add(bP,new br.T({$:1,$0:bQ,$1:s.MultiFind(bP,bR)}));};s.MultiFind=function(bP,bQ){var bR;bR=bE.TryFind(bP,bQ);return bR==null?br.T.Empty:bR.$0;};s.Prefix=function(bP,bQ){return s.TrieBranch(new bF.New(br.ofArray([[bP,bQ]])));};s.Leaf=function(bP){return{$:2,$0:bP};};s.TrieBranch=function(bP){return bP.get_IsEmpty()?{$:1}:{$:0,$0:bP};};u.$cctor=function(){u.$cctor=a.ignore;u.Empty={$:1};};v.Obsolete=function(bP){var bQ,bR,bS,bT,bU;bR=bP.s;if(bR==null||(bR!=null&&bR.$==2?(bQ=bR.$1,false):bR!=null&&bR.$==3?(bQ=bR.$1,false):true))void 0;else{bP.s=null;for(bS=0,bT=bs.length(bQ)-1;bS<=bT;bS++){bU=bs.get(bQ,bS);typeof bU=="object"?function(bV){v.Obsolete(bV);}(bU):bU();}}};v.New=function(bP){return{s:bP};};v.MapAsync=function(bP,bQ){var bR;bR=v.New({$:3,$0:[],$1:[]});v.When(bQ,function(bS){l.StartTo(bP(bS),function(bT){v.MarkDone(bR,bQ,bT);});},bR);return bR;};v.SnapshotOn=function(bP,bQ){var bR;function bS(bT){var bU,bV,bW;if(!(bU=bR.s,bU!=null&&bU.$==0||bU!=null&&bU.$==2&&true)){bV=v.ValueAndForever(bP);bW=v.ValueAndForever(bQ);bV!=null&&bV.$==1?bW!=null&&bW.$==1?bV.$0[1]||bW.$0[1]?v.MarkForever(bR,bW.$0[0]):v.MarkReady(bR,bW.$0[0]):void 0:void 0;}}bR=v.New({$:3,$0:[],$1:[]});v.When(bP,bS,bR);v.WhenReady(bQ,bS);return bR;};v.Map3=function(bP,bQ,bR,bS){var bT,bU,bV,bW;function bX(bY){var bZ,b0,b1,b2;if(!(bZ=bW.s,bZ!=null&&bZ.$==0||bZ!=null&&bZ.$==2&&true)){b0=v.ValueAndForever(bQ);b1=v.ValueAndForever(bR);b2=v.ValueAndForever(bS);b0!=null&&b0.$==1?b1!=null&&b1.$==1?b2!=null&&b2.$==1?b0.$0[1]&&b1.$0[1]&&b2.$0[1]?v.MarkForever(bW,bP(b0.$0[0],b1.$0[0],b2.$0[0])):v.MarkReady(bW,bP(b0.$0[0],b1.$0[0],b2.$0[0])):void 0:void 0:void 0;}}bT=bQ.s;bU=bR.s;bV=bS.s;return bT!=null&&bT.$==0?bU!=null&&bU.$==0?bV!=null&&bV.$==0?v.New({$:0,$0:bP(bT.$0,bU.$0,bV.$0)}):v.Map3Opt1(bP,bT.$0,bU.$0,bS):bV!=null&&bV.$==0?v.Map3Opt2(bP,bT.$0,bV.$0,bR):v.Map3Opt3(bP,bT.$0,bR,bS):bU!=null&&bU.$==0?bV!=null&&bV.$==0?v.Map3Opt4(bP,bU.$0,bV.$0,bQ):v.Map3Opt5(bP,bU.$0,bQ,bS):bV!=null&&bV.$==0?v.Map3Opt6(bP,bV.$0,bQ,bR):(bW=v.New({$:3,$0:[],$1:[]}),(v.When(bQ,bX,bW),v.When(bR,bX,bW),v.When(bS,bX,bW),bW));};v.Map3Opt6=function(bP,bQ,bR,bS){return v.Map2(function(bT,bU){return bP(bT,bU,bQ);},bR,bS);};v.Map3Opt5=function(bP,bQ,bR,bS){return v.Map2(function(bT,bU){return bP(bT,bQ,bU);},bR,bS);};v.Map3Opt4=function(bP,bQ,bR,bS){return v.Map(function(bT){return bP(bT,bQ,bR);},bS);};v.Map3Opt3=function(bP,bQ,bR,bS){return v.Map2(function(bT,bU){return bP(bQ,bT,bU);},bR,bS);};v.Map3Opt2=function(bP,bQ,bR,bS){return v.Map(function(bT){return bP(bQ,bT,bR);},bS);};v.Map3Opt1=function(bP,bQ,bR,bS){return v.Map(function(bT){return bP(bQ,bR,bT);},bS);};v.Map2Unit=function(bP,bQ){var bR,bS,bT;function bU(){var bV,bW,bX;if(!(bV=bT.s,bV!=null&&bV.$==0||bV!=null&&bV.$==2&&true)){bW=v.ValueAndForever(bP);bX=v.ValueAndForever(bQ);bW!=null&&bW.$==1?bX!=null&&bX.$==1?bW.$0[1]&&bX.$0[1]?v.MarkForever(bT,null):v.MarkReady(bT,null):void 0:void 0;}}bR=bP.s;bS=bQ.s;return bR!=null&&bR.$==0?bS!=null&&bS.$==0?v.New({$:0,$0:null}):bQ:bS!=null&&bS.$==0?bP:(bT=v.New({$:3,$0:[],$1:[]}),(v.When(bP,bU,bT),v.When(bQ,bU,bT),bT));};v.Map2=function(bP,bQ,bR){var bS,bT,bU;function bV(bW){var bX,bY,bZ;if(!(bX=bU.s,bX!=null&&bX.$==0||bX!=null&&bX.$==2&&true)){bY=v.ValueAndForever(bQ);bZ=v.ValueAndForever(bR);bY!=null&&bY.$==1?bZ!=null&&bZ.$==1?bY.$0[1]&&bZ.$0[1]?v.MarkForever(bU,bP(bY.$0[0],bZ.$0[0])):v.MarkReady(bU,bP(bY.$0[0],bZ.$0[0])):void 0:void 0;}}bS=bQ.s;bT=bR.s;return bS!=null&&bS.$==0?bT!=null&&bT.$==0?v.New({$:0,$0:bP(bS.$0,bT.$0)}):v.Map2Opt1(bP,bS.$0,bR):bT!=null&&bT.$==0?v.Map2Opt2(bP,bT.$0,bQ):(bU=v.New({$:3,$0:[],$1:[]}),(v.When(bQ,bV,bU),v.When(bR,bV,bU),bU));};v.Map2Opt2=function(bP,bQ,bR){return v.Map(function(bS){return bP(bS,bQ);},bR);};v.Map2Opt1=function(bP,bQ,bR){return v.Map(function(bS){return bP(bQ,bS);},bR);};v.MapCachedBy=function(bP,bQ,bR,bS){return v.Map(function(bT){var bU,bV,bW;bU=bQ[0];return bU!=null&&bU.$==1&&(bP(bT,bU.$0[0])&&(bV=[bU.$0[0],bU.$0[1]],true))?bV[1]:(bW=bR(bT),(bQ[0]={$:1,$0:[bT,bW]},bW));},bS);};v.Copy=function(bP){var bQ,bR,bS;bQ=bP.s;return bQ==null?bP:bQ!=null&&bQ.$==2?(bR=v.New({$:2,$0:bQ.$0,$1:[]}),(v.WhenObsolete(bP,bR),bR)):bQ!=null&&bQ.$==3?(bS=v.New({$:3,$0:[],$1:[]}),(v.When(bP,function(bT){v.MarkDone(bS,bP,bT);},bS),bS)):bP;};v.Map=function(bP,bQ){var bR,bS;bR=bQ.s;return bR!=null&&bR.$==0?v.New({$:0,$0:bP(bR.$0)}):(bS=v.New({$:3,$0:[],$1:[]}),(v.When(bQ,function(bT){v.MarkDone(bS,bQ,bP(bT));},bS),bS));};v.Sequence=function(bP){var bQ,bR,bS;function bT(bU){var bV;if(bS[0]===0){bV=bs.map(function(bW){var bX;bX=bW.s;return bX!=null&&bX.$==0?bX.$0:bX!=null&&bX.$==2?bX.$0:bG.FailWith("value not found by View.Sequence");},bQ);bs.forall(function(bW){var bX;return(bX=bW.s,bX!=null&&bX.$==0)&&true;},bQ)?v.MarkForever(bR,bV):v.MarkReady(bR,bV);}else bS[0]--;}bQ=bs.ofSeq(bP);return bQ.length==0?v.New({$:0,$0:[]}):(bR=v.New({$:3,$0:[],$1:[]}),(bS=[bs.length(bQ)-1],(bs.iter(function(bU){v.When(bU,bT,bR);},bQ),bR)));};v.CreateForeverAsync=function(bP){var bQ;bQ=v.New({$:3,$0:[],$1:[]});l.StartTo(bP,function(bR){v.MarkForever(bQ,bR);});return bQ;};v.JoinInner=function(bP){var bQ;bQ=v.New({$:3,$0:[],$1:[]});v.When(bP,function(bR){var bS;bS=bR();v.When(bS,function(bT){var bU,bV;if((bU=bS.s,bU!=null&&bU.$==0)&&true&&((bV=bP.s,bV!=null&&bV.$==0)&&true))v.MarkForever(bQ,bT);else v.MarkReady(bQ,bT);},bQ);v.WhenObsolete(bP,bS);},bQ);return bQ;};v.Join=function(bP){var bQ;bQ=v.New({$:3,$0:[],$1:[]});v.When(bP,function(bR){var bS;bS=bR();v.When(bS,function(bT){var bU,bV;if((bU=bS.s,bU!=null&&bU.$==0)&&true&&((bV=bP.s,bV!=null&&bV.$==0)&&true))v.MarkForever(bQ,bT);else v.MarkReady(bQ,bT);},bQ);},bQ);return bQ;};v.ValueAndForever=function(bP){var bQ;bQ=bP.s;return bQ!=null&&bQ.$==0?{$:1,$0:[bQ.$0,true]}:bQ!=null&&bQ.$==2?{$:1,$0:[bQ.$0,false]}:null;};v.WhenObsoleteRun=function(bP,bQ){var bR;bR=bP.s;bR==null?bQ():bR!=null&&bR.$==2?bR.$1.push(bQ):bR!=null&&bR.$==3?bR.$1.push(bQ):void 0;};v.WhenObsolete=function(bP,bQ){var bR;bR=bP.s;bR==null?v.Obsolete(bQ):bR!=null&&bR.$==2?v.EnqueueSafe(bR.$1,bQ):bR!=null&&bR.$==3?v.EnqueueSafe(bR.$1,bQ):void 0;};v.WhenReady=function(bP,bQ){var bR,bS;bS=bP.s;switch(bS!=null&&bS.$==2?(bR=bS.$0,0):bS==null?1:bS!=null&&bS.$==3?2:(bR=bS.$0,0)){case 0:bQ(bR);break;case 1:null;break;case 2:bS.$0.push(bQ);break;}};v.WhenRun=function(bP,bQ,bR){var bS;bS=bP.s;bS==null?bR():bS!=null&&bS.$==2?(bS.$1.push(bR),bQ(bS.$0)):bS!=null&&bS.$==3?(bS.$0.push(bQ),bS.$1.push(bR)):bQ(bS.$0);};v.When=function(bP,bQ,bR){var bS;bS=bP.s;bS==null?v.Obsolete(bR):bS!=null&&bS.$==2?(v.EnqueueSafe(bS.$1,bR),bQ(bS.$0)):bS!=null&&bS.$==3?(bS.$0.push(bQ),v.EnqueueSafe(bS.$1,bR)):bQ(bS.$0);};v.EnqueueSafe=function(bP,bQ){var bR,bS,bT,bU;bP.push(bQ);if(bP.length%20===0){bR=bP.slice(0);bH.Clear(bP);for(bS=0,bT=bs.length(bR)-1;bS<=bT;bS++){bU=bs.get(bR,bS);typeof bU=="object"?function(bV){if(bV.s)bP.push(bV);}(bU):function(bV){bP.push(bV);}(bU);}}else void 0;};v.MarkDone=function(bP,bQ,bR){var bS;if((bS=bQ.s,bS!=null&&bS.$==0)&&true)v.MarkForever(bP,bR);else v.MarkReady(bP,bR);};v.MarkReady=function(bP,bQ){var bR,bS,bT,bU;bR=bP.s;if(bR!=null&&bR.$==3){bP.s={$:2,$0:bQ,$1:bR.$1};bS=bR.$0;for(bT=0,bU=bs.length(bS)-1;bT<=bU;bT++)(bs.get(bS,bT))(bQ);}else void 0;};v.MarkForever=function(bP,bQ){var bR,bS,bT,bU;bR=bP.s;if(bR!=null&&bR.$==3){bP.s={$:0,$0:bQ};bS=bR.$0;for(bT=0,bU=bs.length(bS)-1;bT<=bU;bT++)(bs.get(bS,bT))(bQ);}else void 0;};w=d.Var=bA.Class({RId:function(){return"uinref"+a.String(this.i);},RView:function(){return this.v;},RUpdM:function(bP){var bQ;bQ=bP(this.c);bQ!=null&&bQ.$==1?w.Set(this,bQ.$0):void 0;},RUpd:function(bP){w.Update(this,bP);},set_RVal:function(bP){w.Set(this,bP);},RVal:function(){return this.c;},RSet:function(bP){w.Set(this,bP);},RGet:function(){return this.c;}},null,w);w.New=function(bP,bQ,bR,bS,bT){return new w({o:bP,c:bQ,s:bR,i:bS,v:bT});};w.Lens=function(bP,bQ,bR){var bS,bT;bS=h.Id();bT=y.Map(bQ,bP.RView());return{RGet:function(){return bQ(bP.RGet());},RSet:function(bU){return bP.RUpd(function(bV){return bR(bV,bU);});},RVal:function(){return bQ(bP.RGet());},set_RVal:function(bU){return bP.RUpd(function(bV){return bR(bV,bU);});},RUpd:function(bU){return bP.RUpd(function(bV){return bR(bV,bU(bQ(bV)));});},RUpdM:function(bU){return bP.RUpdM(function(bV){var bW;bW=bU(bQ(bV));return bW==null?null:{$:1,$0:bR(bV,bW.$0)};});},RView:function(){return bT;},RId:function(){return bS;}};};w.Update=function(bP,bQ){w.Set(bP,bQ(bP.c));};w.SetFinal=function(bP,bQ){if(bP.o)(function(bR){return bR("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bR){bC.log(bR);}));else{v.Obsolete(bP.s);bP.o=true;bP.c=bQ;bP.s=v.New({$:0,$0:bQ});}};w.Set=function(bP,bQ){if(bP.o)(function(bR){return bR("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bR){bC.log(bR);}));else{v.Obsolete(bP.s);bP.c=bQ;bP.s=v.New({$:2,$0:bQ,$1:[]});}};w.CreateWaiting=function(){var bP;bP=null;bP=w.New(false,null,v.New({$:3,$0:[],$1:[]}),h.Int(),function(){return bP.s;});return bP;};w.Create=function(){var bP;bP=null;bP=w.New(false,null,v.New({$:2,$0:null,$1:[]}),h.Int(),function(){return bP.s;});return bP;};w.CreateLogged=function(bP,bQ){var bR;!window.UINVars?window.UINVars=[]:void 0;bR=w.Create$1(bQ);window.UINVars.push([bP,bR]);return bR;};w.Create$1=function(bP){var bQ;bQ=null;bQ=w.New(false,bP,v.New({$:2,$0:bP,$1:[]}),h.Int(),function(){return bQ.s;});return bQ;};x=d.Updates=bA.Class({set_Value:function(bP){var bQ;bQ=this.s;!(bQ===null)?v.Obsolete(bQ):void 0;this.c=bP;}},null,x);x.Create=function(bP){var bQ;bQ=null;bQ=x.New(bP,null,function(){var bR;bR=bQ.s;return bR===null?(bR=v.Copy(bQ.c()),bQ.s=bR,v.WhenObsoleteRun(bR,function(){bQ.s=null;}),bR):bR;});return bQ;};x.New=function(bP,bQ,bR){return new x({c:bP,s:bQ,v:bR});};y.get_Do=function(){return z.B;};y.Apply=function(bP,bQ){return y.Map2(function(bR,bS){return bR(bS);},bP,bQ);};y.AsyncAwait=function(bP,bQ){function bR(bS){var bT,bU;function bV(){return y.RemovableSink(function(bW){if(bP(bW)){(bI.Force(bT))();bS(bW);}},bQ);}bT=bI.Create(bV);bU=bI.Force(bT);}return bD.FromContinuations(function(bS,bT,bU){return bR.apply(null,[bS,bT,bU]);});};y.RemovableSink=function(bP,bQ){var bR;function bS(){v.WhenRun(bQ(),function(bT){if(bR[0])bP(bT);},function(){if(bR[0])bD.scheduler().Fork(bS);});}bR=[true];bD.scheduler().Fork(bS);return function(){bR[0]=false;};};y.Sink=function(bP,bQ){function bR(){v.WhenRun(bQ(),bP,function(){bD.scheduler().Fork(bR);});}bD.scheduler().Fork(bR);};y.TryFinally=function(bP,bQ){return y.CreateLazy(function(){try{return bQ();}finally{bP();}});};y.TryWith=function(bP,bQ){return y.CreateLazy(function(){try{return bQ();}catch(bR){return(bP(bR))();}});};y.ConstAsync=function(bP){var bQ;bQ=v.CreateForeverAsync(bP);return function(){return bQ;};};y.Const=function(bP){var bQ;bQ=v.New({$:0,$0:bP});return function(){return bQ;};};y.Sequence=function(bP){return y.CreateLazy(function(){return v.Sequence(by.map(function(bQ){return bQ();},bP));});};y.UpdateWhile=function(bP,bQ,bR){var bS;bS=[bP];return y.BindInner(function(bT){return bT?y.Map(function(bU){bS[0]=bU;return bU;},bR):y.Const(bS[0]);},bQ);};y.BindInner=function(bP,bQ){return y.JoinInner(y.Map(bP,bQ));};y.JoinInner=function(bP){return y.CreateLazy(function(){return v.JoinInner(bP());});};y.Bind=function(bP,bQ){return y.Join(y.Map(bP,bQ));};y.Join=function(bP){return y.CreateLazy(function(){return v.Join(bP());});};y.MapSeqCachedView=function(bP,bQ){function bR(bS){return bP;}return y.MapSeqCachedViewBy(a.id,function(bS,bT){return(bR(bS))(bT);},bQ);};y.MapSeqCachedViewBy=function(bP,bQ,bR){var bS;bS=[new bJ.New$5()];return y.Map(function(bT){var bU,bV,bW;bU=bS[0];bV=new bJ.New$5();bW=e.mapInPlace(function(bX){var bY,bZ,b0;bY=bP(bX);bZ=bU.ContainsKey(bY)?(b0=bU.get_Item(bY),(w.Set(b0.r,bX),b0)):y.ConvertSeqNode(function(b1){return bQ(bY,b1);},bX);bV.set_Item(bY,bZ);return bZ.e;},bs.ofSeq(bT));bS[0]=bV;return bW;},bR);};y.ConvertSeqNode=function(bP,bQ){var bR,bS;bR=w.Create$1(bQ);bS=bR.v;return{e:bP(bS),r:bR,w:bS};};y.MapSeqCached=function(bP,bQ){return y.MapSeqCachedBy(a.id,bP,bQ);};y.MapSeqCachedBy=function(bP,bQ,bR){var bS;bS=[new bJ.New$5()];return y.Map(function(bT){var bU,bV,bW;bU=bS[0];bV=new bJ.New$5();bW=e.mapInPlace(function(bX){var bY,bZ;bY=bP(bX);bZ=bU.ContainsKey(bY)?bU.get_Item(bY):bQ(bX);bV.set_Item(bY,bZ);return bZ;},bs.ofSeq(bT));bS[0]=bV;return bW;},bR);};y.SnapshotOn=function(bP,bQ,bR){var bS;bS=v.New({$:2,$0:bP,$1:[]});return y.CreateLazy(function(){return bS.s==null&&true?v.SnapshotOn(bQ(),bR()):(v.WhenObsolete(bQ(),bS),bS);});};y.GetAsync=function(bP){return bD.FromContinuations(function(bQ){return y.Get(bQ,bP);});};y.Get=function(bP,bQ){var bR;function bS(){v.WhenRun(bQ(),function(bT){if(!bR[0]){bR[0]=true;bP(bT);}},function(){if(!bR[0])bS();});}bR=[false];bS();};y.MapAsync2=function(bP,bQ,bR){return y.MapAsync(a.id,y.Map2(bP,bQ,bR));};y.MapAsync=function(bP,bQ){return y.CreateLazy(function(){return v.MapAsync(bP,bQ());});};y.Map3=function(bP,bQ,bR,bS){return y.CreateLazy(function(){return v.Map3(bP,bQ(),bR(),bS());});};y.Map2Unit=function(bP,bQ){return y.CreateLazy(function(){return v.Map2Unit(bP(),bQ());});};y.Map2=function(bP,bQ,bR){return y.CreateLazy(function(){return v.Map2(bP,bQ(),bR());});};y.MapCached=function(bP,bQ){return y.MapCachedBy(bB.Equals,bP,bQ);};y.MapCachedBy=function(bP,bQ,bR){var bS;bS=[null];return y.CreateLazy(function(){return v.MapCachedBy(bP,bS,bQ,bR());});};y.Map=function(bP,bQ){return y.CreateLazy(function(){return v.Map(bP,bQ());});};y.CreateLazy=function(bP){var bQ;bQ={c:null,o:bP};return function(){var bR,bS;bR=bQ.c;return bR===null?(bR=bQ.o(),bQ.c=bR,(bS=bR.s,bS!=null&&bS.$==0)&&true?bQ.o=null:v.WhenObsoleteRun(bR,function(){bQ.c=null;}),bR):bR;};};z.B={$:0};A=d.Submitter=bA.Class({Trigger:function(){w.Set(this["var"],null);}},b.Obj,A);A.New=bA.Ctor(function(bP,bQ){this.input=bP;this["var"]=w.Create();this.view=y.SnapshotOn(bQ,this["var"].v,this.input);},A);A.CreateOption=function(bP){return new A.New(y.Map(function(bQ){return{$:1,$0:bQ};},bP),null);};B.Fresh=function(){return{$:0,$0:h.Int()};};C=d.Model=bA.Class({},b.Obj,C);C.New=bA.Ctor(function(bP,bQ){var bR;bR=w.Create$1(bQ);C.New$1.call(this,bR,y.Map(bP,bR.v));},C);C.New$1=bA.Ctor(function(bP,bQ){this["var"]=bP;this.view=bQ;},C);C.Update=function(bP,bQ){w.Update(bQ["var"],function(bR){bP(bR);return bR;});};C.Create=function(bP,bQ){return new C.New(bP,bQ);};D.Default=function(){J.$cctor();return J.Default;};F=E.ArrayStorage=bA.Class({SSet:function(bP){return bs.ofSeq(bP);},SSetAt:function(bP,bQ,bR){bs.set(bR,bP,bQ);return bR;},SRemoveIf:function(bP,bQ){return bs.filter(function(bR){return!bP(bR);},bQ);},SInit:function(){return this.init;},SPrependMany:function(bP,bQ){var bR;bR=e.ofSeqNonCopying(bP);bQ.unshift.apply(bQ,bR);return bQ;},SPrepend:function(bP,bQ){bQ.unshift(bP);return bQ;},SAppendMany:function(bP,bQ){var bR;bR=e.ofSeqNonCopying(bP);bQ.push.apply(bQ,bR);return bQ;},SAppend:function(bP,bQ){bQ.push(bP);return bQ;}},b.Obj,F);F.New=bA.Ctor(function(bP){this.init=bP;},F);G=E.LocalStorageBackend=bA.Class({clear:function(){this.storage.removeItem(this.id);},set:function(bP){this.storage.setItem(this.id,bK.stringify(bs.map(this.serializer.Encode,bP)));return bP;},SSet:function(bP){return this.set(bs.ofSeq(bP));},SSetAt:function(bP,bQ,bR){bs.set(bR,bP,bQ);return this.set(bR);},SRemoveIf:function(bP,bQ){return this.set(bs.filter(function(bR){return!bP(bR);},bQ));},SInit:function(){var bP;bP=this.storage.getItem(this.id);if(bP===null)return[];else try{return bs.map(this.serializer.Decode,bK.parse(bP));}catch(bQ){return[];}},SPrependMany:function(bP,bQ){var bR;bR=e.ofSeqNonCopying(bP);bQ.unshift.apply(bQ,bR);return this.set(bQ);},SPrepend:function(bP,bQ){bQ.unshift(bP);return this.set(bQ);},SAppendMany:function(bP,bQ){var bR;bR=e.ofSeqNonCopying(bP);bQ.push.apply(bQ,bR);return this.set(bQ);},SAppend:function(bP,bQ){bQ.push(bP);return this.set(bQ);}},b.Obj,G);G.New=bA.Ctor(function(bP,bQ){this.id=bP;this.serializer=bQ;this.storage=a.localStorage;},G);E.LocalStorage=function(bP,bQ){return new G.New(bP,bQ);};E.InMemory=function(bP){return new F.New(bP);};H=d.ListModel=bA.Class({Wrap:function(bP,bQ,bR){return H.Wrap(this,bP,bQ,bR);},Lens:function(bP){return this.LensInto(a.id,function(bQ,bR){return bR;},bP);},LensInto:function(bP,bQ,bR){var bS,bT,bU;bS=this;bT=h.Id();bU=y.Map(bP,this.FindByKeyAsView(bR));return{RGet:function(){return bP(bS.FindByKey(bR));},RSet:function(bV){return bS.UpdateBy(function(bW){return{$:1,$0:bQ(bW,bV)};},bR);},RVal:function(){return this.RGet();},set_RVal:function(bV){return this.RSet(bV);},RUpd:function(bV){return bS.UpdateBy(function(bW){return{$:1,$0:bQ(bW,bV(bP(bW)))};},bR);},RUpdM:function(bV){return bS.UpdateBy(function(bW){var bX;bX=bV(bP(bW));return bX==null?null:{$:1,$0:bQ(bW,bX.$0)};},bR);},RView:function(){return bU;},RId:function(){return bT;}};},get_LengthAsView:function(){return y.Map(bs.length,this["var"].RView());},get_Length:function(){return bs.length(this["var"].RVal());},Clear:function(){this["var"].set_RVal(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(bP,bQ){var bR,bS,bT,bU,bV;bR=this;bS=this["var"].RVal();bT=bs.tryFindIndex(function(bW){return bB.Equals(bR.key(bW),bQ);},bS);bT!=null&&bT.$==1?(bU=bT.$0,bV=bP(bs.get(bS,bU)),bV!=null&&bV.$==1?(this["var"].set_RVal(this.storage.SSetAt(bU,bV.$0,bS)),this.ObsoleteKey(bQ)):void 0):void 0;},UpdateAll:function(bP){var bQ;bQ=this;this["var"].RUpd(function(bR){bs.iteri(function(bS,bT){var bU;bU=bP(bT);return bU==null?null:bs.set(bR,bS,bU.$0);},bR);return bQ.storage.SSet(bR);});this.ObsoleteAll();},FindByKeyAsView:function(bP){return y.Map(function(bQ){return bQ.$0;},this.TryFindByKeyAsView(bP));},TryFindByKeyAsView:function(bP){var bQ;bQ=this;return function(){var bR,bS,bT;bR=(bS=null,[bQ.it.TryGetValue(bP,{get:function(){return bS;},set:function(bU){bS=bU;}}),bS]);return bR[0]?bR[1]:(bT=v.New({$:2,$0:bQ.TryFindByKey(bP),$1:[]}),(bQ.it.Add(bP,bT),bT));};},TryFindByKey:function(bP){var bQ;bQ=this;return bs.tryFind(function(bR){return bB.Equals(bQ.key(bR),bP);},this["var"].RVal());},FindByKey:function(bP){var bQ;bQ=this;return bs.find(function(bR){return bB.Equals(bQ.key(bR),bP);},this["var"].RVal());},TryFindAsView:function(bP){return y.Map(function(bQ){return bs.tryFind(bP,bQ);},this["var"].RView());},FindAsView:function(bP){return y.Map(function(bQ){return bs.find(bP,bQ);},this["var"].RView());},TryFind:function(bP){return bs.tryFind(bP,this["var"].RVal());},Find:function(bP){return bs.find(bP,this["var"].RVal());},ContainsKeyAsView:function(bP){var bQ;function bR(bS){return bB.Equals(bQ.key(bS),bP);}bQ=this;return y.Map(function(bS){return bs.exists(bR,bS);},this["var"].RView());},ContainsKey:function(bP){var bQ;bQ=this;return bs.exists(function(bR){return bB.Equals(bQ.key(bR),bP);},this["var"].RVal());},Set:function(bP){this["var"].set_RVal(this.storage.SSet(bP));this.ObsoleteAll();},Iter:function(bP){bs.iter(bP,this["var"].RVal());},RemoveByKey:function(bP){var bQ;bQ=this;this["var"].set_RVal(this.storage.SRemoveIf(function(bR){return bB.Equals(bQ.key(bR),bP);},this["var"].RVal()));this.ObsoleteKey(bP);},RemoveBy:function(bP){var bQ,bR,bS,bT;bQ=this["var"].RVal();for(bR=0,bS=bQ.length-1;bR<=bS;bR++){bT=bs.get(bQ,bR);bP(bT)?this.ObsoleteKey(this.key(bT)):void 0;}this["var"].set_RVal(this.storage.SRemoveIf(bP,this["var"].RVal()));},Remove:function(bP){var bQ,bR,bS,bT;bQ=this;bR=this["var"].RVal();I.Contains(bQ.key,bP,bR)?(bS=bQ.key,bT=bS(bP),this["var"].set_RVal(this.storage.SRemoveIf(function(bU){return bB.Equals(bS(bU),bT);},bR)),this.ObsoleteKey(bT)):void 0;},PrependMany:function(bP){var bQ,bR;function bS(bT,bU){var bV,bW;bV=bQ.key(bU);bQ.ObsoleteKey(bV);bW=bs.tryFindIndex(function(bX){return bB.Equals(bQ.key(bX),bV);},bT);return bW==null?(bR.push(bU),bT):bQ.storage.SSetAt(bW.$0,bU,bT);}bQ=this;bR=[];this["var"].set_RVal(this.storage.SPrependMany(bR,(((bA.Curried3(by.fold))(bS))(this["var"].RVal()))(bP)));},Prepend:function(bP){var bQ,bR,bS,bT;bQ=this;bR=this["var"].RVal();bS=this.key(bP);bT=bs.tryFindIndex(function(bU){return bB.Equals(bQ.key(bU),bS);},bR);bT!=null&&bT.$==1?this["var"].set_RVal(this.storage.SSetAt(bT.$0,bP,bR)):this["var"].set_RVal(this.storage.SPrepend(bP,bR));this.ObsoleteKey(bS);},AppendMany:function(bP){var bQ,bR;function bS(bT,bU){var bV,bW;bV=bQ.key(bU);bQ.ObsoleteKey(bV);bW=bs.tryFindIndex(function(bX){return bB.Equals(bQ.key(bX),bV);},bT);return bW==null?(bR.push(bU),bT):bQ.storage.SSetAt(bW.$0,bU,bT);}bQ=this;bR=[];this["var"].set_RVal(this.storage.SAppendMany(bR,(((bA.Curried3(by.fold))(bS))(this["var"].RVal()))(bP)));},Append:function(bP){var bQ,bR,bS,bT;bQ=this;bR=this["var"].RVal();bS=this.key(bP);bT=bs.tryFindIndex(function(bU){return bB.Equals(bQ.key(bU),bS);},bR);bT!=null&&bT.$==1?this["var"].set_RVal(this.storage.SSetAt(bT.$0,bP,bR)):this["var"].set_RVal(this.storage.SAppend(bP,bR));this.ObsoleteKey(bS);},ObsoleteAll:function(){by.iter(function(bP){v.Obsolete(bP.V);},this.it);this.it.Clear();},ObsoleteKey:function(bP){var bQ,bR;bQ=(bR=null,[this.it.TryGetValue(bP,{get:function(){return bR;},set:function(bS){bR=bS;}}),bR]);bQ[0]?(v.Obsolete(bQ[1]),this.it.Remove(bP)):void 0;},GetEnumerator0:function(){return bt.Get0(this["var"].RVal());},GetEnumerator:function(){return bt.Get(this["var"].RVal());}},b.Obj,H);H.New=bA.Ctor(function(bP,bQ){H.New$3.call(this,bP,w.Create$1(bs.ofSeq(by.distinctBy(bP,bQ.SInit()))),bQ);},H);H.New$1=bA.Ctor(function(bP){H.New$2.call(this,bP,[]);},H);H.New$2=bA.Ctor(function(bP,bQ){var bR;bR=bs.ofSeq(bQ);H.New$3.call(this,bP,w.Create$1(bR),E.InMemory(bR));},H);H.New$3=bA.Ctor(function(bP,bQ,bR){this.key=bP;this["var"]=bQ;this.storage=bR;this.v=y.Map(function(bS){return bS.slice();},this["var"].RView());this.it=new bJ.New$5();},H);I.Contains=function(bP,bQ,bR){var bS;bS=bP(bQ);return bs.exists(function(bT){return bB.Equals(bP(bT),bS);},bR);};H.Wrap=function(bP,bQ,bR,bS){var bT,bU;bT=[new bJ.New$5()];bU=bs.map(function(bV){var bW;bW=bR(bV);bT[0].set_Item(bP.key(bV),bW);return bW;},bP["var"].RVal());return new H.New$3(function(bV){return bP.key(bQ(bV));},w.Lens(bP["var"],function(bV){var bW,bX;bW=new bJ.New$5();bX=bs.map(function(bY){var bZ,b0;bZ=bP.key(bY);b0=bT[0].ContainsKey(bZ)?bS(bT[0].get_Item(bZ),bY):bR(bY);bW.set_Item(bZ,b0);return b0;},bV);bT[0]=bW;return bX;},function(bV,bW){var bX,bY;bX=new bJ.New$5();bY=bs.map(function(bZ){var b0;b0=bQ(bZ);bX.set_Item(bP.key(b0),bZ);return b0;},bW);bT[0]=bX;return bY;}),E.InMemory(bU));};H.FromSeq=function(bP){return H.Create(a.id,bP);};H.Create=function(bP,bQ){return H.CreateWithStorage(bP,E.InMemory(bs.ofSeq(bQ)));};H.CreateWithStorage=function(bP,bQ){return new H.New(bP,bQ);};J.$cctor=function(){J.$cctor=a.ignore;J.Default={Encode:a.id,Decode:a.id};};K=d.ReactiveExtensions=bA.Class({},b.Obj,K);K.New=bA.Ctor(function(){},K);L=d.DoubleInterpolation=bA.Class({Interpolate:function(bP,bQ,bR){return bQ+bP*(bR-bQ);}},null,L);L.DoubleInterpolation=new L({$:0});M.get_Double=function(){return L.DoubleInterpolation;};N=d.Easing=bA.Class({TransformTime:function(bP){return this.transformTime(bP);}},b.Obj,N);N.get_CubicInOut=function(){return O.CubicInOut();};N.Custom=function(bP){return new N.New(bP);};N.New=bA.Ctor(function(bP){this.transformTime=bP;},N);O.CubicInOut=function(){S.$cctor();return S.CubicInOut;};P.get_Empty=function(){return{$:0,$0:o.Empty()};};P.WhenDone=function(bP,bQ){return P.Append({$:0,$0:o.Single({$:0,$0:bP})},bQ);};P.Run=function(bP,bQ){var bR;function bS(bT){function bU(bV,bW){var bX;bX=bW-bV;bQ.Compute(bX);bP();return bX<=bR?void a.requestAnimationFrame(function(bY){bU(bV,bY);}):bT();}a.requestAnimationFrame(function(bV){bU(bV,bV);});}bR=bQ.Duration;return bR===0?bD.Zero():bD.FromContinuations(function(bT,bU,bV){return bS.apply(null,[bT,bU,bV]);});};P.Play=function(bP){var bQ;bQ=null;return bD.Delay(function(){return bD.Bind(P.Run(a.ignore,Q.Actions(bP)),function(){Q.Finalize(bP);return bD.Return(null);});});};P.Pack=function(bP){return{$:0,$0:o.Single({$:1,$0:bP})};};P.Map=function(bP,bQ){var bR;return Q.Def(bQ.Duration,(bR=bQ.Compute,function(bS){return bP(bR(bS));}));};P.Delayed=function(bP,bQ,bR,bS,bT,bU){return{Compute:function(bV){return bV<=bS?bT:bP.Interpolate(bQ.TransformTime((bV-bS)/bR),bT,bU);},Duration:bR+bS};};P.Simple=function(bP,bQ,bR,bS,bT){return{Compute:function(bU){return bP.Interpolate(bQ.TransformTime(bU/bR),bS,bT);},Duration:bR};};P.Const=function(bP){return Q.Const(bP);};P.Concat=function(bP){return{$:0,$0:o.Concat(by.map(Q.List,bP))};};P.Append=function(bP,bQ){return{$:0,$0:o.Append(bP.$0,bQ.$0)};};P.set_UseAnimations=function(bP){Q.set_UseAnimations(bP);};P.get_UseAnimations=function(){return Q.UseAnimations();};Q.UseAnimations=function(){S.$cctor();return S.UseAnimations;};Q.set_UseAnimations=function(bP){S.$cctor();S.UseAnimations=bP;};Q.Actions=function(bP){return Q.ConcatActions(bs.choose(function(bQ){return bQ.$==1?{$:1,$0:bQ.$0}:null;},o.ToArray(bP.$0)));};Q.ConcatActions=function(bP){var bQ,bR,bS,bT;bQ=e.ofSeqNonCopying(bP);bR=bs.length(bQ);return bR===0?Q.Const():bR===1?bs.get(bQ,0):(bS=by.max(by.map(function(bU){return bU.Duration;},bQ)),(bT=bs.map(function(bU){return Q.Prolong(bS,bU);},bQ),Q.Def(bS,function(bU){bs.iter(function(bV){bV.Compute(bU);},bT);})));};Q.Prolong=function(bP,bQ){var bR,bS,bT;bR=bQ.Compute;bS=bQ.Duration;bT=bI.Create(function(){return bQ.Compute(bQ.Duration);});return{Compute:function(bU){return bU>=bS?bT.f():bR(bU);},Duration:bP};};Q.Const=function(bP){return Q.Def(0,function(){return bP;});};Q.Def=function(bP,bQ){return{Compute:bQ,Duration:bP};};Q.Finalize=function(bP){bs.iter(function(bQ){if(bQ.$==0)bQ.$0();},o.ToArray(bP.$0));};Q.List=function(bP){return bP.$0;};R=d.Trans=bA.Class({Copy:function(bP,bQ,bR,bS){var bT,bU,bV,bW,bX;function bY(bZ,b0){return bT.TChange(bZ,b0);}bT=this;bU=bP==null?function(bZ){return function(b0){return bY(bZ,b0);};}:bP.$0;return new R.New$3(function(bZ,b0){return(bU(bZ))(b0);},(bV=this.get_TEnter(),bQ==null?bV:bQ.$0),(bW=this.get_TExit(),bR==null?bW:bR.$0),(bX=this.get_TFlags(),bS==null?bX:bS.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(bP,bQ){return this.change(bP,bQ);}},b.Obj,R);R.New=bA.Ctor(function(bP,bQ,bR){R.New$3.call(this,bP,bB.Equals(bQ,null)?P.Const:bQ,bB.Equals(bR,null)?P.Const:bR,1|(bB.Equals(bQ,null)?0:2)|(bB.Equals(bR,null)?0:4));},R);R.New$1=bA.Ctor(function(bP){R.New$3.call(this,bP,P.Const,P.Const,1);},R);R.New$2=bA.Ctor(function(){R.New$3.call(this,function(bP,bQ){return P.Const(bQ);},P.Const,P.Const,0);},R);R.New$3=bA.Ctor(function(bP,bQ,bR,bS){this.change=bP;this.enter=bQ;this.exit=bR;this.flags=bS;},R);R.Exit=function(bP,bQ){return bQ.Copy(null,null,{$:1,$0:bP},{$:1,$0:bQ.get_TFlags()|4});};R.Enter=function(bP,bQ){return bQ.Copy(null,{$:1,$0:bP},null,{$:1,$0:bQ.get_TFlags()|2});};R.Change=function(bP,bQ){return bQ.Copy({$:1,$0:bP},null,null,{$:1,$0:bQ.get_TFlags()|1});};R.Create=function(bP){return new R.New$1(bP);};R.Trivial=function(){return new R.New$2();};R.CanAnimateExit=function(bP){var bQ,bR;bQ=bP.get_TFlags();bR=4;return(bQ&bR)===bR;};R.CanAnimateEnter=function(bP){var bQ,bR;bQ=bP.get_TFlags();bR=2;return(bQ&bR)===bR;};R.CanAnimateChange=function(bP){var bQ,bR;bQ=bP.get_TFlags();bR=1;return(bQ&bR)===bR;};R.AnimateExit=function(bP,bQ){return(bP.get_TExit())(bQ);};R.AnimateEnter=function(bP,bQ){return(bP.get_TEnter())(bQ);};R.AnimateChange=function(bP,bQ,bR){return bP.TChange(bQ,bR);};S.$cctor=function(){S.$cctor=a.ignore;S.CubicInOut=N.Custom(function(bP){var bQ;bQ=bP*bP;return 3*bQ-2*(bQ*bP);});S.UseAnimations=true;};T=d.AnimatedAttrNode=bA.Class({sync:function(bP){var bQ;if(this.dirty){bQ=this.logical;bQ==null?void 0:(this.push(bP))(bQ.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(bP,bQ){this.visible={$:1,$0:bQ};this.dirty=true;(this.push(bP))(bQ);},NChanged:function(){return this.updates;},NSync:a.ignore,NGetExitAnim:function(bP){var bQ,bR;bQ=this;return P.WhenDone(function(){bQ.dirty=true;bQ.visible=null;},(bR=this.visible,bR!=null&&bR.$==1?P.Pack(P.Map(function(bS){bQ.pushVisible(bP,bS);},R.AnimateExit(this.tr,bR.$0))):P.get_Empty()));},NGetEnterAnim:function(bP){var bQ,bR,bS,bT,bU;bQ=this;return P.WhenDone(function(){bQ.sync(bP);},(bR=this.visible,(bS=this.logical,bR!=null&&bR.$==1&&(bS!=null&&bS.$==1&&(this.dirty&&(bT=[bS.$0,bR.$0],true)))?P.Pack(P.Map(function(bV){bQ.pushVisible(bP,bV);},R.AnimateChange(this.tr,bT[1],bT[0]))):bR==null&&(bS!=null&&bS.$==1&&true)?P.Pack(P.Map(function(bV){bQ.pushVisible(bP,bV);},R.AnimateEnter(this.tr,bS.$0))):P.get_Empty())));},NGetChangeAnim:function(bP){var bQ,bR,bS,bT;bQ=this;return P.WhenDone(function(){bQ.sync(bP);},(bR=this.visible,(bS=this.logical,bR!=null&&bR.$==1&&(bS!=null&&bS.$==1&&(this.dirty&&(bT=[bS.$0,bR.$0],true)))?P.Pack(P.Map(function(bU){bQ.pushVisible(bP,bU);},R.AnimateChange(this.tr,bT[1],bT[0]))):P.get_Empty())));}},b.Obj,T);T.New=bA.Ctor(function(bP,bQ,bR){var bS;bS=this;this.tr=bP;this.push=bR;this.logical=null;this.visible=null;this.dirty=true;this.updates=y.Map(function(bT){bS.logical={$:1,$0:bT};bS.dirty=true;},bQ);},T);U=d.DynamicAttrNode=bA.Class({NChanged:function(){return this.updates;},NSync:function(bP){if(this.dirty){(this.push(bP))(this.value);this.dirty=false;}},NGetExitAnim:function(bP){return P.get_Empty();},NGetEnterAnim:function(bP){return P.get_Empty();},NGetChangeAnim:function(bP){return P.get_Empty();}},b.Obj,U);U.New=bA.Ctor(function(bP,bQ){var bR;bR=this;this.push=bQ;this.value=void 0;this.dirty=false;this.updates=y.Map(function(bS){bR.value=bS;bR.dirty=true;},bP);},U);V=d.AttrProxy=bA.Class({},null,V);V.Handler=function(bP,bQ){return Z.Static(function(bR){bR.addEventListener(bP,function(bS){return(bQ(bR))(bS);},false);});};V.Concat=function(bP){var bQ;bQ=e.ofSeqNonCopying(bP);return e.TreeReduce(Z.EmptyAttr(),V.Append,bQ);};V.Append=function(bP,bQ){return Z.AppendTree(bP,bQ);};V.Create=function(bP,bQ){return Z.Static(function(bR){q.SetAttr(bR,bP,bQ);});};Y.New=function(bP,bQ,bR,bS){var bT;bT={DynElem:bP,DynFlags:bQ,DynNodes:bR};bA.SetOptional(bT,"OnAfterRender",bS);return bT;};Z.Static=function(bP){return new V({$:3,$0:bP});};Z.Dynamic=function(bP,bQ){return new V({$:1,$0:new U.New(bP,bQ)});};Z.Animated=function(bP,bQ,bR){var bS,bT,bU;bS=new T.New(bP,bQ,bR);bT=4;R.CanAnimateEnter(bP)?bT=bT|1:void 0;R.CanAnimateExit(bP)?bT=bT|2:void 0;bU=new V({$:1,$0:bS});Z.SetFlags(bU,bT);return bU;};Z.EmptyAttr=function(){_2.$cctor();return _2.EmptyAttr;};Z.AppendTree=function(bP,bQ){var bR;return bP===null?bQ:bQ===null?bP:(bR=new V({$:2,$0:bP,$1:bQ}),(Z.SetFlags(bR,Z.Flags(bP)|Z.Flags(bQ)),bR));};Z.GetChangeAnim=function(bP){return Z.GetAnim(bP,function(bQ,bR){return bQ.NGetChangeAnim(bR);});};Z.GetExitAnim=function(bP){return Z.GetAnim(bP,function(bQ,bR){return bQ.NGetExitAnim(bR);});};Z.GetEnterAnim=function(bP){return Z.GetAnim(bP,function(bQ,bR){return bQ.NGetEnterAnim(bR);});};Z.GetAnim=function(bP,bQ){return P.Concat(bs.map(function(bR){return bQ(bR,bP.DynElem);},bP.DynNodes));};Z.Updates=function(bP){return e.MapTreeReduce(function(bQ){return bQ.NChanged();},y.Const(),y.Map2Unit,bP.DynNodes);};Z.Empty=function(bP){return Y.New(bP,0,[],null);};Z.Insert=function(bP,bQ){var bR,bS,bT;function bU(bV){if(!(bV===null))if(bV!=null&&bV.$==1)bR.push(bV.$0);else if(bV!=null&&bV.$==2){bU(bV.$0);bU(bV.$1);}else if(bV!=null&&bV.$==3)bV.$0(bP);else if(bV!=null&&bV.$==4)bS.push(bV.$0);}bR=[];bS=[];bU(bQ);bT=bR.slice(0);return Y.New(bP,Z.Flags(bQ),bT,bS.length===0?null:{$:1,$0:function(bV){by.iter(function(bW){bW(bV);},bS);}});};Z.Sync=function(bP,bQ){bs.iter(function(bR){bR.NSync(bP);},bQ.DynNodes);};Z.SetFlags=function(bP,bQ){bP.flags=bQ;};Z.Flags=function(bP){return bP!==null&&bP.hasOwnProperty("flags")?bP.flags:0;};Z.HasExitAnim=function(bP){var bQ;bQ=2;return(bP.DynFlags&bQ)===bQ;};Z.HasEnterAnim=function(bP){var bQ;bQ=1;return(bP.DynFlags&bQ)===bQ;};Z.HasChangeAnim=function(bP){var bQ;bQ=4;return(bP.DynFlags&bQ)===bQ;};_0=d.CheckedInput=bA.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_0);_0.Make=function(bP){return new _0({$:0,$0:bP,$1:a.String(bP)});};_1.ValidateForm=function(){return _1.OnAfterRender(function(bP){if(window.H5F)window.H5F.setup(bP);});};_1.Checked=function(bP){function bQ(bR,bS){return!bB.Equals(bP.RVal(),bR.checked)?bP.set_RVal(bR.checked):null;}return V.Concat([_1.DynamicProp("checked",bP.RView()),_1.Handler("change",function(bR){return function(bS){return bQ(bR,bS);};}),_1.Handler("click",function(bR){return function(bS){return bQ(bR,bS);};})]);};_1.FloatValue=function(bP){return _1.CustomVar(bP,function(bQ,bR){var bS;bS=bR.get_Input();return bQ.value!==bS?void(bQ.value=bS):null;},function(bQ){var bR,bS;bR=bQ.value;return{$:1,$0:f.isBlank(bR)?(bQ.checkValidity?bQ.checkValidity():true)?new _0({$:2,$0:bR}):new _0({$:1,$0:bR}):(bS=+bR,a.isNaN(bS)?new _0({$:1,$0:bR}):new _0({$:0,$0:bS,$1:bR}))};});};_1.FloatValueUnchecked=function(bP){return _1.CustomValue(bP,a.String,function(bQ){var bR;return f.isBlank(bQ)?{$:1,$0:0}:(bR=+bQ,a.isNaN(bR)?null:{$:1,$0:bR});});};_1.IntValue=function(bP){return _1.CustomVar(bP,function(bQ,bR){var bS;bS=bR.get_Input();return bQ.value!==bS?void(bQ.value=bS):null;},function(bQ){var bR,bS,bT;bR=bQ.value;return{$:1,$0:f.isBlank(bR)?(bQ.checkValidity?bQ.checkValidity():true)?new _0({$:2,$0:bR}):new _0({$:1,$0:bR}):(bS=(bT=0,[bL.TryParseInt32(bR,{get:function(){return bT;},set:function(bU){bT=bU;}}),bT]),bS[0]?new _0({$:0,$0:bS[1],$1:bR}):new _0({$:1,$0:bR}))};});};_1.IntValueUnchecked=function(bP){return _1.CustomValue(bP,a.String,function(bQ){var bR;return f.isBlank(bQ)?{$:1,$0:0}:(bR=+bQ,bR!==bR>>0?null:{$:1,$0:bR});});};_1.Value=function(bP){function bQ(bR){return{$:1,$0:bR};}return _1.CustomValue(bP,a.id,function(bR){return bQ(a.id(bR));});};_1.ContentEditableHtml=function(bP){var bQ;bQ=_1.CustomVar(bP,function(bR,bS){bR.innerHTML=bS;},function(bR){return{$:1,$0:bR.innerHTML};});return V.Append(V.Create("contenteditable","true"),bQ);};_1.ContentEditableText=function(bP){var bQ;bQ=_1.CustomVar(bP,function(bR,bS){bR.textContent=bS;},function(bR){return{$:1,$0:bR.textContent};});return V.Append(V.Create("contenteditable","true"),bQ);};_1.CustomValue=function(bP,bQ,bR){return _1.CustomVar(bP,function(bS,bT){bS.value=bQ(bT);},function(bS){return bR(bS.value);});};_1.CustomVar=function(bP,bQ,bR){function bS(bU,bV){return bP.RUpdM(function(bW){var bX,bY;bX=bR(bU);return bX!=null&&bX.$==1&&(!bB.Equals(bX.$0,bW)&&(bY=[bX,bX.$0],true))?bY[0]:null;});}function bT(bU,bV){var bW,bX;bW=bR(bU);return bW!=null&&bW.$==1&&(bB.Equals(bW.$0,bV)&&(bX=bW.$0,true))?null:bQ(bU,bV);}return V.Concat([_1.Handler("change",function(bU){return function(bV){return bS(bU,bV);};}),_1.Handler("input",function(bU){return function(bV){return bS(bU,bV);};}),_1.Handler("keypress",function(bU){return function(bV){return bS(bU,bV);};}),_1.DynamicCustom(function(bU){return function(bV){return bT(bU,bV);};},bP.RView())]);};_1.DynamicProp=function(bP,bQ){return Z.Dynamic(bQ,function(bR){return function(bS){bR[bP]=bS;};});};_1.DynamicPred=function(bP,bQ,bR){function bS(bT,bU){return bU[0]?q.SetAttr(bT,bP,bU[1]):q.RemoveAttr(bT,bP);}return Z.Dynamic(y.Map2(function(bT,bU){return[bT,bU];},bQ,bR),function(bT){return function(bU){return bS(bT,bU);};});};_1.DynamicClass=function(bP,bQ,bR){return Z.Dynamic(bQ,function(bS){return function(bT){return bR(bT)?q.AddClass(bS,bP):q.RemoveClass(bS,bP);};});};_1.OnAfterRenderView=function(bP,bQ){var bR;bR=h.Id();return V.Append(_1.OnAfterRender(function(bS){bQ(bS,bS[bR]);}),_1.DynamicCustom(function(bS){return function(bT){bS[bR]=bT;};},bP));};_1.OnAfterRender=function(bP){return new V({$:4,$0:bP});};_1.HandlerView=function(bP,bQ,bR){return Z.Static(function(bS){var bT;bT=bR(bS);bS.addEventListener(bP,function(bU){return y.Get(bT(bU),bQ);},false);});};_1.Handler=function(bP,bQ){return Z.Static(function(bR){bR.addEventListener(bP,function(bS){return(bQ(bR))(bS);},false);});};_1.DynamicStyle=function(bP,bQ){return Z.Dynamic(bQ,function(bR){return function(bS){return q.SetStyle(bR,bP,bS);};});};_1.DynamicCustom=function(bP,bQ){return Z.Dynamic(bQ,bP);};_1.Dynamic=function(bP,bQ){return Z.Dynamic(bQ,function(bR){return function(bS){return q.SetAttr(bR,bP,bS);};});};_1.AnimatedStyle=function(bP,bQ,bR,bS){return Z.Animated(bQ,bR,function(bT){return function(bU){return q.SetStyle(bT,bP,bS(bU));};});};_1.Animated=function(bP,bQ,bR,bS){return Z.Animated(bQ,bR,function(bT){return function(bU){return q.SetAttr(bT,bP,bS(bU));};});};_1.Class=function(bP){return Z.Static(function(bQ){q.AddClass(bQ,bP);});};_1.Style=function(bP,bQ){return Z.Static(function(bR){q.SetStyle(bR,bP,bQ);});};_2.$cctor=function(){_2.$cctor=a.ignore;_2.EmptyAttr=null;};_3=d.DocElemNode=bA.Class({GetHashCode:function(){return this.ElKey;},Equals:function(bP){return this.ElKey===bP.ElKey;}},null,_3);_3.New=function(bP,bQ,bR,bS,bT,bU){var bV;return new _3((bV={Attr:bP,Children:bQ,El:bS,ElKey:bT},(bA.SetOptional(bV,"Delimiters",bR),bA.SetOptional(bV,"Render",bU),bV)));};_5.FoldBack=function(bP,bQ,bR){return bs.foldBack(bP,bQ.$0,bR);};_5.Iter=function(bP,bQ){bs.iter(bP,bQ.$0);};_5.Except=function(bP,bQ){var bR;bR=bP.$0;return{$:0,$0:bs.filter(function(bS){return bs.forall(function(bT){return!(bS===bT);},bR);},bQ.$0)};};_5.DocChildren=function(bP){var bQ;function bR(bS){if(bS!=null&&bS.$==2)bR(bS.$0.Current);else if(bS!=null&&bS.$==1)bQ.push(bS.$0.El);else if(bS==null);else if(bS!=null&&bS.$==5)bQ.push(bS.$0);else if(bS!=null&&bS.$==4)bQ.push(bS.$0.Text);else if(bS!=null&&bS.$==6)bs.iter(function(bT){if(bT.constructor===a.Object)bR(bT);else bQ.push(bT);},bS.$0.Els);else{bR(bS.$0);bR(bS.$1);}}bQ=[];bR(bP.Children);return{$:0,$0:e.ofSeqNonCopying(bQ)};};_5.Children=function(bP,bQ){var bR,bS,bT;if(bQ!=null&&bQ.$==1){bT=[];bR=bQ.$0[0].nextSibling;while(bR!==bQ.$0[1]){bT.push(bR);bR=bR.nextSibling;}return{$:0,$0:bT};}else return{$:0,$0:bs.init(bP.childNodes.length,(bS=bP.childNodes,function(bU){return bS[bU];}))};};_6.ToArray=function(bP){return i.ToArray(bP.$0);};_6.get_Empty=function(){return{$:0,$0:new bx.New$3()};};_6.IsEmpty=function(bP){return bP.$0.get_Count()===0;};_6.Intersect=function(bP,bQ){return{$:0,$0:i.Intersect(bP.$0,bQ.$0)};};_6.Except=function(bP,bQ){return{$:0,$0:i.Except(bP.$0,bQ.$0)};};_6.FindAll=function(bP){var bQ;function bR(bT){if(bT!=null&&bT.$==0){bR(bT.$0);bR(bT.$1);}else if(bT!=null&&bT.$==1)bS(bT.$0);else if(bT!=null&&bT.$==2)bR(bT.$0.Current);else if(bT!=null&&bT.$==6)bs.iter(bS,bT.$0.Holes);}function bS(bT){bQ.push(bT);bR(bT.Children);}bQ=[];bR(bP);return{$:0,$0:new bx.New$2(bQ)};};_6.Filter=function(bP,bQ){return{$:0,$0:i.Filter(bP,bQ.$0)};};_7.New=function(bP,bQ){return{PreviousNodes:bP,Top:bQ};};_8.TextHoleRE=function(){ba.$cctor();return ba.TextHoleRE;};_8.LoadedTemplates=function(){ba.$cctor();return ba.LoadedTemplates;};_8.UpdateTextNode=function(bP,bQ){bP.Value=bQ;bP.Dirty=true;};_8.CreateTextNode=function(){return{Text:q.CreateText(""),Dirty:false,Value:""};};_8.UpdateEmbedNode=function(bP,bQ){bP.Current=bQ;bP.Dirty=true;};_8.CreateEmbedNode=function(){return{Current:null,Dirty:false};};_8.PerformAnimatedUpdate=function(bP,bQ){var bR;return P.get_UseAnimations()?(bR=null,bD.Delay(function(){var bS,bT,bU;bS=_6.FindAll(bQ);bT=_8.ComputeChangeAnim(bP,bS);bU=_8.ComputeEnterAnim(bP,bS);return bD.Bind(P.Play(P.Append(bT,_8.ComputeExitAnim(bP,bS))),function(){return bD.Bind(_8.SyncElemNodesNextFrame(bP),function(){return bD.Bind(P.Play(bU),function(){bP.PreviousNodes=bS;return bD.Return(null);});});});})):_8.SyncElemNodesNextFrame(bP);};_8.SyncElemNodesNextFrame=function(bP){function bQ(bR){a.requestAnimationFrame(function(){_8.SyncElemNode(bP.Top);bR();});}return bD.FromContinuations(function(bR,bS,bT){return bQ.apply(null,[bR,bS,bT]);});};_8.ComputeEnterAnim=function(bP,bQ){return P.Concat(bs.map(function(bR){return Z.GetEnterAnim(bR.Attr);},_6.ToArray(_6.Except(bP.PreviousNodes,_6.Filter(function(bR){return Z.HasEnterAnim(bR.Attr);},bQ)))));};_8.ComputeChangeAnim=function(bP,bQ){var bR;function bS(bT){return Z.HasChangeAnim(bT.Attr);}bR=function(bT){return _6.Filter(bS,bT);};return P.Concat(bs.map(function(bT){return Z.GetChangeAnim(bT.Attr);},_6.ToArray(_6.Intersect(bR(bP.PreviousNodes),bR(bQ)))));};_8.ComputeExitAnim=function(bP,bQ){return P.Concat(bs.map(function(bR){return Z.GetExitAnim(bR.Attr);},_6.ToArray(_6.Except(bQ,_6.Filter(function(bR){return Z.HasExitAnim(bR.Attr);},bP.PreviousNodes)))));};_8.CreateDelimitedRunState=function(bP,bQ,bR){return _7.New(_6.get_Empty(),_8.CreateDelimitedElemNode(bP,bQ,Z.EmptyAttr(),bR));};_8.CreateRunState=function(bP,bQ){return _7.New(_6.get_Empty(),_8.CreateElemNode(bP,Z.EmptyAttr(),bQ));};_8.CreateDelimitedElemNode=function(bP,bQ,bR,bS){var bT,bU;bT=bP.parentNode;_8.LinkPrevElement(bQ,bS);bU=Z.Insert(bT,bR);return _3.New(bU,bS,{$:1,$0:[bP,bQ]},bT,h.Int(),bA.GetOptional(bU.OnAfterRender));};_8.CreateElemNode=function(bP,bQ,bR){var bS;_8.LinkElement(bP,bR);bS=Z.Insert(bP,bQ);return _3.New(bS,bR,null,bP,h.Int(),bA.GetOptional(bS.OnAfterRender));};_8.SyncElemNode=function(bP){_8.SyncElement(bP);_8.Sync(bP.Children);_8.AfterRender(bP);};_8.Sync=function(bP){var bQ,bR;if(bP!=null&&bP.$==1)_8.SyncElemNode(bP.$0);else if(bP!=null&&bP.$==2)_8.Sync(bP.$0.Current);else if(bP==null);else if(bP!=null&&bP.$==5);else if(bP!=null&&bP.$==4){bQ=bP.$0;bQ.Dirty?(bQ.Text.nodeValue=bQ.Value,bQ.Dirty=false):void 0;}else if(bP!=null&&bP.$==6){bR=bP.$0;bs.iter(function(bS){_8.SyncElemNode(bS);},bR.Holes);bs.iter(function(bS){Z.Sync(bS[0],bS[1]);},bR.Attrs);_8.AfterRender(bR);}else{_8.Sync(bP.$0);_8.Sync(bP.$1);}};_8.AfterRender=function(bP){var bQ;bQ=bA.GetOptional(bP.Render);bQ!=null&&bQ.$==1?(bQ.$0(bP.El),bA.SetOptional(bP,"Render",null)):void 0;};_8.InsertBeforeDelim=function(bP,bQ){var bR,bS;bR=bP.parentNode;bS=a.document.createTextNode("");bR.insertBefore(bS,bP);_8.LinkPrevElement(bP,bQ);return bS;};_8.LinkPrevElement=function(bP,bQ){_8.InsertDoc(bP.parentNode,bQ,bP);};_8.LinkElement=function(bP,bQ){_8.InsertDoc(bP,bQ,null);};_8.SyncElement=function(bP){function bQ(bR){function bS(bT){var bU,bV;return bT!=null&&bT.$==0?bS(bT.$0)||bS(bT.$1):bT!=null&&bT.$==2?(bU=bT.$0,bU.Dirty||bS(bU.Current)):bT!=null&&bT.$==6&&(bV=bT.$0,bV.Dirty||bs.exists(bQ,bV.Holes));}return bS(bR.Children);}Z.Sync(bP.El,bP.Attr);bQ(bP)?_8.DoSyncElement(bP):void 0;};_8.DoSyncElement=function(bP){var bQ,bR,bS;function bT(bU,bV){var bW,bX;return bU!=null&&bU.$==1?bU.$0.El:bU!=null&&bU.$==2?(bW=bU.$0,bW.Dirty?(bW.Dirty=false,_8.InsertDoc(bQ,bW.Current,bV)):bT(bW.Current,bV)):bU==null?bV:bU!=null&&bU.$==4?bU.$0.Text:bU!=null&&bU.$==5?bU.$0:bU!=null&&bU.$==6?(bX=bU.$0,(bX.Dirty?bX.Dirty=false:void 0,bs.foldBack(function(bY,bZ){return bY.constructor===a.Object?bT(bY,bZ):bY;},bX.Els,bV))):bT(bU.$0,bT(bU.$1,bV));}bQ=bP.El;_5.Iter((bR=bP.El,function(bU){q.RemoveNode(bR,bU);}),_5.Except(_5.DocChildren(bP),_5.Children(bP.El,bA.GetOptional(bP.Delimiters))));bT(bP.Children,(bS=bA.GetOptional(bP.Delimiters),bS!=null&&bS.$==1?bS.$0[1]:null));};_8.InsertDoc=function(bP,bQ,bR){var bS;return bQ!=null&&bQ.$==1?_8.InsertNode(bP,bQ.$0.El,bR):bQ!=null&&bQ.$==2?(bS=bQ.$0,(bS.Dirty=false,_8.InsertDoc(bP,bS.Current,bR))):bQ==null?bR:bQ!=null&&bQ.$==4?_8.InsertNode(bP,bQ.$0.Text,bR):bQ!=null&&bQ.$==5?_8.InsertNode(bP,bQ.$0,bR):bQ!=null&&bQ.$==6?bs.foldBack(function(bT,bU){return bT.constructor===a.Object?_8.InsertDoc(bP,bT,bU):_8.InsertNode(bP,bT,bU);},bQ.$0.Els,bR):_8.InsertDoc(bP,bQ.$0,_8.InsertDoc(bP,bQ.$1,bR));};_8.InsertNode=function(bP,bQ,bR){q.InsertAt(bP,bR,bQ);return bQ;};_9=d.Doc=bA.Class({ReplaceInDom:function(bP){var bQ;bQ=a.document.createTextNode("");bP.parentNode.replaceChild(bQ,bP);_9.RunBefore(bQ,this);}},b.Obj,_9);_9.Append=function(bP,bQ){return _9.Mk({$:0,$0:bP.docNode,$1:bQ.docNode},y.Map2Unit(bP.updates,bQ.updates));};_9.Concat=function(bP){var bQ;bQ=e.ofSeqNonCopying(bP);return e.TreeReduce(_9.Empty(),_9.Append,bQ);};_9.Empty=function(){return _9.Mk(null,y.Const());};_9.TextNode=function(bP){return _9.Mk({$:5,$0:q.CreateText(bP)},y.Const());};_9.Verbatim=function(bP){var bQ;return _9.Mk(e.MapTreeReduce(function(bR){return bB.Equals(bR.nodeType,bM.TEXT_NODE)?{$:5,$0:bR}:{$:1,$0:_8.CreateElemNode(bR,Z.EmptyAttr(),null)};},null,function(bR,bS){return{$:0,$0:bR,$1:bS};},(bQ=bN.parseHTML(bP),bB.Equals(bQ,null)?[]:bQ)),y.Const());};_9.SvgElementMixed=function(bP,bQ){var bR;bR=_9.MixedNodes(bQ);return _9.SvgElement(bP,bR[0],bR[1]);};_9.SvgElement=function(bP,bQ,bR){var bS,bT;bS=V.Concat(bQ);bT=_9.Concat(bR);return _.New(q.CreateSvgElement(bP),bS,bT);};_9.ElementMixed=function(bP,bQ){var bR;bR=_9.MixedNodes(bQ);return _9.Element(bP,bR[0],bR[1]);};_9.ConcatMixed=function(bP){return _9.Concat(by.map(_9.ToMixedDoc,bP));};_9.MixedNodes=function(bP){var bQ,bR,bS,bT;bQ=[];bR=[];bS=bt.Get(bP);try{while(bS.MoveNext()){bT=bS.Current();bT instanceof V?bQ.push(bT):bR.push(_9.ToMixedDoc(bT));}}finally{if("Dispose"in bS)bS.Dispose();}return[bQ,bR];};_9.ToMixedDoc=function(bP){return bP instanceof _9?bP:typeof bP=="string"?_9.TextNode(bP):bP instanceof a.Element?_9.Static(bP):typeof bP=="function"?_9.EmbedView(y.Map(_9.ToMixedDoc,bP)):bP instanceof w?_9.EmbedView(y.Map(_9.ToMixedDoc,bP.v)):bB.Equals(bP,null)?_9.Empty():_9.TextNode(a.String(bP));};_9.Element=function(bP,bQ,bR){var bS,bT;bS=V.Concat(bQ);bT=_9.Concat(bR);return _.New(q.CreateElement(bP),bS,bT);};_9.Radio=function(bP,bQ,bR){var bS,bT;bS=q.CreateElement("input");bS.addEventListener("click",function(){return bR.RSet(bQ);},false);bT=_1.DynamicProp("checked",y.Map(function(bU){return bB.Equals(bU,bQ);},bR.RView()));return _.New(bS,V.Concat(br.append(br.ofArray([V.Create("type","radio"),V.Create("name",bR.RId()),bT]),br.ofSeq(bP))),_9.Empty());};_9.LinkView=function(bP,bQ,bR,bS){var bT;bT=V.Concat(by.append([_1.HandlerView("click",bR,function(){return function(){return bS;};}),V.Create("href","#")],bQ));return _.New(q.CreateElement("a"),bT,_9.TextNode(bP));};_9.Link=function(bP,bQ,bR){var bS,bT;bS=(bT=V.Concat(bQ),V.Append(V.Create("href","#"),bT));return _.New(_9.Clickable("a",bR),bS,_9.TextNode(bP));};_9.ButtonView=function(bP,bQ,bR,bS){var bT;bT=V.Concat(by.append([_1.HandlerView("click",bR,function(){return function(){return bS;};})],bQ));return _.New(q.CreateElement("button"),bT,_9.TextNode(bP));};_9.Button=function(bP,bQ,bR){var bS;bS=V.Concat(bQ);return _.New(_9.Clickable("button",bR),bS,_9.TextNode(bP));};_9.Clickable=function(bP,bQ){var bR;bR=q.CreateElement(bP);bR.addEventListener("click",function(bS){bS.preventDefault();return bQ();},false);return bR;};_9.CheckBoxGroup=function(bP,bQ,bR){function bS(bT){return bB.Equals(bQ,bT);}return _9.CheckBox(bP,w.Lens(bR,function(bT){return br.exists(bS,bT);},function(bT,bU){return bU?br.exists(function(bV){return bB.Equals(bQ,bV);},bT)?bT:new br.T({$:1,$0:bQ,$1:bT}):br.filter(function(bV){return!bB.Equals(bQ,bV);},bT);}));};_9.CheckBox=function(bP,bQ){return _9.InputInternal("input",function(){return by.append(bP,[V.Create("type","checkbox"),_1.Checked(bQ)]);});};_9.SelectDynOptional=function(bP,bQ,bR,bS,bT){return _9.SelectDyn(bP,function(bU){return bU!=null&&bU.$==1?bR(bU.$0):bQ;},y.Map(function(bU){return new br.T({$:1,$0:null,$1:br.map(function(bV){return{$:1,$0:bV};},bU)});},bS),bT);};_9.SelectOptional=function(bP,bQ,bR,bS,bT){return _9.Select(bP,function(bU){return bU!=null&&bU.$==1?bR(bU.$0):bQ;},new br.T({$:1,$0:null,$1:br.map(function(bU){return{$:1,$0:bU};},bS)}),bT);};_9.Select=function(bP,bQ,bR,bS){return _9.SelectImpl(bP,bQ,function(bT){bT[0]=bR;return _9.Concat(br.mapi(function(bU,bV){return _9.Element("option",br.ofArray([V.Create("value",a.String(bU))]),br.ofArray([_9.TextNode(bQ(bV))]));},bR));},bS);};_9.SelectDyn=function(bP,bQ,bR,bS){return _9.SelectImpl(bP,bQ,function(bT){function bU(bV,bW){return _9.Element("option",br.ofArray([V.Create("value",a.String(bV))]),br.ofArray([_9.TextNode(bQ(bW))]));}return _9.Convert(function(bV){return bU(bV[0],bV[1]);},y.Map(function(bV){bT[0]=bV;return by.mapi(function(bW,bX){return[bW,bX];},bV);},bR));},bS);};_9.SelectImpl=function(bP,bQ,bR,bS){var bT,bU,bV,bW;function bX(b2){return b2.selectedIndex;}function bY(b2,b3){b2.selectedIndex=b3;}function bZ(b2){var b3;b3=bX(b2);return bT[0].get_Item(b3);}function b0(b2){return by.findIndex(function(b3){return bB.Equals(b2,b3);},bT[0]);}function b1(b2,b3){return bY(b2,b0(b3));}bT=[br.T.Empty];bU=q.CreateElement("select");bV=_1.DynamicCustom(function(b2){return function(b3){return b1(b2,b3);};},bS.RView());bU.addEventListener("change",function(){bS.RUpdM(function(b2){var b3;b3=bZ(bU);return bB.Equals(b2,b3)?null:{$:1,$0:b3};});},false);return _.New(bU,(bW=V.Append(bV,V.Concat(bP)),V.Append(_1.OnAfterRender(function(b2){b1(b2,bS.RGet());}),bW)),bR(bT));};_9.InputArea=function(bP,bQ){return _9.InputInternal("textarea",function(){return by.append(bP,[_1.Value(bQ)]);});};_9.FloatInput=function(bP,bQ){return _9.InputInternal("input",function(){return by.append(bP,[_1.FloatValue(bQ),V.Create("type","number")]);});};_9.FloatInputUnchecked=function(bP,bQ){return _9.InputInternal("input",function(){return by.append(bP,[bQ.RGet()===0?V.Create("value","0"):Z.EmptyAttr(),_1.FloatValueUnchecked(bQ),V.Create("type","number")]);});};_9.IntInput=function(bP,bQ){return _9.InputInternal("input",function(){return by.append(bP,[_1.IntValue(bQ),V.Create("type","number")]);});};_9.IntInputUnchecked=function(bP,bQ){return _9.InputInternal("input",function(){return by.append(bP,[bQ.RGet()===0?V.Create("value","0"):Z.EmptyAttr(),_1.IntValueUnchecked(bQ),V.Create("type","number")]);});};_9.PasswordBox=function(bP,bQ){return _9.InputInternal("input",function(){return by.append(bP,[_1.Value(bQ),V.Create("type","password")]);});};_9.Input=function(bP,bQ){return _9.InputInternal("input",function(){return by.append(bP,[_1.Value(bQ)]);});};_9.InputInternal=function(bP,bQ){var bR;bR=q.CreateElement(bP);return _.New(bR,V.Concat(bQ(bR)),_9.Empty());};_9.ConvertSeqBy=function(bP,bQ,bR){return _9.Flatten(y.MapSeqCachedViewBy(bP,function(bS,bT){return(bQ(bS))(bT);},bR));};_9.ConvertSeq=function(bP,bQ){return _9.Flatten(y.MapSeqCachedView(bP,bQ));};_9.ConvertBy=function(bP,bQ,bR){return _9.Flatten(y.MapSeqCachedBy(bP,bQ,bR));};_9.Convert=function(bP,bQ){return _9.Flatten(y.MapSeqCached(bP,bQ));};_9.Flatten=function(bP){return _9.EmbedView(y.Map(_9.Concat,bP));};_9.GetOrLoadTemplate=function(bP,bQ,bR,bS){_9.PrepareTemplate(bP,bQ,bR);return _9.NamedTemplate(bP,bQ,bS);};_9.NamedTemplate=function(bP,bQ,bR){var bS,bT,bU;bS=_9.ComposeName(bP,bQ);bT=(bU=null,[_8.LoadedTemplates().TryGetValue(bS,{get:function(){return bU;},set:function(bV){bU=bV;}}),bU]);return bT[0]?_9.ChildrenTemplate(bT[1].cloneNode(true),bR):(bC.warn("Local template doesn't exist",bS),_9.Empty());};_9.LoadLocalTemplates=function(bP){(function(){var bQ,bR,bS,bT;while(true){bQ=a.document.querySelector("[ws-template]");if(bB.Equals(bQ,null)){bR=a.document.querySelector("[ws-children-template]");if(bB.Equals(bR,null))return null;else{bS=bR.getAttribute("ws-children-template");bR.removeAttribute("ws-children-template");_9.PrepareTemplate(bP,{$:1,$0:bS},function(bU){return function(){return q.ChildrenArray(bU);};}(bR));}}else{bT=bQ.getAttribute("ws-template");_9.PrepareSingleTemplate(bP,{$:1,$0:bT},bQ);}}}());};_9.PrepareTemplate=function(bP,bQ,bR){var bS,bT,bU,bV,bW;if(!_8.LoadedTemplates().ContainsKey(_9.ComposeName(bP,bQ))){bS=bR();for(bT=0,bU=bS.length-1;bT<=bU;bT++){bV=bs.get(bS,bT);bW=bV.parentNode;bB.Equals(bW,null)?void 0:bW.removeChild(bV);}_9.PrepareTemplateStrict(bP,bQ,bS);}};_9.PrepareTemplateStrict=function(bP,bQ,bR){var bS;function bT(b5){var b7,b8,b9,b_,b$,ca,cb,cc;function b6(cd){var ce;ce=b5.getAttribute(cd);ce===null?void 0:b5.setAttribute(cd,ce.toLowerCase());}b7=b5.attributes;b8=[];b9=[];b_=[];for(b$=0,ca=b7.length-1;b$<=ca;b$++){cb=b7.item(b$);bu.StartsWith(cb.nodeName,"ws-on")&&cb.nodeName!=="ws-onafterrender"&&cb.nodeName!=="ws-on"?(b8.push(cb.nodeName),b9.push(bO.string(cb.nodeName,{$:1,$0:"ws-on".length},null)+":"+cb.nodeValue.toLowerCase())):!bu.StartsWith(cb.nodeName,"ws-")&&(new a.RegExp(_8.TextHoleRE())).test(cb.nodeValue)?(cb.nodeValue=(cc=new a.RegExp(_8.TextHoleRE(),"g"),cb.nodeValue.replace(cc,function(cd,ce){return"${"+ce.toLowerCase()+"}";})),b_.push(cb.nodeName)):void 0;}!(b9.length==0)?b5.setAttribute("ws-on",bu.concat(" ",b9)):void 0;!(b_.length==0)?b5.setAttribute("ws-attr-holes",bu.concat(" ",b_)):void 0;b6("ws-hole");b6("ws-replace");b6("ws-attr");b6("ws-onafterrender");b6("ws-var");bs.iter(function(cd){b5.removeAttribute(cd);},b8);}function bU(b5){var b6,b7,b8,b9,b_,b$;b6=null;b7=0;b9=b5.textContent;b_=new a.RegExp(_8.TextHoleRE(),"g");while(b6=b_.exec(b9),b6!==null){b5.parentNode.insertBefore(a.document.createTextNode(bO.string(b9,{$:1,$0:b7},{$:1,$0:b_.lastIndex-bs.get(b6,0).length-1})),b5);b7=b_.lastIndex;b$=a.document.createElement("span");b$.setAttribute("ws-replace",bs.get(b6,1).toLowerCase());b5.parentNode.insertBefore(b$,b5);}b_.lastIndex=0;b5.textContent=bO.string(b9,{$:1,$0:b7},null);}function bV(b5,b6){function b7(b8){q.IterSelector(b5,"["+b8+"]",function(b9){var b_,b$;b_=(b$=null,[b6.TryGetValue(b9.getAttribute(b8).toLowerCase(),{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);b_[0]?b9.setAttribute(b8,b_[1]):void 0;});}b7("ws-hole");b7("ws-replace");b7("ws-attr");b7("ws-onafterrender");b7("ws-var");q.IterSelector(b5,"[ws-on]",function(b8){b8.setAttribute("ws-on",bu.concat(" ",bs.map(function(b9){var b_,b$,ca;b_=bu.SplitChars(b9,[":"],1);b$=(ca=null,[b6.TryGetValue(bs.get(b_,1),{get:function(){return ca;},set:function(cb){ca=cb;}}),ca]);return b$[0]?bs.get(b_,0)+":"+b$[1]:b9;},bu.SplitChars(b8.getAttribute("ws-on"),[" "],1))));});return q.IterSelector(b5,"[ws-attr-holes]",function(b8){var b9,b_,b$;b9=bu.SplitChars(b8.getAttribute("ws-attr-holes"),[" "],1);for(b_=0,b$=b9.length-1;b_<=b$;b_++)(function(){var ca;function cb(cc,cd){var ce;ce=bG.KeyValue(cd);return cc.replace(new a.RegExp("\\${"+ce[0]+"}","ig"),"${"+ce[1]+"}");}ca=bs.get(b9,b_);return b8.setAttribute(ca,(((bA.Curried3(by.fold))(cb))(b8.getAttribute(ca)))(b6));}());});}function bW(b5,b6){var b7,b8,b9,b_,b$;bT(b6);b7=b6.nodeName.toLowerCase();b8=b5.querySelector("[ws-attr="+b7+"]");if(bB.Equals(b8,null))return bC.warn("Filling non-existent attr hole",b7);else{b8.removeAttribute("ws-attr");for(b9=0,b_=b6.attributes.length-1;b9<=b_;b9++){b$=b6.attributes.item(b9);b$.name==="class"&&b8.hasAttribute("class")?b8.setAttribute("class",b8.getAttribute("class")+" "+b$.nodeValue):b8.setAttribute(b$.name,b$.nodeValue);}return;}}function bX(b5,b6){function b7(b8){q.IterSelector(b5,"["+b8+"]",function(b9){if(!b6.Contains(b9.getAttribute(b8)))b9.removeAttribute(b8);});}b7("ws-attr");b7("ws-onafterrender");b7("ws-var");q.IterSelector(b5,"[ws-hole]",function(b8){if(!b6.Contains(b8.getAttribute("ws-hole"))){b8.removeAttribute("ws-hole");while(b8.hasChildNodes())b8.removeChild(b8.lastChild);}});q.IterSelector(b5,"[ws-replace]",function(b8){if(!b6.Contains(b8.getAttribute("ws-replace")))b8.parentNode.removeChild(b8);});q.IterSelector(b5,"[ws-on]",function(b8){b8.setAttribute("ws-on",bu.concat(" ",bs.filter(function(b9){return b6.Contains(bs.get(bu.SplitChars(b9,[":"],1),1));},bu.SplitChars(b8.getAttribute("ws-on"),[" "],1))));});return q.IterSelector(b5,"[ws-attr-holes]",function(b8){var b9,b_,b$,ca,cb;b9=bu.SplitChars(b8.getAttribute("ws-attr-holes"),[" "],1);for(b_=0,b$=b9.length-1;b_<=b$;b_++){ca=bs.get(b9,b_);b8.setAttribute(ca,(cb=new a.RegExp(_8.TextHoleRE(),"g"),b8.getAttribute(ca).replace(cb,function(cc,cd){return b6.Contains(cd)?cc:"";})));}});}function bY(b5,b6){var b7;b7=b5.querySelector("[ws-replace]");return bB.Equals(b7,null)?(bC.warn("Filling non-existent text hole",bQ),null):(b7.parentNode.replaceChild(new a.Text(b6),b7),{$:1,$0:b7.getAttribute("ws-replace")});}function bZ(b5,b6,b7){while(true)if(b5.hasChildNodes())b7=b6.insertBefore(b5.lastChild,b7);else return null;}function b0(b5,b6,b7){var b8,b9,b_,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs;function b$(ct){}while(true)switch(b5){case 0:ca=bO.string(b6.nodeName,{$:1,$0:3},null).toLowerCase();cb=ca.indexOf(".")===-1?bP+"/"+ca:bu.Replace(ca,".","/");if(!_8.LoadedTemplates().ContainsKey(cb))return bC.warn("Instantiating non-loaded template",cb);else{cc=_8.LoadedTemplates().get_Item(cb);cd=cc.cloneNode(true);ce=new bx.New$3();cf=new bJ.New$5();cg=b6.attributes;for(ch=0,ci=cg.length-1;ch<=ci;ch++){cj=cg.item(ch).name.toLowerCase();cf.set_Item(cj,(ck=cg.item(ch).nodeValue,ck===""?cj:ck.toLowerCase()));!ce.Add(cj)?bC.warn("Hole mapped twice",cj):void 0;}for(cl=0,cm=b6.childNodes.length-1;cl<=cm;cl++){cn=b6.childNodes[cl];bB.Equals(cn.nodeType,bM.ELEMENT_NODE)?!ce.Add(cn.nodeName.toLowerCase())?bC.warn("Hole filled twice",cb):void 0:void 0;}co=b6.childNodes.length===1&&bB.Equals(b6.firstChild.nodeType,bM.TEXT_NODE);if(co){b9=bY(cd,b6.firstChild.textContent);((function(ct){return function(cu){if(cu!=null)ct(cu.$0);};}((b_=function(ct){return function(cu){return ct.Add(cu);};}(ce),function(ct){return b$(b_(ct));})))(b9));}bX(cd,ce);if(!co){for(cp=0,cq=b6.childNodes.length-1;cp<=cq;cp++){cr=b6.childNodes[cp];bB.Equals(cr.nodeType,bM.ELEMENT_NODE)?cr.hasAttributes()?bW(cd,cr):b1(cd,cr):void 0;}}bV(cd,cf);(((function(ct){function cu(cv,cw){return bZ(ct,cv,cw);}return function(cv){return function(cw){return cu(cv,cw);};};}(cd))(b6.parentNode))(b6));b6.parentNode.removeChild(b6);return;}break;case 1:if(b7!==null){cs=b7.nextSibling;if(bB.Equals(b7.nodeType,bM.TEXT_NODE))bU(b7);else if(bB.Equals(b7.nodeType,bM.ELEMENT_NODE))b3(b7);b7=cs;}else return null;break;}}function b1(b5,b6){var b7,b9,b_;function b8(b$,ca){var cb,cc,cd;if(b9==="title"&&b6.hasChildNodes()){cb=bN.parseHTML(b6.textContent);b6.removeChild(b6.firstChild);for(cc=0,cd=cb.length-1;cc<=cd;cc++)b6.appendChild(bs.get(cb,cc));}else null;b3(b6);return bZ(b6,b$,ca);}b9=b6.nodeName.toLowerCase();q.IterSelector(b5,"[ws-attr-holes]",function(b$){var ca,cb,cc,cd,ce;ca=bu.SplitChars(b$.getAttribute("ws-attr-holes"),[" "],1);for(cb=0,cc=ca.length-1;cb<=cc;cb++){cd=bs.get(ca,cb);b$.setAttribute(cd,(ce=new a.RegExp("\\${"+b9+"}","ig"),b$.getAttribute(cd).replace(ce,b6.textContent)));}});b_=b5.querySelector("[ws-hole="+b9+"]");if(bB.Equals(b_,null)){b7=b5.querySelector("[ws-replace="+b9+"]");return bB.Equals(b7,null)?null:(b8(b7.parentNode,b7),void b7.parentNode.removeChild(b7));}else{while(b_.hasChildNodes())b_.removeChild(b_.lastChild);b_.removeAttribute("ws-hole");return b8(b_,null);}}function b2(b5){return b0(0,b5);}function b3(b5){var b6,b7;if(bu.StartsWith(b5.nodeName.toLowerCase(),"ws-")&&!b5.hasAttribute("ws-template"))b2(b5);else{bT(b5);b6=b5.getAttribute("ws-template");if(b6===null){b7=b5.getAttribute("ws-children-template");if(b7===null)b4(b5,b5.firstChild);else{b5.removeAttribute("ws-children-template");_9.PrepareTemplate(bP,{$:1,$0:b7},function(){return q.ChildrenArray(b5);});while(b5.hasChildNodes())b5.removeChild(b5.lastChild);}}else _9.PrepareSingleTemplate(bP,{$:1,$0:b6},b5);}}function b4(b5,b6){return b0(1,b5,b6);}bS=_9.FakeRoot(bR);_8.LoadedTemplates().set_Item(_9.ComposeName(bP,bQ),bS);bs.length(bR)>0?b4(bS,bs.get(bR,0)):void 0;};_9.ComposeName=function(bP,bQ){return(bP+"/"+(bQ==null?"":bQ.$0)).toLowerCase();};_9.PrepareSingleTemplate=function(bP,bQ,bR){var bS,bT,bU;bR.removeAttribute("ws-template");bS=bR.getAttribute("ws-replace");bS===null?void 0:(bR.removeAttribute("ws-replace"),bT=bR.parentNode,bB.Equals(bT,null)?void 0:(bU=a.document.createElement(bR.tagName),bU.setAttribute("ws-replace",bS),bT.replaceChild(bU,bR)));_9.PrepareTemplateStrict(bP,bQ,[bR]);};_9.FakeRoot=function(bP){var bQ,bR,bS;bQ=a.document.createElement("div");for(bR=0,bS=bP.length-1;bR<=bS;bR++)bQ.appendChild(bs.get(bP,bR));return bQ;};_9.ChildrenTemplate=function(bP,bQ){var bR,bS,bT,bU,bV,bY,bZ,b0,b1,b2,b3,b4;function bW(b5,b6){var b7,b8,b9;b7=Z.Insert(b5,b6);bZ.push(Z.Updates(b7));b0.push([b5,b7]);b8=bA.GetOptional(b7.OnAfterRender);return b8==null?null:(b9=b8.$0,void b1.push(function(){b9(b5);}));}function bX(b5){var b6,b7;b6=(b7=null,[b2.TryGetValue(b5,{get:function(){return b7;},set:function(b8){b7=b8;}}),b7]);return b6[0]?b6[1].$==0?{$:1,$0:b6[1].$1}:b6[1].$==1?{$:1,$0:_9.TextNode(b6[1].$1)}:b6[1].$==2?{$:1,$0:_9.TextView(b6[1].$1)}:b6[1].$==6?{$:1,$0:_9.TextView(b6[1].$1.RView())}:b6[1].$==7?{$:1,$0:_9.TextView(y.Map(a.String,b6[1].$1.RView()))}:b6[1].$==8?{$:1,$0:_9.TextView(y.Map(function(b8){return b8.get_Input();},b6[1].$1.RView()))}:b6[1].$==9?{$:1,$0:_9.TextView(y.Map(a.String,b6[1].$1.RView()))}:b6[1].$==10?{$:1,$0:_9.TextView(y.Map(function(b8){return b8.get_Input();},b6[1].$1.RView()))}:b6[1].$==11?{$:1,$0:_9.TextView(y.Map(a.String,b6[1].$1.RView()))}:(bC.warn("Content hole filled with attribute data",b5),null):null;}bY=[];bZ=[];b0=[];b1=[];b2=new bJ.New$5();b3=bt.Get(bQ);try{while(b3.MoveNext()){b4=b3.Current();b2.set_Item(b4.$0,b4);}}finally{if("Dispose"in b3)b3.Dispose();}bR=q.ChildrenArray(bP);q.IterSelector(bP,"[ws-hole]",function(b5){var b6,b7,b8;b8=b5.getAttribute("ws-hole");b5.removeAttribute("ws-hole");while(b5.hasChildNodes())b5.removeChild(b5.lastChild);b6=bX(b8);b6!=null&&b6.$==1?(b7=b6.$0,_8.LinkElement(b5,b7.docNode),bY.push(_3.New(Z.Empty(b5),b7.docNode,null,b5,h.Int(),null)),bZ.push(b7.updates)):void 0;});q.IterSelector(bP,"[ws-replace]",function(b5){var b6,b7,b8,b9,b_,b$;b6=bX(b5.getAttribute("ws-replace"));b6!=null&&b6.$==1?(b7=b6.$0,b8=b5.parentNode,b9=a.document.createTextNode(""),b8.replaceChild(b9,b5),b_=_8.InsertBeforeDelim(b9,b7.docNode),b$=bs.tryFindIndex(function(ca){return b5===ca;},bR),b$==null?void 0:bs.set(bR,b$.$0,b7.docNode),bY.push(_3.New(Z.Empty(b8),b7.docNode,{$:1,$0:[b_,b9]},b8,h.Int(),null)),bZ.push(b7.updates)):void 0;});q.IterSelector(bP,"[ws-attr]",function(b5){var b6,b7,b8;b6=b5.getAttribute("ws-attr");b5.removeAttribute("ws-attr");b7=(b8=null,[b2.TryGetValue(b6,{get:function(){return b8;},set:function(b9){b8=b9;}}),b8]);b7[0]?b7[1].$==3?bW(b5,b7[1].$1):bC.warn("Attribute hole filled with non-attribute data",b6):void 0;});q.IterSelector(bP,"[ws-on]",function(b5){bW(b5,V.Concat(bs.choose(function(b6){var b7,b8,b9;b7=bu.SplitChars(b6,[":"],1);b8=(b9=null,[b2.TryGetValue(bs.get(b7,1),{get:function(){return b9;},set:function(b_){b9=b_;}}),b9]);return b8[0]?b8[1].$==4?{$:1,$0:_1.Handler(bs.get(b7,0),b8[1].$1)}:(bC.warn("Event hole on"+bs.get(b7,0)+" filled with non-event data",bs.get(b7,1)),null):null;},bu.SplitChars(b5.getAttribute("ws-on"),[" "],1))));b5.removeAttribute("ws-on");});q.IterSelector(bP,"[ws-onafterrender]",function(b5){var b6,b7,b8;b6=b5.getAttribute("ws-onafterrender");b7=(b8=null,[b2.TryGetValue(b6,{get:function(){return b8;},set:function(b9){b8=b9;}}),b8]);b7[0]?b7[1].$==5?(b5.removeAttribute("ws-onafterrender"),bW(b5,_1.OnAfterRender(b7[1].$1))):bC.warn("onafterrender hole filled with non-onafterrender data",b6):void 0;});q.IterSelector(bP,"[ws-var]",function(b5){var b6,b7,b8;b6=b5.getAttribute("ws-var");b5.removeAttribute("ws-var");b7=(b8=null,[b2.TryGetValue(b6,{get:function(){return b8;},set:function(b9){b8=b9;}}),b8]);b7[0]?b7[1].$==6?bW(b5,_1.Value(b7[1].$1)):b7[1].$==7?bW(b5,_1.Checked(b7[1].$1)):b7[1].$==8?bW(b5,_1.IntValue(b7[1].$1)):b7[1].$==9?bW(b5,_1.IntValueUnchecked(b7[1].$1)):b7[1].$==10?bW(b5,_1.FloatValue(b7[1].$1)):b7[1].$==11?bW(b5,_1.FloatValueUnchecked(b7[1].$1)):bC.warn("Var hole filled with non-Var data",b6):void 0;});q.IterSelector(bP,"[ws-attr-holes]",function(b5){var b6,b7,b8,b9;b6=new a.RegExp(_8.TextHoleRE(),"g");b7=bu.SplitChars(b5.getAttribute("ws-attr-holes"),[" "],1);b5.removeAttribute("ws-attr-holes");for(b8=0,b9=b7.length-1;b8<=b9;b8++)(function(){var b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck;ch=bs.get(b7,b8);ci=b5.getAttribute(ch);b_=null;b$=0;cj=[];while(b_=b6.exec(ci),b_!==null){ck=bO.string(ci,{$:1,$0:b$},{$:1,$0:b6.lastIndex-bs.get(b_,0).length-1});b$=b6.lastIndex;cj.push([ck,bs.get(b_,1)]);}cb=bO.string(ci,{$:1,$0:b$},null);b6.lastIndex=0;cc=bs.foldBack(function(cl,cm){return(function(cn){var co,cp;co=cn[0];cp=cn[1];return function(cq){var cr,cs,ct,cu,cv;cr=cq[0];cs=cq[1];ct=(cu=(cv=null,[b2.TryGetValue(cp,{get:function(){return cv;},set:function(cw){cv=cw;}}),cv]),cu[0]?cu[1].$==1?{$:0,$0:cu[1].$1}:cu[1].$==2?{$:1,$0:cu[1].$1}:cu[1].$==6?{$:1,$0:cu[1].$1.RView()}:cu[1].$==7?{$:1,$0:y.Map(a.String,cu[1].$1.RView())}:cu[1].$==8?{$:1,$0:y.Map(function(cw){return cw.get_Input();},cu[1].$1.RView())}:cu[1].$==9?{$:1,$0:y.Map(a.String,cu[1].$1.RView())}:cu[1].$==10?{$:1,$0:y.Map(function(cw){return cw.get_Input();},cu[1].$1.RView())}:cu[1].$==11?{$:1,$0:y.Map(a.String,cu[1].$1.RView())}:(bC.warn("Attribute value hole filled with non-text data",cp),{$:0,$0:""}):{$:0,$0:""});return ct.$==1?[co,new br.T({$:1,$0:cr===""?ct.$0:y.Map(function(cw){return cw+cr;},ct.$0),$1:cs})]:[co+ct.$0+cr,cs];};}(cl))(cm);},cj,[cb,br.T.Empty]);return bW(b5,cc[1].$==1?cc[1].$1.$==1?cc[1].$1.$1.$==1?cc[1].$1.$1.$1.$==0?(cd=cc[0],_1.Dynamic(ch,y.Map3(function(cl,cm,cn){return cd+cl+cm+cn;},cc[1].$0,cc[1].$1.$0,cc[1].$1.$1.$0))):(ce=cc[0],_1.Dynamic(ch,y.Map(function(cl){return ce+bu.concat("",cl);},y.Sequence(cc[1])))):(cf=cc[0],_1.Dynamic(ch,y.Map2(function(cl,cm){return cf+cl+cm;},cc[1].$0,cc[1].$1.$0))):cc[0]===""?_1.Dynamic(ch,cc[1].$0):(cg=cc[0],_1.Dynamic(ch,y.Map(function(cl){return cg+cl;},cc[1].$0))):V.Create(ch,cc[0]));}());});bS=bA.DeleteEmptyFields({Els:bR,Dirty:true,Holes:bY,Attrs:b0,Render:(bT=b1.length==0?null:{$:1,$0:function(b5){bs.iter(function(b6){b6(b5);},b1);}},bT?bT.$0:void 0)},["Render"]);bU=e.TreeReduce(y.Const(),y.Map2Unit,bZ);return bR&&bs.length(bR)===1&&(bs.get(bR,0)instanceof bM&&(bB.Equals(bs.get(bR,0).nodeType,bM.ELEMENT_NODE)&&(bV=bs.get(bR,0),true)))?_.TreeNode(bS,bU):_9.Mk({$:6,$0:bS},bU);};_9.Template=function(bP,bQ){return _9.ChildrenTemplate(_9.FakeRoot(bP),bQ);};_9.TextView=function(bP){var bQ;bQ=_8.CreateTextNode();return _9.Mk({$:4,$0:bQ},y.Map(function(bR){_8.UpdateTextNode(bQ,bR);},bP));};_9.RunReplaceById=function(bP,bQ){var bR;bR=q.Doc().getElementById(bP);bB.Equals(bR,null)?bG.FailWith("invalid id: "+bP):bQ.ReplaceInDom(bR);};_9.RunById=function(bP,bQ){var bR;bR=q.Doc().getElementById(bP);bB.Equals(bR,null)?bG.FailWith("invalid id: "+bP):_9.Run(bR,bQ);};_9.Run=function(bP,bQ){var bR;bR=bQ.docNode;_8.LinkElement(bP,bR);y.Sink(m.StartProcessor(_8.PerformAnimatedUpdate(_8.CreateRunState(bP,bR),bR)),bQ.updates);};_9.RunPrependById=function(bP,bQ){var bR;bR=q.Doc().getElementById(bP);bB.Equals(bR,null)?bG.FailWith("invalid id: "+bP):_9.RunPrepend(bR,bQ);};_9.RunPrepend=function(bP,bQ){var bR;bR=a.document.createTextNode("");bP.insertBefore(bR,bP.firstChild);_9.RunBefore(bR,bQ);};_9.RunAppendById=function(bP,bQ){var bR;bR=q.Doc().getElementById(bP);bB.Equals(bR,null)?bG.FailWith("invalid id: "+bP):_9.RunAppend(bR,bQ);};_9.RunAppend=function(bP,bQ){var bR;bR=a.document.createTextNode("");bP.appendChild(bR);_9.RunBefore(bR,bQ);};_9.RunAfterById=function(bP,bQ){var bR;bR=q.Doc().getElementById(bP);bB.Equals(bR,null)?bG.FailWith("invalid id: "+bP):_9.RunAfter(bR,bQ);};_9.RunAfter=function(bP,bQ){var bR;bR=a.document.createTextNode("");bP.parentNode.insertBefore(bR,bP.nextSibling);_9.RunBetween(bP,bR,bQ);};_9.RunBeforeById=function(bP,bQ){var bR;bR=q.Doc().getElementById(bP);bB.Equals(bR,null)?bG.FailWith("invalid id: "+bP):_9.RunBefore(bR,bQ);};_9.RunBefore=function(bP,bQ){var bR;bR=a.document.createTextNode("");bP.parentNode.insertBefore(bR,bP);_9.RunBetween(bR,bP,bQ);};_9.RunBetween=function(bP,bQ,bR){_8.LinkPrevElement(bQ,bR.docNode);y.Sink(m.StartProcessor(_8.PerformAnimatedUpdate(_8.CreateDelimitedRunState(bP,bQ,bR.docNode),bR.docNode)),bR.updates);};_9.Async=function(bP){return _9.EmbedView(y.MapAsync(a.id,y.Const(bP)));};_9.BindView=function(bP,bQ){return _9.EmbedView(y.Map(bP,bQ));};_9.EmbedView=function(bP){var bQ;bQ=_8.CreateEmbedNode();return _9.Mk({$:2,$0:bQ},y.Map(a.ignore,y.Bind(function(bR){_8.UpdateEmbedNode(bQ,bR.docNode);return bR.updates;},bP)));};_9.Static=function(bP){return _.New(bP,Z.EmptyAttr(),_9.Empty());};_9.Mk=function(bP,bQ){return new _9.New(bP,bQ);};_9.New=bA.Ctor(function(bP,bQ){this.docNode=bP;this.updates=bQ;},_9);_=d.Elt=bA.Class({AddClass:function(bP){return this.elt.className+=" "+bP;},ClearHoles:function(){var bP;bP=this.docNode$1;bP!=null&&bP.$==6?bP.$0.Holes=[]:void 0;},AddHole:function(bP){var bQ;bQ=this.docNode$1;bQ!=null&&bQ.$==6?bQ.$0.Holes.push(bP):void 0;},SetStyle:function(bP,bQ){this.elt.style[bP]=bQ;},HasClass:function(bP){return(new a.RegExp("(\\s|^)"+bP+"(\\s|$)")).test(this.elt.className);},RemoveClass:function(bP){this.elt.className=this.elt.className.replace(new a.RegExp("(?:(\\s|^)"+bP+")+(\\s|$)","g"),"$1");},GetProperty:function(bP){return this.elt[bP];},SetProperty:function(bP,bQ){this.elt[bP]=bQ;},RemoveAttribute:function(bP){this.elt.removeAttribute(bP);},HasAttribute:function(bP){return this.elt.hasAttribute(bP);},GetAttribute:function(bP){return this.elt.getAttribute(bP);},SetAttribute:function(bP,bQ){this.elt.setAttribute(bP,bQ);},SetText:function(bP){var bQ;bQ=this.docNode$1;bQ!=null&&bQ.$==1?bQ.$0.Children=null:bQ!=null&&bQ.$==6?(bQ.$0.Els=[],this.ClearHoles()):bG.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());this.elt.textContent=bP;},GetText:function(){return this.elt.textContent;},SetValue:function(bP){this.elt.value=bP;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var bP;bP=this.docNode$1;bP!=null&&bP.$==1?bP.$0.Children=null:bP!=null&&bP.$==6?(bP.$0.Els=[],this.ClearHoles()):bG.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(bP){var bQ,bR,bS,bT,bU;bQ=this.docNode$1;bQ!=null&&bQ.$==1?(bR=bQ.$0,bR.Children={$:0,$0:bP.docNode,$1:bR.Children},_8.InsertDoc(this.elt,bP.docNode,(bS=this.elt.firstChild,bB.Equals(bS,null)?null:bS))):bQ!=null&&bQ.$==6?(bT=this.elt.insertBefore(a.document.createTextNode(""),this.elt.firstChild),bU=_8.InsertBeforeDelim(bT,bP.docNode),this.AddHole(_3.New(Z.Empty(this.elt),bP.docNode,{$:1,$0:[bU,bT]},this.elt,h.Int(),null))):bG.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,bP.updates));},Append:function(bP){var bQ,bR,bS,bT;bQ=this.docNode$1;bQ!=null&&bQ.$==1?(bR=bQ.$0,bR.Children={$:0,$0:bR.Children,$1:bP.docNode},_8.InsertDoc(this.elt,bP.docNode,null)):bQ!=null&&bQ.$==6?(bS=this.elt.appendChild(a.document.createTextNode("")),bT=_8.InsertBeforeDelim(bS,bP.docNode),this.AddHole(_3.New(Z.Empty(this.elt),bP.docNode,{$:1,$0:[bT,bS]},this.elt,h.Int(),null))):bG.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,bP.updates));},ToUpdater:function(){var bP,bQ;return new $.New((bP=this.docNode$1,bP!=null&&bP.$==1?bA.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,bP.$0.Attr]],Render:(bQ=null,bQ?bQ.$0:void 0)},["Render"]):bP!=null&&bP.$==6?bP.$0:bG.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,w.Create$1([]));},OnAfterRenderView:function(bP,bQ){var bR,bS;bR=this;bS=h.Id();this.Append(_9.BindView(function(bT){bR.elt[bS]=bT;return _9.Empty();},bP));return this.OnAfterRender(function(bT){bQ(bT,bT[bS]);});},OnAfterRender:function(bP){var bQ,bR,bS,bT,bU,bV,bW;bQ=this.docNode$1;bQ!=null&&bQ.$==1?(bR=bQ.$0,bA.SetOptional(bR,"Render",(bS=bA.GetOptional(bR.Render),bS!=null&&bS.$==1?(bT=bS.$0,{$:1,$0:function(bX){bT(bX);bP(bX);}}):{$:1,$0:bP}))):bQ!=null&&bQ.$==6?(bU=bQ.$0,bA.SetOptional(bU,"Render",(bV=bA.GetOptional(bU.Render),bV!=null&&bV.$==1?(bW=bV.$0,{$:1,$0:function(bX){bW(bX);bP(bX);}}):{$:1,$0:bP}))):bG.FailWith("Invalid docNode in Elt");return this;},onView:function(bP,bQ,bR){var bS;bS=bR(this.elt);this.elt.addEventListener(bP,function(bT){return y.Get(bS(bT),bQ);},false);return this;},on:function(bP,bQ){this.elt.addEventListener(bP,function(bR){return bQ(bR.target,bR);},false);return this;}},_9,_);_.TreeNode=function(bP,bQ){var bR,bS;function bT(bU){return bU[1];}bR=x.Create(bQ);return new _.New$1({$:6,$0:bP},y.Map2Unit((bS=bs.map(function(bU){return Z.Updates(bT(bU));},bP.Attrs),e.TreeReduce(y.Const(),y.Map2Unit,bS)),bR.v),bs.get(bP.Els,0),bR);};_.New=function(bP,bQ,bR){var bS,bT;bS=_8.CreateElemNode(bP,bQ,bR.docNode);bT=x.Create(bR.updates);return new _.New$1({$:1,$0:bS},y.Map2Unit(Z.Updates(bS.Attr),bT.v),bP,bT);};_.New$1=bA.Ctor(function(bP,bQ,bR,bS){_9.New.call(this,bP,bQ);this.docNode$1=bP;this.updates$1=bQ;this.elt=bR;this.rvUpdates=bS;},_);$=W.EltUpdater=bA.Class({RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;w.Set(this.holeUpdates,[]);},RemoveUpdated:function(bP){var bQ,bR;function bS(bT){return bT===bR?false:true;}bQ=bP.docNode;bQ!=null&&bQ.$==1?(bR=bQ.$0.ElKey,this.treeNode.Holes=bs.filter(function(bT){return bT.ElKey!==bR;},this.treeNode.Holes),w.Set(this.holeUpdates,bs.filter(function(bT){return bS(bT[0]);},this.holeUpdates.c))):bG.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(bP){var bQ,bR,bS;bQ=bP.docNode;bQ!=null&&bQ.$==1?(bR=bQ.$0,this.treeNode.Holes=this.treeNode.Holes.concat([bR]),bS=this.holeUpdates.c,bS.push([bR.ElKey,bP.updates]),w.Set(this.holeUpdates,bS)):bG.FailWith("DocUpdater.AddUpdated expects a single element node");},ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];w.Set(this.holeUpdates,[]);},AddHole:function(bP){this.origHoles.push(bP);this.treeNode.Holes=this.treeNode.Holes.concat([bP]);}},_,$);$.New=bA.Ctor(function(bP,bQ,bR,bS,bT){var bU,bV,bW;function bX(bY){return bY[1];}_.New$1.call(this,{$:6,$0:bP},y.Map2Unit(bQ,y.BindInner((bU=function(bY){return bs.map(bX,bY);},(bV=(bW=y.Const(),function(bY){return e.TreeReduce(bW,y.Map2Unit,bY);}),function(bY){return bV(bU(bY));})),bT.v)),bR,bS);this.treeNode=bP;this.holeUpdates=bT;this.origHoles=this.treeNode.Holes;},$);ba.$cctor=function(){ba.$cctor=a.ignore;ba.LoadedTemplates=new bJ.New$5();ba.TextHoleRE="\\${([^}]+)}";};bb=d.Flow=bA.Class({get_Render:function(){return this.render;}},b.Obj,bb);bb.New=bA.Ctor(function(bP){bb.New$1.call(this,function(bQ){return function(bR){return w.Set(bQ,bP(bR));};});},bb);bb.New$1=bA.Ctor(function(bP){this.render=bP;},bb);bb.get_Do=function(){return new bc.New();};bb.Static=function(bP){return new bb.New$1(function(bQ){return function(bR){w.Set(bQ,bP);return bR();};});};bb.Define=function(bP){return new bb.New(function(bQ){return bP(function(bR){bQ(bR);});});};bb.Embed=function(bP){var bQ;bQ=w.Create$1(_9.Empty());((bP.get_Render())(bQ))(a.ignore);return _9.EmbedView(bQ.v);};bb.Return=function(bP){return new bb.New$1(function(){return function(bQ){return bQ(bP);};});};bb.Bind=function(bP,bQ){return new bb.New$1(function(bR){return function(bS){return((bP.get_Render())(bR))(function(bT){((bQ(bT).get_Render())(bR))(bS);});};});};bb.Map=function(bP,bQ){return new bb.New$1(function(bR){return function(bS){return((bQ.get_Render())(bR))(function(bT){bS(bP(bT));});};});};bc=d.FlowBuilder=bA.Class({ReturnFrom:a.id,Return:function(bP){return bb.Return(bP);},Bind:function(bP,bQ){return bb.Bind(bP,bQ);}},b.Obj,bc);bc.New=bA.Ctor(function(){},bc);be=bd.attr=bA.Class({},b.Obj,be);be.New=bA.Ctor(function(){},be);bf.Append=function(bP,bQ){return{$:0,$0:o.Append(bP.$0,bQ.$0),$1:bE.FoldBack(function(bR,bS,bT){return bT.Add(bR,bS);},bP.$1,bQ.$1)};};bf.FromList=function(bP,bQ){return{$:0,$0:o.FromArray(bs.ofList(bP)),$1:bQ};};bf.ToList=function(bP){return[br.ofArray(o.ToArray(bP.$0)),bP.$1];};bf.SameHash=function(bP,bQ){return bf.NoHash(bP)===bf.NoHash(bQ);};bf.MakeHash=function(bP){var bQ,bR;bQ=bP.$1;bR=bu.concat("/",bs.map(function(bS){return a.encodeURIComponent(bS);},o.ToArray(bP.$0)));return bQ.get_IsEmpty()?bR:bR+"?"+bu.concat("&",by.map(function(bS){var bT;bT=bG.KeyValue(bS);return a.encodeURIComponent(bT[0])+"="+a.encodeURIComponent(bT[1]);},bQ));};bf.ParseHash=function(bP){var bQ,bR,bS,bT;bQ=bf.NoHash(bP);bR=(bS=bQ.indexOf("?"),bS===-1?[bQ,""]:[bO.string(bQ,null,{$:1,$0:bS-1}),bO.string(bQ,{$:1,$0:bS+1},null)]);bT=bR[0];return{$:0,$0:o.FromArray(bT===""?[]:bs.map(function(bU){return a.decodeURIComponent(bU);},bu.SplitChars(bT,["/"],0))),$1:bE.OfArray(bs.map(function(bU){var bV;bV=bU.indexOf("=");return bV===-1?[a.decodeURIComponent(bU),""]:[a.decodeURIComponent(bO.string(bU,null,{$:1,$0:bV-1})),a.decodeURIComponent(bO.string(bU,{$:1,$0:bV+1},null))];},bu.SplitChars(bR[1],["&"],0)))};};bf.NoHash=function(bP){return bu.StartsWith(bP,"#")?bP.substring(1):bP;};bh.New=function(bP,bQ,bR,bS){return{Bodies:bP,CurrentRoute:bQ,CurrentSite:bR,Selection:bS};};bg.Install=function(bP,bQ){var bR,bS,bT,bU,bV,bW,bX;function bY(b1,b2){var b3;b3=b2.$0;return b2.$1({UpdateRoute:function(b4){bg.OnInternalSiteUpdate(bT,b3,b1,b4);}});}function bZ(b1){return s.Lookup(bU,(bf.ToList(b1))[0]);}function b0(b1){var b2;b2=bZ(b1);b2.$==1?void 0:bg.OnGlobalRouteChange(bT,b2.$0,bf.FromList(b2.$1,new bF.New([])));}bR=bQ.$0;bS=bg.InstallMap({Des:function(b1){return bf.FromList(b1[0],b1[1]);},Ser:bf.ToList});bT=bh.New(void 0,bS,0,void 0);bU=s.Map(function(b1){return function(b2){return bY(b1,b2);};},bQ.$1);bT.Bodies=bg.ComputeBodies(bU);bV=(bW=bZ(bS.c),bW.$==0?(bX=bW.$0,(bT.CurrentSite=bX.RouteId,w.Create$1(bX.RouteValue))):w.Create$1(bR!=null&&bR.$==1?bR.$0:bG.FailWith("Site.Install fails on empty site")));bT.Selection=bV;y.Sink(function(b1){bg.OnSelectSite(bT,bP(b1));},bV.v);b0(bS.c);y.Sink(b0,bS.v);return bV;};bg.OnSelectSite=function(bP,bQ){var bR;bR=bQ.$0;bP.CurrentSite!==bR?(bP.CurrentSite=bR,bP.Bodies.get_Item(bR).OnSelect()):void 0;};bg.OnInternalSiteUpdate=function(bP,bQ,bR,bS){if(bP.CurrentSite===bQ)bg.SetCurrentRoute(bP,bf.Append(bf.FromList(bR,new bF.New([])),bS));};bg.OnGlobalRouteChange=function(bP,bQ,bR){bP.CurrentSite!==bQ.RouteId?(bP.CurrentSite=bQ.RouteId,w.Set(bP.Selection,bQ.RouteValue)):void 0;bQ.OnRouteChanged(bR);};bg.SetCurrentRoute=function(bP,bQ){if(!bB.Equals(bP.CurrentRoute.c,bQ))w.Set(bP.CurrentRoute,bQ);};bg.ComputeBodies=function(bP){var bQ;bQ=new bJ.New$5();bs.iter(function(bR){bQ.set_Item(bR.RouteId,bR);},s.ToArray(bP));return bQ;};bg.MergeRouters=function(bP){var bQ,bR,bS;bQ=e.ofSeqNonCopying(bP);bR=s.Merge(by.map(function(bT){return bT.$1;},bQ));bS=by.tryPick(function(bT){return bT.$0;},bQ);return bR!=null&&bR.$==1?{$:0,$0:bS,$1:bR.$0}:bG.FailWith("Invalid Site.Merge: need more prefix disambiguation");};bg.DefineRoute=function(bP,bQ,bR){var bS,bT,bU;bS=w.Create$1(bQ);bT=h.Int();bU=bR({$:0,$0:bT},bS);return{$:0,$0:{$:1,$0:bU},$1:s.Leaf({$:0,$0:bT,$1:function(bV){y.Sink(function(bW){bV.UpdateRoute(bg.DoLink(bP,bW));},bS.v);return{OnRouteChanged:function(bW){w.Set(bS,bg.DoRoute(bP,bW));},OnSelect:function(){bV.UpdateRoute(bg.DoLink(bP,bS.c));},RouteId:bT,RouteValue:bU};}})};};bg.DoLink=function(bP,bQ){var bR;bR=bP.Ser(bQ);return bf.FromList(bR[0],bR[1]);};bg.DoRoute=function(bP,bQ){return bP.Des(bf.ToList(bQ));};bg.InstallMap=function(bP){var bQ;function bR(bV,bW){return bB.Equals(bP.Ser(bV),bP.Ser(bW));}function bS(){return bP.Des(bf.ToList(bf.ParseHash(a.location.hash)));}function bT(bV){if(!bR(bQ.c,bV))w.Set(bQ,bV);}function bU(bV){return bT(bS());}bQ=w.Create$1(bS());a.onpopstate=bU;a.onhashchange=bU;y.Sink(function(bV){var bW,bX;bW=bf.MakeHash((bX=bP.Ser(bV),bf.FromList(bX[0],bX[1])));!bf.SameHash(a.location.hash,bW)?a.location.replace("#"+bW):void 0;},bQ.v);return bQ;};bi.Install=function(bP){return bg.InstallMap(bP);};bi.Create=function(bP,bQ){function bR(bS){return bS[0];}return{Des:function(bS){return bQ(bR(bS));},Ser:function(bS){return[bP(bS),new bF.New([])];}};};bi.CreateWithQuery=function(bP,bQ){return{Des:bQ,Ser:bP};};bj.Route=function(bP,bQ,bR){return bg.DefineRoute(bP,bQ,bR);};bj.Prefix=function(bP,bQ){return{$:0,$0:bQ.$0,$1:s.Prefix(bP,bQ.$1)};};bj.Merge=function(bP){return bg.MergeRouters(bP);};bj.Install=function(bP,bQ){return bg.Install(bP,bQ);};bj.Dir=function(bP,bQ){return bj.Prefix(bP,bj.Merge(bQ));};bl.New=function(bP,bQ){return{Active:bP,PosV:bQ};};bm.New=function(bP,bQ,bR,bS){return{Active:bP,Left:bQ,Middle:bR,Right:bS};};bn.get_MousePressed=function(){bk.ActivateButtonListener();return y.Apply(y.Apply(y.Apply(y.Const(bA.Curried3(function(bP,bQ,bR){return bP||bQ||bR;})),bk.MouseBtnSt$1().Left.v),bk.MouseBtnSt$1().Middle.v),bk.MouseBtnSt$1().Right.v);};bn.get_RightPressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Right.v;};bn.get_MiddlePressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Middle.v;};bn.get_LeftPressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Left.v;};bn.get_Position=function(){!bk.MousePosSt$1().Active?(a.document.addEventListener("mousemove",function(bP){w.Set(bk.MousePosSt$1().PosV,[bP.clientX,bP.clientY]);},false),bk.MousePosSt$1().Active=true):void 0;return bk.MousePosSt$1().PosV.v;};bo.New=function(bP,bQ,bR){return{KeysPressed:bP,KeyListenerActive:bQ,LastPressed:bR};};bp.IsPressed=function(bP){function bQ(bR){return bR===bP;}bk.ActivateKeyListener();return y.Map(function(bR){return br.exists(bQ,bR);},bk.KeyListenerState().KeysPressed.v);};bp.get_LastPressed=function(){bk.ActivateKeyListener();return bk.KeyListenerState().LastPressed.v;};bp.get_KeysPressed=function(){bk.ActivateKeyListener();return bk.KeyListenerState().KeysPressed.v;};bk.ActivateKeyListener=function(){bq.$cctor();return bq.ActivateKeyListener;};bk.KeyListenerState=function(){bq.$cctor();return bq.KeyListenerState;};bk.ActivateButtonListener=function(){bq.$cctor();return bq.ActivateButtonListener;};bk.MouseBtnSt$1=function(){bq.$cctor();return bq.MouseBtnSt;};bk.MousePosSt$1=function(){bq.$cctor();return bq.MousePosSt;};bq.$cctor=function(){bq.$cctor=a.ignore;function bP(bQ,bR){var bS;bS=bQ.button;return bS===0?w.Set(bk.MouseBtnSt$1().Left,bR):bS===1?w.Set(bk.MouseBtnSt$1().Middle,bR):bS===2?w.Set(bk.MouseBtnSt$1().Right,bR):null;}bq.MousePosSt=bl.New(false,w.Create$1([0,0]));bq.MouseBtnSt=bm.New(false,w.Create$1(false),w.Create$1(false),w.Create$1(false));bq.ActivateButtonListener=!bk.MouseBtnSt$1().Active?(bk.MouseBtnSt$1().Active=true,a.document.addEventListener("mousedown",function(bQ){return bP(bQ,true);},false),a.document.addEventListener("mouseup",function(bQ){return bP(bQ,false);},false)):null;bq.KeyListenerState=bo.New(w.Create$1(br.T.Empty),false,w.Create$1(-1));bq.ActivateKeyListener=!bk.KeyListenerState().KeyListenerActive?(bN(a.document).keydown(function(bQ){var bR,bS;bR=bQ.which;w.Set(bk.KeyListenerState().LastPressed,bR);bS=bk.KeyListenerState().KeysPressed.c;return!br.exists(function(bT){return bT===bR;},bS)?w.Set(bk.KeyListenerState().KeysPressed,br.append(bS,br.ofArray([bR]))):null;}),void bN(a.document).keyup(function(bQ){var bR;function bS(bT){return bT!==bR;}bR=bQ.which;return w.Update(bk.KeyListenerState().KeysPressed,function(bT){return br.filter(bS,bT);});})):null;};}());
