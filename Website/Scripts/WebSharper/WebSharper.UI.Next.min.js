(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP;a=self;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Next=c.Next||{};e=d.Array=d.Array||{};f=d.String=d.String||{};g=d.Abbrev=d.Abbrev||{};h=g.Fresh=g.Fresh||{};i=g.HashSet=g.HashSet||{};j=g.Dict=g.Dict||{};k=b&&b.Obj;l=g.Slot=g.Slot||{};m=g.Async=g.Async||{};n=g.Mailbox=g.Mailbox||{};o=a.StartupCode$WebSharper_UI_Next$Abbrev=a.StartupCode$WebSharper_UI_Next$Abbrev||{};p=d.AppendList=d.AppendList||{};q=a.StartupCode$WebSharper_UI_Next$AppendList=a.StartupCode$WebSharper_UI_Next$AppendList||{};r=d.DomUtility=d.DomUtility||{};s=a.StartupCode$WebSharper_UI_Next$DomUtility=a.StartupCode$WebSharper_UI_Next$DomUtility||{};t=d.Trie=d.Trie||{};u=t.LookupResult=t.LookupResult||{};v=a.StartupCode$WebSharper_UI_Next$Trie=a.StartupCode$WebSharper_UI_Next$Trie||{};w=d.Snap=d.Snap||{};x=d.Var=d.Var||{};y=d.Updates=d.Updates||{};z=d.View=d.View||{};A=d.ViewBuilder=d.ViewBuilder||{};B=d.Submitter=d.Submitter||{};C=d.Key=d.Key||{};D=d.Model=d.Model||{};E=d.Serializer=d.Serializer||{};F=d.Storage=d.Storage||{};G=F.ArrayStorage=F.ArrayStorage||{};H=F.LocalStorageBackend=F.LocalStorageBackend||{};I=d.ListModel=d.ListModel||{};J=d.ListModels=d.ListModels||{};K=a.StartupCode$WebSharper_UI_Next$Models=a.StartupCode$WebSharper_UI_Next$Models||{};L=d.ReactiveExtensions=d.ReactiveExtensions||{};M=d.DoubleInterpolation=d.DoubleInterpolation||{};N=d.Interpolation=d.Interpolation||{};O=d.Easing=d.Easing||{};P=d.Easings=d.Easings||{};Q=d.An=d.An||{};R=d.Anims=d.Anims||{};S=d.Trans=d.Trans||{};T=a.StartupCode$WebSharper_UI_Next$Animation=a.StartupCode$WebSharper_UI_Next$Animation||{};U=d.AnimatedAttrNode=d.AnimatedAttrNode||{};V=d.DynamicAttrNode=d.DynamicAttrNode||{};W=d.AttrProxy=d.AttrProxy||{};X=d.Client=d.Client||{};Y=X.Attrs=X.Attrs||{};Z=Y.Dyn=Y.Dyn||{};_0=d.Attrs=d.Attrs||{};_1=d.CheckedInput=d.CheckedInput||{};_2=d.AttrModule=d.AttrModule||{};_3=a.StartupCode$WebSharper_UI_Next$Attr_Client=a.StartupCode$WebSharper_UI_Next$Attr_Client||{};_4=d.DocElemNode=d.DocElemNode||{};_5=X.Docs=X.Docs||{};_6=_5.DomNodes=_5.DomNodes||{};_7=_5.NodeSet=_5.NodeSet||{};_8=_5.RunState=_5.RunState||{};_9=d.Docs=d.Docs||{};_=d.Doc=d.Doc||{};$=d.Elt=d.Elt||{};ba=X.EltUpdater=X.EltUpdater||{};bb=a.StartupCode$WebSharper_UI_Next$Doc_Client=a.StartupCode$WebSharper_UI_Next$Doc_Client||{};bc=d.Flow=d.Flow||{};bd=d.FlowBuilder=d.FlowBuilder||{};be=d.Html=d.Html||{};bf=be.attr=be.attr||{};bg=d.Route=d.Route||{};bh=d.Routing=d.Routing||{};bi=bh.State=bh.State||{};bj=d.RouteMap=d.RouteMap||{};bk=d.Router=d.Router||{};bl=d.Input=d.Input||{};bm=bl.MousePosSt=bl.MousePosSt||{};bn=bl.MouseBtnSt=bl.MouseBtnSt||{};bo=bl.Mouse=bl.Mouse||{};bp=bl.KeyListenerSt=bl.KeyListenerSt||{};bq=bl.Keyboard=bl.Keyboard||{};br=a.StartupCode$WebSharper_UI_Next$Input=a.StartupCode$WebSharper_UI_Next$Input||{};bs=b&&b.List;bt=b&&b.Arrays;bu=b&&b.Enumerator;bv=b&&b.Strings;bw=b&&b.Char;bx=b&&b.Collections;by=bx&&bx.HashSet;bz=b&&b.Seq;bA=a.IntelliFactory;bB=bA&&bA.Runtime;bC=b&&b.Unchecked;bD=a.console;bE=b&&b.Concurrency;bF=bx&&bx.Map;bG=bx&&bx.FSharpMap;bH=b&&b.Operators;bI=b&&b.Queue;bJ=b&&b.Lazy;bK=bx&&bx.Dictionary;bL=a.JSON;bM=b&&b.Numeric;bN=a.Node;bO=a.jQuery;bP=b&&b.Slice;e.mapInPlace=function(bQ,bR){var bS,bT;for(bS=0,bT=bR.length-1;bS<=bT;bS++)bR[bS]=bQ(bR[bS]);return bR;};e.ofSeqNonCopying=function(bQ){var bR,bS;if(bQ instanceof a.Array)return bQ;else if(bQ instanceof bs.T)return bt.ofList(bQ);else if(bQ===null)return[];else{bR=[];bS=bu.Get(bQ);try{while(bS.MoveNext())bR.push(bS.Current());return bR;}finally{if(typeof bS=="object"&&"Dispose"in bS)bS.Dispose();}}};e.MapTreeReduce=function(bQ,bR,bS,bT){var bU;function bV(bW,bX){var bY,bZ;return bX<=0?bR:bX===1&&(bW>=0&&bW<bU)?bQ(bt.get(bT,bW)):(bZ=bX/2>>0,bS(bV(bW,bZ),bV(bW+bZ,bX-bZ)));}bU=bt.length(bT);return bV(0,bU);};e.TreeReduce=function(bQ,bR,bS){var bT;function bU(bV,bW){var bX,bY;return bW<=0?bQ:bW===1&&(bV>=0&&bV<bT)?bt.get(bS,bV):(bY=bW/2>>0,bR(bU(bV,bY),bU(bV+bY,bW-bY)));}bT=bt.length(bS);return bU(0,bT);};f.isBlank=function(bQ){return bv.forall(bw.IsWhiteSpace,bQ);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){o.$cctor();return o.counter;};h.set_counter=function(bQ){o.$cctor();o.counter=bQ;};i.Filter=function(bQ,bR){return new by.New$2(bt.filter(bQ,i.ToArray(bR)));};i.Intersect=function(bQ,bR){var bS;bS=new by.New$2(i.ToArray(bQ));bS.IntersectWith(i.ToArray(bR));return bS;};i.Except=function(bQ,bR){var bS;bS=new by.New$2(i.ToArray(bR));bS.ExceptWith(i.ToArray(bQ));return bS;};i.ToArray=function(bQ){var bR;bR=bt.create(bQ.get_Count(),void 0);bQ.CopyTo(bR);return bR;};j.ToValueArray=function(bQ){var bR;bR=bt.create(bQ.count,void 0);bz.iteri(function(bS,bT){return bt.set(bR,bS,bT.V);},bQ);return bR;};j.ToKeyArray=function(bQ){var bR;bR=bt.create(bQ.count,void 0);bz.iteri(function(bS,bT){return bt.set(bR,bS,bT.K);},bQ);return bR;};l=g.Slot=bB.Class({GetHashCode:function(){return bC.Hash(this.key(this.value));},Equals:function(bQ){return bC.Equals(this.key(this.value),this.key(bQ.get_Value()));},get_Value:function(){return this.value;}},k,l);l.New=bB.Ctor(function(bQ,bR){k.New.call(this);this.key=bQ;this.value=bR;},l);l.Create=function(bQ,bR){return new l.New(bQ,bR);};m.OnError=function(bQ){return bD.log("WebSharper UI.Next: Uncaught asynchronous exception",bQ);};m.StartTo=function(bQ,bR){bE.StartWithContinuations(bQ,bR,function(bS){m.OnError(bS);},a.ignore,null);};n.StartProcessor=function(bQ){var bR;function bS(){var bT;bT=null;return bE.Delay(function(){return bE.Bind(bQ,function(){var bU;bU=bR[0];return bU===1?(bR[0]=0,bE.Zero()):bU===2?(bR[0]=1,bS()):bE.Zero();});});}bR=[0];return function(){var bT;bT=bR[0];bT===0?(bR[0]=1,bE.Start(bS(),null)):bT===1?bR[0]=2:void 0;};};o.$cctor=function(){o.$cctor=a.ignore;o.counter=0;};p.FromArray=function(bQ){var bR;bR=bQ.length;return bR===0?{$:0}:bR===1?{$:1,$0:bt.get(bQ,0)}:{$:3,$0:bQ.slice()};};p.ToArray=function(bQ){var bR;function bS(bT){if(bT.$==1)bR.push(bT.$0);else if(bT.$==2){bS(bT.$0);bS(bT.$1);}else if(bT.$==3)bt.iter(function(bU){bR.push(bU);},bT.$0);}bR=[];bS(bQ);return bR.slice(0);};p.Single=function(bQ){return{$:1,$0:bQ};};p.Concat=function(bQ){var bR;bR=e.ofSeqNonCopying(bQ);return e.TreeReduce(p.Empty(),p.Append,bR);};p.Append=function(bQ,bR){return bQ.$==0?bR:bR.$==0?bQ:{$:2,$0:bQ,$1:bR};};p.Empty=function(){q.$cctor();return q.Empty;};q.$cctor=function(){q.$cctor=a.ignore;q.Empty={$:0};};r.SetProperty=function(bQ,bR,bS){return bQ.setProperty(bR,bS);};r.IterSelector=function(bQ,bR,bS){var bT,bU,bV;bT=bQ.querySelectorAll(bR);for(bU=0,bV=bT.length-1;bU<=bV;bU++)bS(bT[bU]);};r.ChildrenArray=function(bQ){var bR,bS,bT;bR=[];for(bS=0,bT=bQ.childNodes.length-1;bS<=bT;bS++)bR.push(bQ.childNodes[bS]);return bR;};r.RemoveClass=function(bQ,bR){a.jQuery(bQ).removeClass(bR);};r.AddClass=function(bQ,bR){a.jQuery(bQ).addClass(bR);};r.InsertAt=function(bQ,bR,bS){var bT;if(!(bS.parentNode===bQ&&bR===(bT=bS.nextSibling,bC.Equals(bT,null)?null:bT)))bQ.insertBefore(bS,bR);};r.RemoveNode=function(bQ,bR){if(bR.parentNode===bQ)bQ.removeChild(bR);};r.SetStyle=function(bQ,bR,bS){r.SetProperty(bQ.style,bR,bS);};r.SetAttr=function(bQ,bR,bS){bQ.setAttribute(bR,bS);};r.RemoveAttr=function(bQ,bR){bQ.removeAttribute(bR);};r.CreateAttr=function(bQ,bR){var bS;bS=r.Doc().createAttribute(bQ);bS.value=bR;return bS;};r.CreateText=function(bQ){return r.Doc().createTextNode(bQ);};r.CreateSvgElement=function(bQ){return r.Doc().createElementNS("http://www.w3.org/2000/svg",bQ);};r.CreateElement=function(bQ){return r.Doc().createElement(bQ);};r.Clear=function(bQ){while(bQ.hasChildNodes())bQ.removeChild(bQ.firstChild);};r.ClearAttrs=function(bQ){while(bQ.hasAttributes())bQ.removeAttributeNode(bQ.attributes.item(0));};r.AppendTo=function(bQ,bR){bQ.appendChild(bR);};r.Doc=function(){s.$cctor();return s.Doc;};s.$cctor=function(){s.$cctor=a.ignore;s.Doc=self.document;};u.NotFound={$:1};t.Empty=function(){v.$cctor();return v.Empty;};t.Lookup=function(bQ,bR){return t.Look(bs.ofSeq(bR),bQ);};t.Look=function(bQ,bR){var bS,bT;switch(bR.$==2?(bS=bR.$0,0):bR.$==0?bQ.$==1?(bS=[bQ.$0,bQ.$1,bR.$0],1):2:2){case 0:return{$:0,$0:bS,$1:bQ};case 1:bT=bF.TryFind(bS[0],bS[2]);return bT==null?u.NotFound:t.Look(bS[1],bT.$0);case 2:return u.NotFound;}};t.ToArray=function(bQ){var bR;bR=[];t.Map(function(){return function(bS){return bR.push(bS);};},bQ);return bR.slice(0);};t.Mapi=function(bQ,bR){var bS;function bT(){var bU;bU=bS[0];bS[0]=bU+1;return bU;}bS=[0];return t.Map(function(bU){return bQ(bT(),bU);},bR);};t.Map=function(bQ,bR){return t.MapLoop(bs.T.Empty,bQ,bR);};t.MapLoop=function(bQ,bR,bS){return bS.$==1?{$:1}:bS.$==2?{$:2,$0:(bR(bQ))(bS.$0)}:t.TrieBranch(bF.Map(function(bT,bU){return t.MapLoop(bs.append(bQ,bs.ofArray([bT])),bR,bU);},bS.$0));};t.Merge=function(bQ){var bR,bS,bT;bR=e.ofSeqNonCopying(bQ);bS=bt.length(bR);return bS===0?{$:1,$0:{$:1}}:bS===1?{$:1,$0:bt.get(bR,0)}:bt.exists(t.IsLeaf,bR)?null:(bT=t.MergeMaps(t.Merge,bz.choose(function(bU){return bU.$==0?{$:1,$0:bU.$0}:null;},bR)),bT==null?null:{$:1,$0:t.TrieBranch(bT.$0)});};t.IsLeaf=function(bQ){return bQ.$==2;};t.MergeMaps=function(bQ,bR){var bS,bT;function bU(bV,bW){var bX;bX=bQ(bW);return bX==null?null:{$:1,$0:[bV,bX.$0]};}bS=t.AllSome(bz.map(function(bV){return bU(bV[0],bV[1]);},bF.ToSeq((bT=bz.collect(bF.ToSeq,bR),bz.fold(function(bV,bW){return t.MultiAdd(bW[0],bW[1],bV);},new bG.New([]),bT)))));return bS==null?null:{$:1,$0:bF.OfArray(bt.ofSeq(bS.$0))};};t.AllSome=function(bQ){var bR,bS,bT,bU;bS=bu.Get(bQ);bT=[];bR=true;while(bR&&bS.MoveNext()){bU=bS.Current();bU!=null&&bU.$==1?bT.push(bU.$0):bR=false;}return bR?{$:1,$0:bT.slice()}:null;};t.MultiAdd=function(bQ,bR,bS){return bS.Add(bQ,new bs.T({$:1,$0:bR,$1:t.MultiFind(bQ,bS)}));};t.MultiFind=function(bQ,bR){var bS;bS=bF.TryFind(bQ,bR);return bS==null?bs.T.Empty:bS.$0;};t.Prefix=function(bQ,bR){return t.TrieBranch(new bG.New(bs.ofArray([[bQ,bR]])));};t.Leaf=function(bQ){return{$:2,$0:bQ};};t.TrieBranch=function(bQ){return bQ.get_IsEmpty()?{$:1}:{$:0,$0:bQ};};v.$cctor=function(){v.$cctor=a.ignore;v.Empty={$:1};};w.Obsolete=function(bQ){var bR,bS,bT,bU,bV;bS=bQ.s;if(bS==null||(bS!=null&&bS.$==2?(bR=bS.$1,false):bS!=null&&bS.$==3?(bR=bS.$1,false):true))void 0;else{bQ.s=null;for(bT=0,bU=bt.length(bR)-1;bT<=bU;bT++){bV=bt.get(bR,bT);typeof bV=="object"?function(bW){w.Obsolete(bW);}(bV):bV();}}};w.New=function(bQ){return{s:bQ};};w.MapAsync=function(bQ,bR){var bS;bS=w.New({$:3,$0:[],$1:[]});w.When(bR,function(bT){m.StartTo(bQ(bT),function(bU){w.MarkDone(bS,bR,bU);});},bS);return bS;};w.SnapshotOn=function(bQ,bR){var bS;function bT(bU){var bV,bW,bX;if(!(bV=bS.s,bV!=null&&bV.$==0||bV!=null&&bV.$==2)){bW=w.ValueAndForever(bQ);bX=w.ValueAndForever(bR);bW!=null&&bW.$==1?bX!=null&&bX.$==1?bW.$0[1]||bX.$0[1]?w.MarkForever(bS,bX.$0[0]):w.MarkReady(bS,bX.$0[0]):void 0:void 0;}}bS=w.New({$:3,$0:[],$1:[]});w.When(bQ,bT,bS);w.WhenReady(bR,bT);return bS;};w.Map3=function(bQ,bR,bS,bT){var bU,bV,bW,bX;function bY(bZ){var b0,b1,b2,b3;if(!(b0=bX.s,b0!=null&&b0.$==0||b0!=null&&b0.$==2)){b1=w.ValueAndForever(bR);b2=w.ValueAndForever(bS);b3=w.ValueAndForever(bT);b1!=null&&b1.$==1?b2!=null&&b2.$==1?b3!=null&&b3.$==1?b1.$0[1]&&b2.$0[1]&&b3.$0[1]?w.MarkForever(bX,bQ(b1.$0[0],b2.$0[0],b3.$0[0])):w.MarkReady(bX,bQ(b1.$0[0],b2.$0[0],b3.$0[0])):void 0:void 0:void 0;}}bU=bR.s;bV=bS.s;bW=bT.s;return bU!=null&&bU.$==0?bV!=null&&bV.$==0?bW!=null&&bW.$==0?w.New({$:0,$0:bQ(bU.$0,bV.$0,bW.$0)}):w.Map3Opt1(bQ,bU.$0,bV.$0,bT):bW!=null&&bW.$==0?w.Map3Opt2(bQ,bU.$0,bW.$0,bS):w.Map3Opt3(bQ,bU.$0,bS,bT):bV!=null&&bV.$==0?bW!=null&&bW.$==0?w.Map3Opt4(bQ,bV.$0,bW.$0,bR):w.Map3Opt5(bQ,bV.$0,bR,bT):bW!=null&&bW.$==0?w.Map3Opt6(bQ,bW.$0,bR,bS):(bX=w.New({$:3,$0:[],$1:[]}),(w.When(bR,bY,bX),w.When(bS,bY,bX),w.When(bT,bY,bX),bX));};w.Map3Opt6=function(bQ,bR,bS,bT){return w.Map2(function(bU,bV){return bQ(bU,bV,bR);},bS,bT);};w.Map3Opt5=function(bQ,bR,bS,bT){return w.Map2(function(bU,bV){return bQ(bU,bR,bV);},bS,bT);};w.Map3Opt4=function(bQ,bR,bS,bT){return w.Map(function(bU){return bQ(bU,bR,bS);},bT);};w.Map3Opt3=function(bQ,bR,bS,bT){return w.Map2(function(bU,bV){return bQ(bR,bU,bV);},bS,bT);};w.Map3Opt2=function(bQ,bR,bS,bT){return w.Map(function(bU){return bQ(bR,bU,bS);},bT);};w.Map3Opt1=function(bQ,bR,bS,bT){return w.Map(function(bU){return bQ(bR,bS,bU);},bT);};w.Map2Unit=function(bQ,bR){var bS,bT,bU;function bV(){var bW,bX,bY;if(!(bW=bU.s,bW!=null&&bW.$==0||bW!=null&&bW.$==2)){bX=w.ValueAndForever(bQ);bY=w.ValueAndForever(bR);bX!=null&&bX.$==1?bY!=null&&bY.$==1?bX.$0[1]&&bY.$0[1]?w.MarkForever(bU,null):w.MarkReady(bU,null):void 0:void 0;}}bS=bQ.s;bT=bR.s;return bS!=null&&bS.$==0?bT!=null&&bT.$==0?w.New({$:0,$0:null}):bR:bT!=null&&bT.$==0?bQ:(bU=w.New({$:3,$0:[],$1:[]}),(w.When(bQ,bV,bU),w.When(bR,bV,bU),bU));};w.Map2=function(bQ,bR,bS){var bT,bU,bV;function bW(bX){var bY,bZ,b0;if(!(bY=bV.s,bY!=null&&bY.$==0||bY!=null&&bY.$==2)){bZ=w.ValueAndForever(bR);b0=w.ValueAndForever(bS);bZ!=null&&bZ.$==1?b0!=null&&b0.$==1?bZ.$0[1]&&b0.$0[1]?w.MarkForever(bV,bQ(bZ.$0[0],b0.$0[0])):w.MarkReady(bV,bQ(bZ.$0[0],b0.$0[0])):void 0:void 0;}}bT=bR.s;bU=bS.s;return bT!=null&&bT.$==0?bU!=null&&bU.$==0?w.New({$:0,$0:bQ(bT.$0,bU.$0)}):w.Map2Opt1(bQ,bT.$0,bS):bU!=null&&bU.$==0?w.Map2Opt2(bQ,bU.$0,bR):(bV=w.New({$:3,$0:[],$1:[]}),(w.When(bR,bW,bV),w.When(bS,bW,bV),bV));};w.Map2Opt2=function(bQ,bR,bS){return w.Map(function(bT){return bQ(bT,bR);},bS);};w.Map2Opt1=function(bQ,bR,bS){return w.Map(function(bT){return bQ(bR,bT);},bS);};w.MapCachedBy=function(bQ,bR,bS,bT){return w.Map(function(bU){var bV,bW,bX;bV=bR[0];return bV!=null&&bV.$==1&&(bQ(bU,bV.$0[0])&&(bW=[bV.$0[0],bV.$0[1]],true))?bW[1]:(bX=bS(bU),(bR[0]={$:1,$0:[bU,bX]},bX));},bT);};w.Copy=function(bQ){var bR,bS,bT;bR=bQ.s;return bR==null?bQ:bR!=null&&bR.$==2?(bS=w.New({$:2,$0:bR.$0,$1:[]}),(w.WhenObsolete(bQ,bS),bS)):bR!=null&&bR.$==3?(bT=w.New({$:3,$0:[],$1:[]}),(w.When(bQ,function(bU){w.MarkDone(bT,bQ,bU);},bT),bT)):bQ;};w.Map=function(bQ,bR){var bS,bT;bS=bR.s;return bS!=null&&bS.$==0?w.New({$:0,$0:bQ(bS.$0)}):(bT=w.New({$:3,$0:[],$1:[]}),(w.When(bR,function(bU){w.MarkDone(bT,bR,bQ(bU));},bT),bT));};w.Sequence=function(bQ){var bR,bS,bT;function bU(bV){var bW;if(bT[0]===0){bW=bt.map(function(bX){var bY;bY=bX.s;return bY!=null&&bY.$==0?bY.$0:bY!=null&&bY.$==2?bY.$0:bH.FailWith("value not found by View.Sequence");},bR);bt.forall(function(bX){var bY;bY=bX.s;return bY!=null&&bY.$==0;},bR)?w.MarkForever(bS,bW):w.MarkReady(bS,bW);}else bT[0]--;}bR=bt.ofSeq(bQ);return bR.length==0?w.New({$:0,$0:[]}):(bS=w.New({$:3,$0:[],$1:[]}),(bT=[bt.length(bR)-1],(bt.iter(function(bV){w.When(bV,bU,bS);},bR),bS)));};w.CreateForeverAsync=function(bQ){var bR;bR=w.New({$:3,$0:[],$1:[]});m.StartTo(bQ,function(bS){w.MarkForever(bR,bS);});return bR;};w.JoinInner=function(bQ){var bR;bR=w.New({$:3,$0:[],$1:[]});w.When(bQ,function(bS){var bT;bT=bS();w.When(bT,function(bU){var bV,bW;if((bV=bT.s,bV!=null&&bV.$==0)&&(bW=bQ.s,bW!=null&&bW.$==0))w.MarkForever(bR,bU);else w.MarkReady(bR,bU);},bR);w.WhenObsolete(bQ,bT);},bR);return bR;};w.Join=function(bQ){var bR;bR=w.New({$:3,$0:[],$1:[]});w.When(bQ,function(bS){var bT;bT=bS();w.When(bT,function(bU){var bV,bW;if((bV=bT.s,bV!=null&&bV.$==0)&&(bW=bQ.s,bW!=null&&bW.$==0))w.MarkForever(bR,bU);else w.MarkReady(bR,bU);},bR);},bR);return bR;};w.ValueAndForever=function(bQ){var bR;bR=bQ.s;return bR!=null&&bR.$==0?{$:1,$0:[bR.$0,true]}:bR!=null&&bR.$==2?{$:1,$0:[bR.$0,false]}:null;};w.WhenObsoleteRun=function(bQ,bR){var bS;bS=bQ.s;bS==null?bR():bS!=null&&bS.$==2?bS.$1.push(bR):bS!=null&&bS.$==3?bS.$1.push(bR):void 0;};w.WhenObsolete=function(bQ,bR){var bS;bS=bQ.s;bS==null?w.Obsolete(bR):bS!=null&&bS.$==2?w.EnqueueSafe(bS.$1,bR):bS!=null&&bS.$==3?w.EnqueueSafe(bS.$1,bR):void 0;};w.WhenReady=function(bQ,bR){var bS,bT;bT=bQ.s;switch(bT!=null&&bT.$==2?(bS=bT.$0,0):bT==null?1:bT!=null&&bT.$==3?2:(bS=bT.$0,0)){case 0:bR(bS);break;case 1:null;break;case 2:bT.$0.push(bR);break;}};w.WhenRun=function(bQ,bR,bS){var bT;bT=bQ.s;bT==null?bS():bT!=null&&bT.$==2?(bT.$1.push(bS),bR(bT.$0)):bT!=null&&bT.$==3?(bT.$0.push(bR),bT.$1.push(bS)):bR(bT.$0);};w.When=function(bQ,bR,bS){var bT;bT=bQ.s;bT==null?w.Obsolete(bS):bT!=null&&bT.$==2?(w.EnqueueSafe(bT.$1,bS),bR(bT.$0)):bT!=null&&bT.$==3?(bT.$0.push(bR),w.EnqueueSafe(bT.$1,bS)):bR(bT.$0);};w.EnqueueSafe=function(bQ,bR){var bS,bT,bU,bV;bQ.push(bR);if(bQ.length%20===0){bS=bQ.slice(0);bI.Clear(bQ);for(bT=0,bU=bt.length(bS)-1;bT<=bU;bT++){bV=bt.get(bS,bT);typeof bV=="object"?function(bW){if(bW.s)bQ.push(bW);}(bV):function(bW){bQ.push(bW);}(bV);}}else void 0;};w.MarkDone=function(bQ,bR,bS){var bT;if(bT=bR.s,bT!=null&&bT.$==0)w.MarkForever(bQ,bS);else w.MarkReady(bQ,bS);};w.MarkReady=function(bQ,bR){var bS,bT,bU,bV;bS=bQ.s;if(bS!=null&&bS.$==3){bQ.s={$:2,$0:bR,$1:bS.$1};bT=bS.$0;for(bU=0,bV=bt.length(bT)-1;bU<=bV;bU++)(bt.get(bT,bU))(bR);}else void 0;};w.MarkForever=function(bQ,bR){var bS,bT,bU,bV;bS=bQ.s;if(bS!=null&&bS.$==3){bQ.s={$:0,$0:bR};bT=bS.$0;for(bU=0,bV=bt.length(bT)-1;bU<=bV;bU++)(bt.get(bT,bU))(bR);}else void 0;};x=d.Var=bB.Class({RId:function(){return"uinref"+a.String(this.i);},RView:function(){return this.v;},RUpdM:function(bQ){var bR;bR=bQ(this.c);bR!=null&&bR.$==1?x.Set(this,bR.$0):void 0;},RUpd:function(bQ){x.Update(this,bQ);},set_RVal:function(bQ){x.Set(this,bQ);},RVal:function(){return this.c;},RSet:function(bQ){x.Set(this,bQ);},RGet:function(){return this.c;}},null,x);x.New=function(bQ,bR,bS,bT,bU){return new x({o:bQ,c:bR,s:bS,i:bT,v:bU});};x.Lens=function(bQ,bR,bS){var bT,bU,bV;bT=h.Id();bU=z.Map(bR,bQ.RView());bV={RGet:function(){return bR(bQ.RGet());},RSet:function(bW){return bQ.RUpd(function(bX){return bS(bX,bW);});},RVal:function(){return bR(bQ.RGet());},set_RVal:function(bW){return bQ.RUpd(function(bX){return bS(bX,bW);});},RUpd:function(bW){return bQ.RUpd(function(bX){return bS(bX,bW(bR(bX)));});},RUpdM:function(bW){return bQ.RUpdM(function(bX){var bY;bY=bW(bR(bX));return bY==null?null:{$:1,$0:bS(bX,bY.$0)};});},RView:function(){return bU;},RId:function(){return bT;}};k.New.call(bV);return bV;};x.Update=function(bQ,bR){x.Set(bQ,bR(bQ.c));};x.SetFinal=function(bQ,bR){if(bQ.o)(function(bS){return bS("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bS){bD.log(bS);}));else{w.Obsolete(bQ.s);bQ.o=true;bQ.c=bR;bQ.s=w.New({$:0,$0:bR});}};x.Set=function(bQ,bR){if(bQ.o)(function(bS){return bS("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bS){bD.log(bS);}));else{w.Obsolete(bQ.s);bQ.c=bR;bQ.s=w.New({$:2,$0:bR,$1:[]});}};x.CreateWaiting=function(){var bQ;bQ=null;bQ=x.New(false,null,w.New({$:3,$0:[],$1:[]}),h.Int(),function(){return bQ.s;});return bQ;};x.Create=function(){var bQ;bQ=null;bQ=x.New(false,null,w.New({$:2,$0:null,$1:[]}),h.Int(),function(){return bQ.s;});return bQ;};x.CreateLogged=function(bQ,bR){var bS;!self.UINVars?self.UINVars=[]:void 0;bS=x.Create$1(bR);self.UINVars.push([bQ,bS]);return bS;};x.Create$1=function(bQ){var bR;bR=null;bR=x.New(false,bQ,w.New({$:2,$0:bQ,$1:[]}),h.Int(),function(){return bR.s;});return bR;};y=d.Updates=bB.Class({set_Value:function(bQ){var bR;bR=this.s;!(bR===null)?w.Obsolete(bR):void 0;this.c=bQ;}},null,y);y.Create=function(bQ){var bR;bR=null;bR=y.New(bQ,null,function(){var bS;bS=bR.s;return bS===null?(bS=w.Copy(bR.c()),bR.s=bS,w.WhenObsoleteRun(bS,function(){bR.s=null;}),bS):bS;});return bR;};y.New=function(bQ,bR,bS){return new y({c:bQ,s:bR,v:bS});};z.get_Do=function(){return A.B;};z.Apply=function(bQ,bR){return z.Map2(function(bS,bT){return bS(bT);},bQ,bR);};z.AsyncAwait=function(bQ,bR){function bS(bT){var bU,bV;function bW(){return z.RemovableSink(function(bX){if(bQ(bX)){(bJ.Force(bU))();bT(bX);}},bR);}bU=bJ.Create(bW);bV=bJ.Force(bU);}return bE.FromContinuations(function(bT,bU,bV){return bS.apply(null,[bT,bU,bV]);});};z.RemovableSink=function(bQ,bR){var bS;function bT(){w.WhenRun(bR(),function(bU){if(bS[0])bQ(bU);},function(){if(bS[0])bE.scheduler().Fork(bT);});}bS=[true];bE.scheduler().Fork(bT);return function(){bS[0]=false;};};z.Sink=function(bQ,bR){function bS(){w.WhenRun(bR(),bQ,function(){bE.scheduler().Fork(bS);});}bE.scheduler().Fork(bS);};z.TryFinally=function(bQ,bR){return z.CreateLazy(function(){try{return bR();}finally{bQ();}});};z.TryWith=function(bQ,bR){return z.CreateLazy(function(){try{return bR();}catch(bS){return(bQ(bS))();}});};z.ConstAsync=function(bQ){var bR;bR=w.CreateForeverAsync(bQ);return function(){return bR;};};z.Const=function(bQ){var bR;bR=w.New({$:0,$0:bQ});return function(){return bR;};};z.Sequence=function(bQ){return z.CreateLazy(function(){return w.Sequence(bz.map(function(bR){return bR();},bQ));});};z.UpdateWhile=function(bQ,bR,bS){var bT;bT=[bQ];return z.BindInner(function(bU){return bU?z.Map(function(bV){bT[0]=bV;return bV;},bS):z.Const(bT[0]);},bR);};z.BindInner=function(bQ,bR){return z.JoinInner(z.Map(bQ,bR));};z.JoinInner=function(bQ){return z.CreateLazy(function(){return w.JoinInner(bQ());});};z.Bind=function(bQ,bR){return z.Join(z.Map(bQ,bR));};z.Join=function(bQ){return z.CreateLazy(function(){return w.Join(bQ());});};z.MapSeqCachedView=function(bQ,bR){function bS(bT){return bQ;}return z.MapSeqCachedViewBy(a.id,function(bT,bU){return(bS(bT))(bU);},bR);};z.MapSeqCachedViewBy=function(bQ,bR,bS){var bT;bT=[new bK.New$5()];return z.Map(function(bU){var bV,bW,bX;bV=bT[0];bW=new bK.New$5();bX=e.mapInPlace(function(bY){var bZ,b0,b1;bZ=bQ(bY);b0=bV.ContainsKey(bZ)?(b1=bV.get_Item(bZ),(x.Set(b1.r,bY),b1)):z.ConvertSeqNode(function(b2){return bR(bZ,b2);},bY);bW.set_Item(bZ,b0);return b0.e;},bt.ofSeq(bU));bT[0]=bW;return bX;},bS);};z.ConvertSeqNode=function(bQ,bR){var bS,bT;bS=x.Create$1(bR);bT=bS.v;return{e:bQ(bT),r:bS,w:bT};};z.MapSeqCached=function(bQ,bR){return z.MapSeqCachedBy(a.id,bQ,bR);};z.MapSeqCachedBy=function(bQ,bR,bS){var bT;bT=[new bK.New$5()];return z.Map(function(bU){var bV,bW,bX;bV=bT[0];bW=new bK.New$5();bX=e.mapInPlace(function(bY){var bZ,b0;bZ=bQ(bY);b0=bV.ContainsKey(bZ)?bV.get_Item(bZ):bR(bY);bW.set_Item(bZ,b0);return b0;},bt.ofSeq(bU));bT[0]=bW;return bX;},bS);};z.SnapshotOn=function(bQ,bR,bS){var bT;bT=w.New({$:2,$0:bQ,$1:[]});return z.CreateLazy(function(){return bT.s==null?w.SnapshotOn(bR(),bS()):(w.WhenObsolete(bR(),bT),bT);});};z.GetAsync=function(bQ){return bE.FromContinuations(function(bR){return z.Get(bR,bQ);});};z.Get=function(bQ,bR){var bS;function bT(){w.WhenRun(bR(),function(bU){if(!bS[0]){bS[0]=true;bQ(bU);}},function(){if(!bS[0])bT();});}bS=[false];bT();};z.MapAsync2=function(bQ,bR,bS){return z.MapAsync(a.id,z.Map2(bQ,bR,bS));};z.MapAsync=function(bQ,bR){return z.CreateLazy(function(){return w.MapAsync(bQ,bR());});};z.Map3=function(bQ,bR,bS,bT){return z.CreateLazy(function(){return w.Map3(bQ,bR(),bS(),bT());});};z.Map2Unit=function(bQ,bR){return z.CreateLazy(function(){return w.Map2Unit(bQ(),bR());});};z.Map2=function(bQ,bR,bS){return z.CreateLazy(function(){return w.Map2(bQ,bR(),bS());});};z.MapCached=function(bQ,bR){return z.MapCachedBy(bC.Equals,bQ,bR);};z.MapCachedBy=function(bQ,bR,bS){var bT;bT=[null];return z.CreateLazy(function(){return w.MapCachedBy(bQ,bT,bR,bS());});};z.Map=function(bQ,bR){return z.CreateLazy(function(){return w.Map(bQ,bR());});};z.CreateLazy=function(bQ){var bR;bR={c:null,o:bQ};return function(){var bS,bT;bS=bR.c;return bS===null?(bS=bR.o(),bR.c=bS,(bT=bS.s,bT!=null&&bT.$==0)?bR.o=null:w.WhenObsoleteRun(bS,function(){bR.c=null;}),bS):bS;};};A.B={$:0};B=d.Submitter=bB.Class({Trigger:function(){x.Set(this["var"],null);}},k,B);B.New=bB.Ctor(function(bQ,bR){k.New.call(this);this.input=bQ;this["var"]=x.Create();this.view=z.SnapshotOn(bR,this["var"].v,this.input);},B);B.CreateOption=function(bQ){return new B.New(z.Map(function(bR){return{$:1,$0:bR};},bQ),null);};C.Fresh=function(){return{$:0,$0:h.Int()};};D=d.Model=bB.Class({},k,D);D.New=bB.Ctor(function(bQ,bR){var bS;bS=x.Create$1(bR);D.New$1.call(this,bS,z.Map(bQ,bS.v));},D);D.New$1=bB.Ctor(function(bQ,bR){k.New.call(this);this["var"]=bQ;this.view=bR;},D);D.Update=function(bQ,bR){x.Update(bR["var"],function(bS){bQ(bS);return bS;});};D.Create=function(bQ,bR){return new D.New(bQ,bR);};E.Default=function(){K.$cctor();return K.Default;};G=F.ArrayStorage=bB.Class({SSet:function(bQ){return bt.ofSeq(bQ);},SSetAt:function(bQ,bR,bS){bt.set(bS,bQ,bR);return bS;},SRemoveIf:function(bQ,bR){return bt.filter(function(bS){return!bQ(bS);},bR);},SInit:function(){return this.init;},SPrependMany:function(bQ,bR){var bS;bS=e.ofSeqNonCopying(bQ);bR.unshift.apply(bR,bS);return bR;},SPrepend:function(bQ,bR){bR.unshift(bQ);return bR;},SAppendMany:function(bQ,bR){var bS;bS=e.ofSeqNonCopying(bQ);bR.push.apply(bR,bS);return bR;},SAppend:function(bQ,bR){bR.push(bQ);return bR;}},k,G);G.New=bB.Ctor(function(bQ){k.New.call(this);this.init=bQ;},G);H=F.LocalStorageBackend=bB.Class({clear:function(){this.storage.removeItem(this.id);},set:function(bQ){this.storage.setItem(this.id,bL.stringify(bt.map(this.serializer.Encode,bQ)));return bQ;},SSet:function(bQ){return this.set(bt.ofSeq(bQ));},SSetAt:function(bQ,bR,bS){bt.set(bS,bQ,bR);return this.set(bS);},SRemoveIf:function(bQ,bR){return this.set(bt.filter(function(bS){return!bQ(bS);},bR));},SInit:function(){var bQ;bQ=this.storage.getItem(this.id);if(bQ===null)return[];else try{return bt.map(this.serializer.Decode,bL.parse(bQ));}catch(bR){return[];}},SPrependMany:function(bQ,bR){var bS;bS=e.ofSeqNonCopying(bQ);bR.unshift.apply(bR,bS);return this.set(bR);},SPrepend:function(bQ,bR){bR.unshift(bQ);return this.set(bR);},SAppendMany:function(bQ,bR){var bS;bS=e.ofSeqNonCopying(bQ);bR.push.apply(bR,bS);return this.set(bR);},SAppend:function(bQ,bR){bR.push(bQ);return this.set(bR);}},k,H);H.New=bB.Ctor(function(bQ,bR){k.New.call(this);this.id=bQ;this.serializer=bR;this.storage=self.localStorage;},H);F.LocalStorage=function(bQ,bR){return new H.New(bQ,bR);};F.InMemory=function(bQ){return new G.New(bQ);};I=d.ListModel=bB.Class({Wrap:function(bQ,bR,bS){return I.Wrap(this,bQ,bR,bS);},Lens:function(bQ){return this.LensInto(a.id,function(bR,bS){return bS;},bQ);},LensInto:function(bQ,bR,bS){var bT,bU,bV,bW;bT=this;bU=h.Id();bV=z.Map(bQ,this.FindByKeyAsView(bS));bW={RGet:function(){return bQ(bT.FindByKey(bS));},RSet:function(bX){return bT.UpdateBy(function(bY){return{$:1,$0:bR(bY,bX)};},bS);},RVal:function(){return this.RGet();},set_RVal:function(bX){return this.RSet(bX);},RUpd:function(bX){return bT.UpdateBy(function(bY){return{$:1,$0:bR(bY,bX(bQ(bY)))};},bS);},RUpdM:function(bX){return bT.UpdateBy(function(bY){var bZ;bZ=bX(bQ(bY));return bZ==null?null:{$:1,$0:bR(bY,bZ.$0)};},bS);},RView:function(){return bV;},RId:function(){return bU;}};k.New.call(bW);return bW;},get_LengthAsView:function(){return z.Map(bt.length,this["var"].RView());},get_Length:function(){return bt.length(this["var"].RVal());},Clear:function(){this["var"].set_RVal(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(bQ,bR){var bS,bT,bU,bV,bW;bS=this;bT=this["var"].RVal();bU=bt.tryFindIndex(function(bX){return bC.Equals(bS.key(bX),bR);},bT);bU!=null&&bU.$==1?(bV=bU.$0,bW=bQ(bt.get(bT,bV)),bW!=null&&bW.$==1?(this["var"].set_RVal(this.storage.SSetAt(bV,bW.$0,bT)),this.ObsoleteKey(bR)):void 0):void 0;},UpdateAll:function(bQ){var bR;bR=this;this["var"].RUpd(function(bS){bt.iteri(function(bT,bU){var bV;bV=bQ(bU);return bV==null?null:bt.set(bS,bT,bV.$0);},bS);return bR.storage.SSet(bS);});this.ObsoleteAll();},FindByKeyAsView:function(bQ){return z.Map(function(bR){return bR.$0;},this.TryFindByKeyAsView(bQ));},TryFindByKeyAsView:function(bQ){var bR;bR=this;return function(){var bS,bT,bU;bS=(bT=null,[bR.it.TryGetValue(bQ,{get:function(){return bT;},set:function(bV){bT=bV;}}),bT]);return bS[0]?bS[1]:(bU=w.New({$:2,$0:bR.TryFindByKey(bQ),$1:[]}),(bR.it.Add(bQ,bU),bU));};},TryFindByKey:function(bQ){var bR;bR=this;return bt.tryFind(function(bS){return bC.Equals(bR.key(bS),bQ);},this["var"].RVal());},FindByKey:function(bQ){var bR;bR=this;return bt.find(function(bS){return bC.Equals(bR.key(bS),bQ);},this["var"].RVal());},TryFindAsView:function(bQ){return z.Map(function(bR){return bt.tryFind(bQ,bR);},this["var"].RView());},FindAsView:function(bQ){return z.Map(function(bR){return bt.find(bQ,bR);},this["var"].RView());},TryFind:function(bQ){return bt.tryFind(bQ,this["var"].RVal());},Find:function(bQ){return bt.find(bQ,this["var"].RVal());},ContainsKeyAsView:function(bQ){var bR;function bS(bT){return bC.Equals(bR.key(bT),bQ);}bR=this;return z.Map(function(bT){return bt.exists(bS,bT);},this["var"].RView());},ContainsKey:function(bQ){var bR;bR=this;return bt.exists(function(bS){return bC.Equals(bR.key(bS),bQ);},this["var"].RVal());},Set:function(bQ){this["var"].set_RVal(this.storage.SSet(bQ));this.ObsoleteAll();},Iter:function(bQ){bt.iter(bQ,this["var"].RVal());},RemoveByKey:function(bQ){var bR;bR=this;this["var"].set_RVal(this.storage.SRemoveIf(function(bS){return bC.Equals(bR.key(bS),bQ);},this["var"].RVal()));this.ObsoleteKey(bQ);},RemoveBy:function(bQ){var bR,bS,bT,bU;bR=this["var"].RVal();for(bS=0,bT=bR.length-1;bS<=bT;bS++){bU=bt.get(bR,bS);bQ(bU)?this.ObsoleteKey(this.key(bU)):void 0;}this["var"].set_RVal(this.storage.SRemoveIf(bQ,this["var"].RVal()));},Remove:function(bQ){var bR,bS,bT,bU;bR=this;bS=this["var"].RVal();J.Contains(bR.key,bQ,bS)?(bT=bR.key,bU=bT(bQ),this["var"].set_RVal(this.storage.SRemoveIf(function(bV){return bC.Equals(bT(bV),bU);},bS)),this.ObsoleteKey(bU)):void 0;},PrependMany:function(bQ){var bR,bS;function bT(bU,bV){var bW,bX;bW=bR.key(bV);bR.ObsoleteKey(bW);bX=bt.tryFindIndex(function(bY){return bC.Equals(bR.key(bY),bW);},bU);return bX==null?(bS.push(bV),bU):bR.storage.SSetAt(bX.$0,bV,bU);}bR=this;bS=[];this["var"].set_RVal(this.storage.SPrependMany(bS,(((bB.Curried3(bz.fold))(bT))(this["var"].RVal()))(bQ)));},Prepend:function(bQ){var bR,bS,bT,bU;bR=this;bS=this["var"].RVal();bT=this.key(bQ);bU=bt.tryFindIndex(function(bV){return bC.Equals(bR.key(bV),bT);},bS);bU!=null&&bU.$==1?this["var"].set_RVal(this.storage.SSetAt(bU.$0,bQ,bS)):this["var"].set_RVal(this.storage.SPrepend(bQ,bS));this.ObsoleteKey(bT);},AppendMany:function(bQ){var bR,bS;function bT(bU,bV){var bW,bX;bW=bR.key(bV);bR.ObsoleteKey(bW);bX=bt.tryFindIndex(function(bY){return bC.Equals(bR.key(bY),bW);},bU);return bX==null?(bS.push(bV),bU):bR.storage.SSetAt(bX.$0,bV,bU);}bR=this;bS=[];this["var"].set_RVal(this.storage.SAppendMany(bS,(((bB.Curried3(bz.fold))(bT))(this["var"].RVal()))(bQ)));},Append:function(bQ){var bR,bS,bT,bU;bR=this;bS=this["var"].RVal();bT=this.key(bQ);bU=bt.tryFindIndex(function(bV){return bC.Equals(bR.key(bV),bT);},bS);bU!=null&&bU.$==1?this["var"].set_RVal(this.storage.SSetAt(bU.$0,bQ,bS)):this["var"].set_RVal(this.storage.SAppend(bQ,bS));this.ObsoleteKey(bT);},ObsoleteAll:function(){bz.iter(function(bQ){w.Obsolete(bQ.V);},this.it);this.it.Clear();},ObsoleteKey:function(bQ){var bR,bS;bR=(bS=null,[this.it.TryGetValue(bQ,{get:function(){return bS;},set:function(bT){bS=bT;}}),bS]);bR[0]?(w.Obsolete(bR[1]),this.it.Remove(bQ)):void 0;},GetEnumerator0:function(){return bu.Get0(this["var"].RVal());},GetEnumerator:function(){return bu.Get(this["var"].RVal());}},k,I);I.New=bB.Ctor(function(bQ,bR){I.New$3.call(this,bQ,x.Create$1(bt.ofSeq(bz.distinctBy(bQ,bR.SInit()))),bR);},I);I.New$1=bB.Ctor(function(bQ){I.New$2.call(this,bQ,[]);},I);I.New$2=bB.Ctor(function(bQ,bR){var bS;bS=bt.ofSeq(bR);I.New$3.call(this,bQ,x.Create$1(bS),F.InMemory(bS));},I);I.New$3=bB.Ctor(function(bQ,bR,bS){k.New.call(this);this.key=bQ;this["var"]=bR;this.storage=bS;this.v=z.Map(function(bT){return bT.slice();},this["var"].RView());this.it=new bK.New$5();},I);J.Contains=function(bQ,bR,bS){var bT;bT=bQ(bR);return bt.exists(function(bU){return bC.Equals(bQ(bU),bT);},bS);};I.Wrap=function(bQ,bR,bS,bT){var bU,bV;bU=[new bK.New$5()];bV=bt.map(function(bW){var bX;bX=bS(bW);bU[0].set_Item(bQ.key(bW),bX);return bX;},bQ["var"].RVal());return new I.New$3(function(bW){return bQ.key(bR(bW));},x.Lens(bQ["var"],function(bW){var bX,bY;bX=new bK.New$5();bY=bt.map(function(bZ){var b0,b1;b0=bQ.key(bZ);b1=bU[0].ContainsKey(b0)?bT(bU[0].get_Item(b0),bZ):bS(bZ);bX.set_Item(b0,b1);return b1;},bW);bU[0]=bX;return bY;},function(bW,bX){var bY,bZ;bY=new bK.New$5();bZ=bt.map(function(b0){var b1;b1=bR(b0);bY.set_Item(bQ.key(b1),b0);return b1;},bX);bU[0]=bY;return bZ;}),F.InMemory(bV));};I.FromSeq=function(bQ){return I.Create(a.id,bQ);};I.Create=function(bQ,bR){return I.CreateWithStorage(bQ,F.InMemory(bt.ofSeq(bR)));};I.CreateWithStorage=function(bQ,bR){return new I.New(bQ,bR);};K.$cctor=function(){K.$cctor=a.ignore;K.Default={Encode:a.id,Decode:a.id};};L=d.ReactiveExtensions=bB.Class({},k,L);L.New=bB.Ctor(function(){k.New.call(this);},L);M=d.DoubleInterpolation=bB.Class({Interpolate:function(bQ,bR,bS){return bR+bQ*(bS-bR);}},null,M);M.DoubleInterpolation=new M({$:0});N.get_Double=function(){return M.DoubleInterpolation;};O=d.Easing=bB.Class({TransformTime:function(bQ){return this.transformTime(bQ);}},k,O);O.get_CubicInOut=function(){return P.CubicInOut();};O.Custom=function(bQ){return new O.New(bQ);};O.New=bB.Ctor(function(bQ){k.New.call(this);this.transformTime=bQ;},O);P.CubicInOut=function(){T.$cctor();return T.CubicInOut;};Q.get_Empty=function(){return{$:0,$0:p.Empty()};};Q.WhenDone=function(bQ,bR){return Q.Append({$:0,$0:p.Single({$:0,$0:bQ})},bR);};Q.Run=function(bQ,bR){var bS;function bT(bU){function bV(bW,bX){var bY;bY=bX-bW;bR.Compute(bY);bQ();return bY<=bS?void a.requestAnimationFrame(function(bZ){bV(bW,bZ);}):bU();}a.requestAnimationFrame(function(bW){bV(bW,bW);});}bS=bR.Duration;return bS===0?bE.Zero():bE.FromContinuations(function(bU,bV,bW){return bT.apply(null,[bU,bV,bW]);});};Q.Play=function(bQ){var bR;bR=null;return bE.Delay(function(){return bE.Bind(Q.Run(a.ignore,R.Actions(bQ)),function(){R.Finalize(bQ);return bE.Return(null);});});};Q.Pack=function(bQ){return{$:0,$0:p.Single({$:1,$0:bQ})};};Q.Map=function(bQ,bR){var bS;return R.Def(bR.Duration,(bS=bR.Compute,function(bT){return bQ(bS(bT));}));};Q.Delayed=function(bQ,bR,bS,bT,bU,bV){return{Compute:function(bW){return bW<=bT?bU:bQ.Interpolate(bR.TransformTime((bW-bT)/bS),bU,bV);},Duration:bS+bT};};Q.Simple=function(bQ,bR,bS,bT,bU){return{Compute:function(bV){return bQ.Interpolate(bR.TransformTime(bV/bS),bT,bU);},Duration:bS};};Q.Const=function(bQ){return R.Const(bQ);};Q.Concat=function(bQ){return{$:0,$0:p.Concat(bz.map(R.List,bQ))};};Q.Append=function(bQ,bR){return{$:0,$0:p.Append(bQ.$0,bR.$0)};};Q.set_UseAnimations=function(bQ){R.set_UseAnimations(bQ);};Q.get_UseAnimations=function(){return R.UseAnimations();};R.UseAnimations=function(){T.$cctor();return T.UseAnimations;};R.set_UseAnimations=function(bQ){T.$cctor();T.UseAnimations=bQ;};R.Actions=function(bQ){return R.ConcatActions(bt.choose(function(bR){return bR.$==1?{$:1,$0:bR.$0}:null;},p.ToArray(bQ.$0)));};R.ConcatActions=function(bQ){var bR,bS,bT,bU;bR=e.ofSeqNonCopying(bQ);bS=bt.length(bR);return bS===0?R.Const():bS===1?bt.get(bR,0):(bT=bz.max(bz.map(function(bV){return bV.Duration;},bR)),(bU=bt.map(function(bV){return R.Prolong(bT,bV);},bR),R.Def(bT,function(bV){bt.iter(function(bW){bW.Compute(bV);},bU);})));};R.Prolong=function(bQ,bR){var bS,bT,bU;bS=bR.Compute;bT=bR.Duration;bU=bJ.Create(function(){return bR.Compute(bR.Duration);});return{Compute:function(bV){return bV>=bT?bU.f():bS(bV);},Duration:bQ};};R.Const=function(bQ){return R.Def(0,function(){return bQ;});};R.Def=function(bQ,bR){return{Compute:bR,Duration:bQ};};R.Finalize=function(bQ){bt.iter(function(bR){if(bR.$==0)bR.$0();},p.ToArray(bQ.$0));};R.List=function(bQ){return bQ.$0;};S=d.Trans=bB.Class({Copy:function(bQ,bR,bS,bT){var bU,bV,bW,bX,bY;function bZ(b0,b1){return bU.TChange(b0,b1);}bU=this;bV=bQ==null?function(b0){return function(b1){return bZ(b0,b1);};}:bQ.$0;return new S.New$3(function(b0,b1){return(bV(b0))(b1);},(bW=this.get_TEnter(),bR==null?bW:bR.$0),(bX=this.get_TExit(),bS==null?bX:bS.$0),(bY=this.get_TFlags(),bT==null?bY:bT.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(bQ,bR){return this.change(bQ,bR);}},k,S);S.New=bB.Ctor(function(bQ,bR,bS){S.New$3.call(this,bQ,bC.Equals(bR,null)?Q.Const:bR,bC.Equals(bS,null)?Q.Const:bS,1|(bC.Equals(bR,null)?0:2)|(bC.Equals(bS,null)?0:4));},S);S.New$1=bB.Ctor(function(bQ){S.New$3.call(this,bQ,Q.Const,Q.Const,1);},S);S.New$2=bB.Ctor(function(){S.New$3.call(this,function(bQ,bR){return Q.Const(bR);},Q.Const,Q.Const,0);},S);S.New$3=bB.Ctor(function(bQ,bR,bS,bT){k.New.call(this);this.change=bQ;this.enter=bR;this.exit=bS;this.flags=bT;},S);S.Exit=function(bQ,bR){return bR.Copy(null,null,{$:1,$0:bQ},{$:1,$0:bR.get_TFlags()|4});};S.Enter=function(bQ,bR){return bR.Copy(null,{$:1,$0:bQ},null,{$:1,$0:bR.get_TFlags()|2});};S.Change=function(bQ,bR){return bR.Copy({$:1,$0:bQ},null,null,{$:1,$0:bR.get_TFlags()|1});};S.Create=function(bQ){return new S.New$1(bQ);};S.Trivial=function(){return new S.New$2();};S.CanAnimateExit=function(bQ){var bR,bS;bR=bQ.get_TFlags();bS=4;return(bR&bS)===bS;};S.CanAnimateEnter=function(bQ){var bR,bS;bR=bQ.get_TFlags();bS=2;return(bR&bS)===bS;};S.CanAnimateChange=function(bQ){var bR,bS;bR=bQ.get_TFlags();bS=1;return(bR&bS)===bS;};S.AnimateExit=function(bQ,bR){return(bQ.get_TExit())(bR);};S.AnimateEnter=function(bQ,bR){return(bQ.get_TEnter())(bR);};S.AnimateChange=function(bQ,bR,bS){return bQ.TChange(bR,bS);};T.$cctor=function(){T.$cctor=a.ignore;T.CubicInOut=O.Custom(function(bQ){var bR;bR=bQ*bQ;return 3*bR-2*(bR*bQ);});T.UseAnimations=true;};U=d.AnimatedAttrNode=bB.Class({sync:function(bQ){var bR;if(this.dirty){bR=this.logical;bR==null?void 0:(this.push(bQ))(bR.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(bQ,bR){this.visible={$:1,$0:bR};this.dirty=true;(this.push(bQ))(bR);},NChanged:function(){return this.updates;},NSync:a.ignore,NGetExitAnim:function(bQ){var bR,bS;bR=this;return Q.WhenDone(function(){bR.dirty=true;bR.visible=null;},(bS=this.visible,bS!=null&&bS.$==1?Q.Pack(Q.Map(function(bT){bR.pushVisible(bQ,bT);},S.AnimateExit(this.tr,bS.$0))):Q.get_Empty()));},NGetEnterAnim:function(bQ){var bR,bS,bT,bU,bV;bR=this;return Q.WhenDone(function(){bR.sync(bQ);},(bS=this.visible,(bT=this.logical,bS!=null&&bS.$==1&&(bT!=null&&bT.$==1&&(this.dirty&&(bU=[bT.$0,bS.$0],true)))?Q.Pack(Q.Map(function(bW){bR.pushVisible(bQ,bW);},S.AnimateChange(this.tr,bU[1],bU[0]))):bS==null&&(bT!=null&&bT.$==1)?Q.Pack(Q.Map(function(bW){bR.pushVisible(bQ,bW);},S.AnimateEnter(this.tr,bT.$0))):Q.get_Empty())));},NGetChangeAnim:function(bQ){var bR,bS,bT,bU;bR=this;return Q.WhenDone(function(){bR.sync(bQ);},(bS=this.visible,(bT=this.logical,bS!=null&&bS.$==1&&(bT!=null&&bT.$==1&&(this.dirty&&(bU=[bT.$0,bS.$0],true)))?Q.Pack(Q.Map(function(bV){bR.pushVisible(bQ,bV);},S.AnimateChange(this.tr,bU[1],bU[0]))):Q.get_Empty())));}},k,U);U.New=bB.Ctor(function(bQ,bR,bS){var bT;bT=this;k.New.call(this);this.tr=bQ;this.push=bS;this.logical=null;this.visible=null;this.dirty=true;this.updates=z.Map(function(bU){bT.logical={$:1,$0:bU};bT.dirty=true;},bR);},U);V=d.DynamicAttrNode=bB.Class({NChanged:function(){return this.updates;},NSync:function(bQ){if(this.dirty){(this.push(bQ))(this.value);this.dirty=false;}},NGetExitAnim:function(bQ){return Q.get_Empty();},NGetEnterAnim:function(bQ){return Q.get_Empty();},NGetChangeAnim:function(bQ){return Q.get_Empty();}},k,V);V.New=bB.Ctor(function(bQ,bR){var bS;bS=this;k.New.call(this);this.push=bR;this.value=void 0;this.dirty=false;this.updates=z.Map(function(bT){bS.value=bT;bS.dirty=true;},bQ);},V);W=d.AttrProxy=bB.Class({},null,W);W.Handler=function(bQ,bR){return _0.Static(function(bS){bS.addEventListener(bQ,function(bT){return(bR(bS))(bT);},false);});};W.Concat=function(bQ){var bR;bR=e.ofSeqNonCopying(bQ);return e.TreeReduce(_0.EmptyAttr(),W.Append,bR);};W.Append=function(bQ,bR){return _0.AppendTree(bQ,bR);};W.Create=function(bQ,bR){return _0.Static(function(bS){r.SetAttr(bS,bQ,bR);});};Z.New=function(bQ,bR,bS,bT){var bU;bU={DynElem:bQ,DynFlags:bR,DynNodes:bS};bB.SetOptional(bU,"OnAfterRender",bT);return bU;};_0.Static=function(bQ){return new W({$:3,$0:bQ});};_0.Dynamic=function(bQ,bR){return new W({$:1,$0:new V.New(bQ,bR)});};_0.Animated=function(bQ,bR,bS){var bT,bU,bV;bT=new U.New(bQ,bR,bS);bU=4;S.CanAnimateEnter(bQ)?bU=bU|1:void 0;S.CanAnimateExit(bQ)?bU=bU|2:void 0;bV=new W({$:1,$0:bT});_0.SetFlags(bV,bU);return bV;};_0.EmptyAttr=function(){_3.$cctor();return _3.EmptyAttr;};_0.AppendTree=function(bQ,bR){var bS;return bQ===null?bR:bR===null?bQ:(bS=new W({$:2,$0:bQ,$1:bR}),(_0.SetFlags(bS,_0.Flags(bQ)|_0.Flags(bR)),bS));};_0.GetChangeAnim=function(bQ){return _0.GetAnim(bQ,function(bR,bS){return bR.NGetChangeAnim(bS);});};_0.GetExitAnim=function(bQ){return _0.GetAnim(bQ,function(bR,bS){return bR.NGetExitAnim(bS);});};_0.GetEnterAnim=function(bQ){return _0.GetAnim(bQ,function(bR,bS){return bR.NGetEnterAnim(bS);});};_0.GetAnim=function(bQ,bR){return Q.Concat(bt.map(function(bS){return bR(bS,bQ.DynElem);},bQ.DynNodes));};_0.Updates=function(bQ){return e.MapTreeReduce(function(bR){return bR.NChanged();},z.Const(),z.Map2Unit,bQ.DynNodes);};_0.Empty=function(bQ){return Z.New(bQ,0,[],null);};_0.Insert=function(bQ,bR){var bS,bT,bU;function bV(bW){if(!(bW===null))if(bW!=null&&bW.$==1)bS.push(bW.$0);else if(bW!=null&&bW.$==2){bV(bW.$0);bV(bW.$1);}else if(bW!=null&&bW.$==3)bW.$0(bQ);else if(bW!=null&&bW.$==4)bT.push(bW.$0);}bS=[];bT=[];bV(bR);bU=bS.slice(0);return Z.New(bQ,_0.Flags(bR),bU,bT.length===0?null:{$:1,$0:function(bW){bz.iter(function(bX){bX(bW);},bT);}});};_0.Sync=function(bQ,bR){bt.iter(function(bS){bS.NSync(bQ);},bR.DynNodes);};_0.SetFlags=function(bQ,bR){bQ.flags=bR;};_0.Flags=function(bQ){return bQ!==null&&bQ.hasOwnProperty("flags")?bQ.flags:0;};_0.HasExitAnim=function(bQ){var bR;bR=2;return(bQ.DynFlags&bR)===bR;};_0.HasEnterAnim=function(bQ){var bR;bR=1;return(bQ.DynFlags&bR)===bR;};_0.HasChangeAnim=function(bQ){var bR;bR=4;return(bQ.DynFlags&bR)===bR;};_1=d.CheckedInput=bB.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_1);_1.Make=function(bQ){return new _1({$:0,$0:bQ,$1:a.String(bQ)});};_2.ValidateForm=function(){return _2.OnAfterRender(function(bQ){if(self.H5F)self.H5F.setup(bQ);});};_2.Checked=function(bQ){function bR(bS,bT){return!bC.Equals(bQ.RVal(),bS.checked)?bQ.set_RVal(bS.checked):null;}return W.Concat([_2.DynamicProp("checked",bQ.RView()),_2.Handler("change",function(bS){return function(bT){return bR(bS,bT);};}),_2.Handler("click",function(bS){return function(bT){return bR(bS,bT);};})]);};_2.FloatValue=function(bQ){return _2.CustomVar(bQ,function(bR,bS){var bT;bT=bS.get_Input();return bR.value!==bT?void(bR.value=bT):null;},function(bR){var bS,bT;bS=bR.value;return{$:1,$0:f.isBlank(bS)?(bR.checkValidity?bR.checkValidity():true)?new _1({$:2,$0:bS}):new _1({$:1,$0:bS}):(bT=+bS,a.isNaN(bT)?new _1({$:1,$0:bS}):new _1({$:0,$0:bT,$1:bS}))};});};_2.FloatValueUnchecked=function(bQ){return _2.CustomValue(bQ,a.String,function(bR){var bS;return f.isBlank(bR)?{$:1,$0:0}:(bS=+bR,a.isNaN(bS)?null:{$:1,$0:bS});});};_2.IntValue=function(bQ){return _2.CustomVar(bQ,function(bR,bS){var bT;bT=bS.get_Input();return bR.value!==bT?void(bR.value=bT):null;},function(bR){var bS,bT,bU;bS=bR.value;return{$:1,$0:f.isBlank(bS)?(bR.checkValidity?bR.checkValidity():true)?new _1({$:2,$0:bS}):new _1({$:1,$0:bS}):(bT=(bU=0,[bM.TryParseInt32(bS,{get:function(){return bU;},set:function(bV){bU=bV;}}),bU]),bT[0]?new _1({$:0,$0:bT[1],$1:bS}):new _1({$:1,$0:bS}))};});};_2.IntValueUnchecked=function(bQ){return _2.CustomValue(bQ,a.String,function(bR){var bS;return f.isBlank(bR)?{$:1,$0:0}:(bS=+bR,bS!==bS>>0?null:{$:1,$0:bS});});};_2.Value=function(bQ){function bR(bS){return{$:1,$0:bS};}return _2.CustomValue(bQ,a.id,function(bS){return bR(a.id(bS));});};_2.ContentEditableHtml=function(bQ){var bR;bR=_2.CustomVar(bQ,function(bS,bT){bS.innerHTML=bT;},function(bS){return{$:1,$0:bS.innerHTML};});return W.Append(W.Create("contenteditable","true"),bR);};_2.ContentEditableText=function(bQ){var bR;bR=_2.CustomVar(bQ,function(bS,bT){bS.textContent=bT;},function(bS){return{$:1,$0:bS.textContent};});return W.Append(W.Create("contenteditable","true"),bR);};_2.CustomValue=function(bQ,bR,bS){return _2.CustomVar(bQ,function(bT,bU){bT.value=bR(bU);},function(bT){return bS(bT.value);});};_2.CustomVar=function(bQ,bR,bS){function bT(bV,bW){return bQ.RUpdM(function(bX){var bY,bZ;bY=bS(bV);return bY!=null&&bY.$==1&&(!bC.Equals(bY.$0,bX)&&(bZ=[bY,bY.$0],true))?bZ[0]:null;});}function bU(bV,bW){var bX,bY;bX=bS(bV);return bX!=null&&bX.$==1&&(bC.Equals(bX.$0,bW)&&(bY=bX.$0,true))?null:bR(bV,bW);}return W.Concat([_2.Handler("change",function(bV){return function(bW){return bT(bV,bW);};}),_2.Handler("input",function(bV){return function(bW){return bT(bV,bW);};}),_2.Handler("keypress",function(bV){return function(bW){return bT(bV,bW);};}),_2.DynamicCustom(function(bV){return function(bW){return bU(bV,bW);};},bQ.RView())]);};_2.DynamicProp=function(bQ,bR){return _0.Dynamic(bR,function(bS){return function(bT){bS[bQ]=bT;};});};_2.DynamicPred=function(bQ,bR,bS){function bT(bU,bV){return bV[0]?r.SetAttr(bU,bQ,bV[1]):r.RemoveAttr(bU,bQ);}return _0.Dynamic(z.Map2(function(bU,bV){return[bU,bV];},bR,bS),function(bU){return function(bV){return bT(bU,bV);};});};_2.DynamicClass=function(bQ,bR,bS){return _0.Dynamic(bR,function(bT){return function(bU){return bS(bU)?r.AddClass(bT,bQ):r.RemoveClass(bT,bQ);};});};_2.OnAfterRenderView=function(bQ,bR){var bS;bS=h.Id();return W.Append(_2.OnAfterRender(function(bT){bR(bT,bT[bS]);}),_2.DynamicCustom(function(bT){return function(bU){bT[bS]=bU;};},bQ));};_2.OnAfterRender=function(bQ){return new W({$:4,$0:bQ});};_2.HandlerView=function(bQ,bR,bS){return _0.Static(function(bT){var bU;bU=bS(bT);bT.addEventListener(bQ,function(bV){return z.Get(bU(bV),bR);},false);});};_2.Handler=function(bQ,bR){return _0.Static(function(bS){bS.addEventListener(bQ,function(bT){return(bR(bS))(bT);},false);});};_2.DynamicStyle=function(bQ,bR){return _0.Dynamic(bR,function(bS){return function(bT){return r.SetStyle(bS,bQ,bT);};});};_2.DynamicCustom=function(bQ,bR){return _0.Dynamic(bR,bQ);};_2.Dynamic=function(bQ,bR){return _0.Dynamic(bR,function(bS){return function(bT){return r.SetAttr(bS,bQ,bT);};});};_2.AnimatedStyle=function(bQ,bR,bS,bT){return _0.Animated(bR,bS,function(bU){return function(bV){return r.SetStyle(bU,bQ,bT(bV));};});};_2.Animated=function(bQ,bR,bS,bT){return _0.Animated(bR,bS,function(bU){return function(bV){return r.SetAttr(bU,bQ,bT(bV));};});};_2.Class=function(bQ){return _0.Static(function(bR){r.AddClass(bR,bQ);});};_2.Style=function(bQ,bR){return _0.Static(function(bS){r.SetStyle(bS,bQ,bR);});};_3.$cctor=function(){_3.$cctor=a.ignore;_3.EmptyAttr=null;};_4=d.DocElemNode=bB.Class({GetHashCode:function(){return this.ElKey;},Equals:function(bQ){return this.ElKey===bQ.ElKey;}},null,_4);_4.New=function(bQ,bR,bS,bT,bU,bV){var bW;return new _4((bW={Attr:bQ,Children:bR,El:bT,ElKey:bU},(bB.SetOptional(bW,"Delimiters",bS),bB.SetOptional(bW,"Render",bV),bW)));};_6.FoldBack=function(bQ,bR,bS){return bt.foldBack(bQ,bR.$0,bS);};_6.Iter=function(bQ,bR){bt.iter(bQ,bR.$0);};_6.Except=function(bQ,bR){var bS;bS=bQ.$0;return{$:0,$0:bt.filter(function(bT){return bt.forall(function(bU){return!(bT===bU);},bS);},bR.$0)};};_6.DocChildren=function(bQ){var bR;function bS(bT){if(bT!=null&&bT.$==2)bS(bT.$0.Current);else if(bT!=null&&bT.$==1)bR.push(bT.$0.El);else if(bT==null);else if(bT!=null&&bT.$==5)bR.push(bT.$0);else if(bT!=null&&bT.$==4)bR.push(bT.$0.Text);else if(bT!=null&&bT.$==6)bt.iter(function(bU){if(bU==null||bU.constructor===a.Object)bS(bU);else bR.push(bU);},bT.$0.Els);else{bS(bT.$0);bS(bT.$1);}}bR=[];bS(bQ.Children);return{$:0,$0:e.ofSeqNonCopying(bR)};};_6.Children=function(bQ,bR){var bS,bT,bU;if(bR!=null&&bR.$==1){bU=[];bS=bR.$0[0].nextSibling;while(bS!==bR.$0[1]){bU.push(bS);bS=bS.nextSibling;}return{$:0,$0:bU};}else return{$:0,$0:bt.init(bQ.childNodes.length,(bT=bQ.childNodes,function(bV){return bT[bV];}))};};_7.ToArray=function(bQ){return i.ToArray(bQ.$0);};_7.get_Empty=function(){return{$:0,$0:new by.New$3()};};_7.IsEmpty=function(bQ){return bQ.$0.get_Count()===0;};_7.Intersect=function(bQ,bR){return{$:0,$0:i.Intersect(bQ.$0,bR.$0)};};_7.Except=function(bQ,bR){return{$:0,$0:i.Except(bQ.$0,bR.$0)};};_7.FindAll=function(bQ){var bR;function bS(bU){if(bU!=null&&bU.$==0){bS(bU.$0);bS(bU.$1);}else if(bU!=null&&bU.$==1)bT(bU.$0);else if(bU!=null&&bU.$==2)bS(bU.$0.Current);else if(bU!=null&&bU.$==6)bt.iter(bT,bU.$0.Holes);}function bT(bU){bR.push(bU);bS(bU.Children);}bR=[];bS(bQ);return{$:0,$0:new by.New$2(bR)};};_7.Filter=function(bQ,bR){return{$:0,$0:i.Filter(bQ,bR.$0)};};_8.New=function(bQ,bR){return{PreviousNodes:bQ,Top:bR};};_9.TextHoleRE=function(){bb.$cctor();return bb.TextHoleRE;};_9.LocalTemplatesLoaded=function(){bb.$cctor();return bb.LocalTemplatesLoaded;};_9.set_LocalTemplatesLoaded=function(bQ){bb.$cctor();bb.LocalTemplatesLoaded=bQ;};_9.LoadedTemplateFile=function(bQ){var bR,bS,bT;bR=(bS=null,[_9.LoadedTemplates().TryGetValue(bQ,{get:function(){return bS;},set:function(bU){bS=bU;}}),bS]);return bR[0]?bR[1]:(bT=new bK.New$5(),(_9.LoadedTemplates().set_Item(bQ,bT),bT));};_9.LoadedTemplates=function(){bb.$cctor();return bb.LoadedTemplates;};_9.UpdateTextNode=function(bQ,bR){bQ.Value=bR;bQ.Dirty=true;};_9.CreateTextNode=function(){return{Text:r.CreateText(""),Dirty:false,Value:""};};_9.UpdateEmbedNode=function(bQ,bR){bQ.Current=bR;bQ.Dirty=true;};_9.CreateEmbedNode=function(){return{Current:null,Dirty:false};};_9.PerformAnimatedUpdate=function(bQ,bR){var bS;return Q.get_UseAnimations()?(bS=null,bE.Delay(function(){var bT,bU,bV;bT=_7.FindAll(bR);bU=_9.ComputeChangeAnim(bQ,bT);bV=_9.ComputeEnterAnim(bQ,bT);return bE.Bind(Q.Play(Q.Append(bU,_9.ComputeExitAnim(bQ,bT))),function(){return bE.Bind(_9.SyncElemNodesNextFrame(bQ),function(){return bE.Bind(Q.Play(bV),function(){bQ.PreviousNodes=bT;return bE.Return(null);});});});})):_9.SyncElemNodesNextFrame(bQ);};_9.SyncElemNodesNextFrame=function(bQ){function bR(bS){a.requestAnimationFrame(function(){_9.SyncElemNode(bQ.Top);bS();});}return bE.FromContinuations(function(bS,bT,bU){return bR.apply(null,[bS,bT,bU]);});};_9.ComputeEnterAnim=function(bQ,bR){return Q.Concat(bt.map(function(bS){return _0.GetEnterAnim(bS.Attr);},_7.ToArray(_7.Except(bQ.PreviousNodes,_7.Filter(function(bS){return _0.HasEnterAnim(bS.Attr);},bR)))));};_9.ComputeChangeAnim=function(bQ,bR){var bS;function bT(bU){return _0.HasChangeAnim(bU.Attr);}bS=function(bU){return _7.Filter(bT,bU);};return Q.Concat(bt.map(function(bU){return _0.GetChangeAnim(bU.Attr);},_7.ToArray(_7.Intersect(bS(bQ.PreviousNodes),bS(bR)))));};_9.ComputeExitAnim=function(bQ,bR){return Q.Concat(bt.map(function(bS){return _0.GetExitAnim(bS.Attr);},_7.ToArray(_7.Except(bR,_7.Filter(function(bS){return _0.HasExitAnim(bS.Attr);},bQ.PreviousNodes)))));};_9.CreateDelimitedRunState=function(bQ,bR,bS){return _8.New(_7.get_Empty(),_9.CreateDelimitedElemNode(bQ,bR,_0.EmptyAttr(),bS));};_9.CreateRunState=function(bQ,bR){return _8.New(_7.get_Empty(),_9.CreateElemNode(bQ,_0.EmptyAttr(),bR));};_9.CreateDelimitedElemNode=function(bQ,bR,bS,bT){var bU,bV;bU=bQ.parentNode;_9.LinkPrevElement(bR,bT);bV=_0.Insert(bU,bS);return _4.New(bV,bT,{$:1,$0:[bQ,bR]},bU,h.Int(),bB.GetOptional(bV.OnAfterRender));};_9.CreateElemNode=function(bQ,bR,bS){var bT;_9.LinkElement(bQ,bS);bT=_0.Insert(bQ,bR);return _4.New(bT,bS,null,bQ,h.Int(),bB.GetOptional(bT.OnAfterRender));};_9.SyncElemNode=function(bQ){_9.SyncElement(bQ);_9.Sync(bQ.Children);_9.AfterRender(bQ);};_9.Sync=function(bQ){var bR,bS;if(bQ!=null&&bQ.$==1)_9.SyncElemNode(bQ.$0);else if(bQ!=null&&bQ.$==2)_9.Sync(bQ.$0.Current);else if(bQ==null);else if(bQ!=null&&bQ.$==5);else if(bQ!=null&&bQ.$==4){bR=bQ.$0;bR.Dirty?(bR.Text.nodeValue=bR.Value,bR.Dirty=false):void 0;}else if(bQ!=null&&bQ.$==6){bS=bQ.$0;bt.iter(function(bT){_9.SyncElemNode(bT);},bS.Holes);bt.iter(function(bT){_0.Sync(bT[0],bT[1]);},bS.Attrs);_9.AfterRender(bS);}else{_9.Sync(bQ.$0);_9.Sync(bQ.$1);}};_9.AfterRender=function(bQ){var bR;bR=bB.GetOptional(bQ.Render);bR!=null&&bR.$==1?(bR.$0(bQ.El),bB.SetOptional(bQ,"Render",null)):void 0;};_9.InsertBeforeDelim=function(bQ,bR){var bS,bT;bS=bQ.parentNode;bT=self.document.createTextNode("");bS.insertBefore(bT,bQ);_9.LinkPrevElement(bQ,bR);return bT;};_9.LinkPrevElement=function(bQ,bR){_9.InsertDoc(bQ.parentNode,bR,bQ);};_9.LinkElement=function(bQ,bR){_9.InsertDoc(bQ,bR,null);};_9.SyncElement=function(bQ){function bR(bS){function bT(bU){var bV,bW;return bU!=null&&bU.$==0?bT(bU.$0)||bT(bU.$1):bU!=null&&bU.$==2?(bV=bU.$0,bV.Dirty||bT(bV.Current)):bU!=null&&bU.$==6&&(bW=bU.$0,bW.Dirty||bt.exists(bR,bW.Holes));}return bT(bS.Children);}_0.Sync(bQ.El,bQ.Attr);bR(bQ)?_9.DoSyncElement(bQ):void 0;};_9.DoSyncElement=function(bQ){var bR,bS,bT;function bU(bV,bW){var bX,bY;return bV!=null&&bV.$==1?bV.$0.El:bV!=null&&bV.$==2?(bX=bV.$0,bX.Dirty?(bX.Dirty=false,_9.InsertDoc(bR,bX.Current,bW)):bU(bX.Current,bW)):bV==null?bW:bV!=null&&bV.$==4?bV.$0.Text:bV!=null&&bV.$==5?bV.$0:bV!=null&&bV.$==6?(bY=bV.$0,(bY.Dirty?bY.Dirty=false:void 0,bt.foldBack(function(bZ,b0){return bZ==null||bZ.constructor===a.Object?bU(bZ,b0):bZ;},bY.Els,bW))):bU(bV.$0,bU(bV.$1,bW));}bR=bQ.El;_6.Iter((bS=bQ.El,function(bV){r.RemoveNode(bS,bV);}),_6.Except(_6.DocChildren(bQ),_6.Children(bQ.El,bB.GetOptional(bQ.Delimiters))));bU(bQ.Children,(bT=bB.GetOptional(bQ.Delimiters),bT!=null&&bT.$==1?bT.$0[1]:null));};_9.InsertDoc=function(bQ,bR,bS){var bT;return bR!=null&&bR.$==1?_9.InsertNode(bQ,bR.$0.El,bS):bR!=null&&bR.$==2?(bT=bR.$0,(bT.Dirty=false,_9.InsertDoc(bQ,bT.Current,bS))):bR==null?bS:bR!=null&&bR.$==4?_9.InsertNode(bQ,bR.$0.Text,bS):bR!=null&&bR.$==5?_9.InsertNode(bQ,bR.$0,bS):bR!=null&&bR.$==6?bt.foldBack(function(bU,bV){return bU==null||bU.constructor===a.Object?_9.InsertDoc(bQ,bU,bV):_9.InsertNode(bQ,bU,bV);},bR.$0.Els,bS):_9.InsertDoc(bQ,bR.$0,_9.InsertDoc(bQ,bR.$1,bS));};_9.InsertNode=function(bQ,bR,bS){r.InsertAt(bQ,bS,bR);return bR;};_=d.Doc=bB.Class({ReplaceInDom:function(bQ){var bR;bR=self.document.createTextNode("");bQ.parentNode.replaceChild(bR,bQ);_.RunBefore(bR,this);}},k,_);_.Append=function(bQ,bR){return _.Mk({$:0,$0:bQ.docNode,$1:bR.docNode},z.Map2Unit(bQ.updates,bR.updates));};_.Concat=function(bQ){var bR;bR=e.ofSeqNonCopying(bQ);return e.TreeReduce(_.Empty(),_.Append,bR);};_.Empty=function(){return _.Mk(null,z.Const());};_.TextNode=function(bQ){return _.Mk({$:5,$0:r.CreateText(bQ)},z.Const());};_.Verbatim=function(bQ){var bR;return _.Mk(e.MapTreeReduce(function(bS){return bC.Equals(bS.nodeType,bN.TEXT_NODE)?{$:5,$0:bS}:{$:1,$0:_9.CreateElemNode(bS,_0.EmptyAttr(),null)};},null,function(bS,bT){return{$:0,$0:bS,$1:bT};},(bR=bO.parseHTML(bQ),bC.Equals(bR,null)?[]:bR)),z.Const());};_.SvgElementMixed=function(bQ,bR){var bS;bS=_.MixedNodes(bR);return _.SvgElement(bQ,bS[0],bS[1]);};_.SvgElement=function(bQ,bR,bS){var bT,bU;bT=W.Concat(bR);bU=_.Concat(bS);return $.New(r.CreateSvgElement(bQ),bT,bU);};_.ElementMixed=function(bQ,bR){var bS;bS=_.MixedNodes(bR);return _.Element(bQ,bS[0],bS[1]);};_.ConcatMixed=function(bQ){return _.Concat(bz.map(_.ToMixedDoc,bQ));};_.MixedNodes=function(bQ){var bR,bS,bT,bU;bR=[];bS=[];bT=bu.Get(bQ);try{while(bT.MoveNext()){bU=bT.Current();bU instanceof W?bR.push(bU):bS.push(_.ToMixedDoc(bU));}}finally{if(typeof bT=="object"&&"Dispose"in bT)bT.Dispose();}return[bR,bS];};_.ToMixedDoc=function(bQ){return bQ instanceof _?bQ:typeof bQ=="string"?_.TextNode(bQ):bQ instanceof a.Element?_.Static(bQ):typeof bQ=="function"?_.EmbedView(z.Map(_.ToMixedDoc,bQ)):bQ instanceof x?_.EmbedView(z.Map(_.ToMixedDoc,bQ.v)):bC.Equals(bQ,null)?_.Empty():_.TextNode(a.String(bQ));};_.Element=function(bQ,bR,bS){var bT,bU;bT=W.Concat(bR);bU=_.Concat(bS);return $.New(r.CreateElement(bQ),bT,bU);};_.Radio=function(bQ,bR,bS){var bT,bU;bT=r.CreateElement("input");bT.addEventListener("click",function(){return bS.RSet(bR);},false);bU=_2.DynamicProp("checked",z.Map(function(bV){return bC.Equals(bV,bR);},bS.RView()));return $.New(bT,W.Concat(bs.append(bs.ofArray([W.Create("type","radio"),W.Create("name",bS.RId()),bU]),bs.ofSeq(bQ))),_.Empty());};_.LinkView=function(bQ,bR,bS,bT){var bU;bU=W.Concat(bz.append([_2.HandlerView("click",bS,function(){return function(){return bT;};}),W.Create("href","#")],bR));return $.New(r.CreateElement("a"),bU,_.TextNode(bQ));};_.Link=function(bQ,bR,bS){var bT,bU;bT=(bU=W.Concat(bR),W.Append(W.Create("href","#"),bU));return $.New(_.Clickable("a",bS),bT,_.TextNode(bQ));};_.ButtonView=function(bQ,bR,bS,bT){var bU;bU=W.Concat(bz.append([_2.HandlerView("click",bS,function(){return function(){return bT;};})],bR));return $.New(r.CreateElement("button"),bU,_.TextNode(bQ));};_.Button=function(bQ,bR,bS){var bT;bT=W.Concat(bR);return $.New(_.Clickable("button",bS),bT,_.TextNode(bQ));};_.Clickable=function(bQ,bR){var bS;bS=r.CreateElement(bQ);bS.addEventListener("click",function(bT){bT.preventDefault();return bR();},false);return bS;};_.CheckBoxGroup=function(bQ,bR,bS){function bT(bU){return bC.Equals(bR,bU);}return _.CheckBox(bQ,x.Lens(bS,function(bU){return bs.exists(bT,bU);},function(bU,bV){return bV?bs.exists(function(bW){return bC.Equals(bR,bW);},bU)?bU:new bs.T({$:1,$0:bR,$1:bU}):bs.filter(function(bW){return!bC.Equals(bR,bW);},bU);}));};_.CheckBox=function(bQ,bR){return _.InputInternal("input",function(){return bz.append(bQ,[W.Create("type","checkbox"),_2.Checked(bR)]);});};_.SelectDynOptional=function(bQ,bR,bS,bT,bU){return _.SelectDyn(bQ,function(bV){return bV!=null&&bV.$==1?bS(bV.$0):bR;},z.Map(function(bV){return new bs.T({$:1,$0:null,$1:bs.map(function(bW){return{$:1,$0:bW};},bV)});},bT),bU);};_.SelectOptional=function(bQ,bR,bS,bT,bU){return _.Select(bQ,function(bV){return bV!=null&&bV.$==1?bS(bV.$0):bR;},new bs.T({$:1,$0:null,$1:bs.map(function(bV){return{$:1,$0:bV};},bT)}),bU);};_.Select=function(bQ,bR,bS,bT){return _.SelectImpl(bQ,bR,function(bU){bU[0]=bS;return _.Concat(bs.mapi(function(bV,bW){return _.Element("option",bs.ofArray([W.Create("value",a.String(bV))]),bs.ofArray([_.TextNode(bR(bW))]));},bS));},bT);};_.SelectDyn=function(bQ,bR,bS,bT){return _.SelectImpl(bQ,bR,function(bU){function bV(bW,bX){return _.Element("option",bs.ofArray([W.Create("value",a.String(bW))]),bs.ofArray([_.TextNode(bR(bX))]));}return _.Convert(function(bW){return bV(bW[0],bW[1]);},z.Map(function(bW){bU[0]=bW;return bz.mapi(function(bX,bY){return[bX,bY];},bW);},bS));},bT);};_.SelectImpl=function(bQ,bR,bS,bT){var bU,bV,bW,bX;function bY(b3){return b3.selectedIndex;}function bZ(b3,b4){b3.selectedIndex=b4;}function b0(b3){var b4;b4=bY(b3);return bU[0].get_Item(b4);}function b1(b3){return bz.findIndex(function(b4){return bC.Equals(b3,b4);},bU[0]);}function b2(b3,b4){return bZ(b3,b1(b4));}bU=[bs.T.Empty];bV=r.CreateElement("select");bW=_2.DynamicCustom(function(b3){return function(b4){return b2(b3,b4);};},bT.RView());bV.addEventListener("change",function(){bT.RUpdM(function(b3){var b4;b4=b0(bV);return bC.Equals(b3,b4)?null:{$:1,$0:b4};});},false);return $.New(bV,(bX=W.Append(bW,W.Concat(bQ)),W.Append(_2.OnAfterRender(function(b3){b2(b3,bT.RGet());}),bX)),bS(bU));};_.InputArea=function(bQ,bR){return _.InputInternal("textarea",function(){return bz.append(bQ,[_2.Value(bR)]);});};_.FloatInput=function(bQ,bR){return _.InputInternal("input",function(){return bz.append(bQ,[_2.FloatValue(bR),W.Create("type","number")]);});};_.FloatInputUnchecked=function(bQ,bR){return _.InputInternal("input",function(){return bz.append(bQ,[bR.RGet()===0?W.Create("value","0"):_0.EmptyAttr(),_2.FloatValueUnchecked(bR),W.Create("type","number")]);});};_.IntInput=function(bQ,bR){return _.InputInternal("input",function(){return bz.append(bQ,[_2.IntValue(bR),W.Create("type","number")]);});};_.IntInputUnchecked=function(bQ,bR){return _.InputInternal("input",function(){return bz.append(bQ,[bR.RGet()===0?W.Create("value","0"):_0.EmptyAttr(),_2.IntValueUnchecked(bR),W.Create("type","number")]);});};_.PasswordBox=function(bQ,bR){return _.InputInternal("input",function(){return bz.append(bQ,[_2.Value(bR),W.Create("type","password")]);});};_.Input=function(bQ,bR){return _.InputInternal("input",function(){return bz.append(bQ,[_2.Value(bR)]);});};_.InputInternal=function(bQ,bR){var bS;bS=r.CreateElement(bQ);return $.New(bS,W.Concat(bR(bS)),_.Empty());};_.ConvertSeqBy=function(bQ,bR,bS){return _.Flatten(z.MapSeqCachedViewBy(bQ,function(bT,bU){return(bR(bT))(bU);},bS));};_.ConvertSeq=function(bQ,bR){return _.Flatten(z.MapSeqCachedView(bQ,bR));};_.ConvertBy=function(bQ,bR,bS){return _.Flatten(z.MapSeqCachedBy(bQ,bR,bS));};_.Convert=function(bQ,bR){return _.Flatten(z.MapSeqCached(bQ,bR));};_.Flatten=function(bQ){return _.EmbedView(z.Map(_.Concat,bQ));};_.GetOrLoadTemplate=function(bQ,bR,bS,bT){_.LoadLocalTemplates$1();_.PrepareTemplate(bQ,bR,bS);return _.NamedTemplate(bQ,bR,bT);};_.NamedTemplate=function(bQ,bR,bS){var bT,bU;bT=(bU=null,[_9.LoadedTemplateFile(bQ).TryGetValue(bR==null?"":bR.$0,{get:function(){return bU;},set:function(bV){bU=bV;}}),bU]);return bT[0]?_.ChildrenTemplate(bT[1].cloneNode(true),bS):(bD.warn("Local template doesn't exist",bR),_.Empty());};_.LoadLocalTemplates=function(bQ){var bR;bR=_9.LoadedTemplateFile("");bR.count>0?_9.LoadedTemplates().set_Item(bQ,bR):(function(){var bS,bT,bU,bV;while(true){bS=self.document.querySelector("[ws-template]");if(bC.Equals(bS,null)){bT=self.document.querySelector("[ws-children-template]");if(bC.Equals(bT,null))return null;else{bU=bT.getAttribute("ws-children-template");bT.removeAttribute("ws-children-template");_.PrepareTemplate(bQ,{$:1,$0:bU},function(bW){return function(){return r.ChildrenArray(bW);};}(bT));}}else{bV=bS.getAttribute("ws-template");_.PrepareSingleTemplate(bQ,{$:1,$0:bV},bS);}}}(),_9.LoadedTemplates().set_Item("",_9.LoadedTemplateFile(bQ)));};_.LoadLocalTemplates$1=function(){if(!_9.LocalTemplatesLoaded()){_9.set_LocalTemplatesLoaded(true);_.LoadLocalTemplates("");}};_.PrepareTemplate=function(bQ,bR,bS){var bT,bU,bV,bW,bX;if(!_9.LoadedTemplateFile(bQ).ContainsKey(bR==null?"":bR.$0)){bT=bS();for(bU=0,bV=bT.length-1;bU<=bV;bU++){bW=bt.get(bT,bU);bX=bW.parentNode;bC.Equals(bX,null)?void 0:bX.removeChild(bW);}_.PrepareTemplateStrict(bQ,bR,bT);}};_.PrepareTemplateStrict=function(bQ,bR,bS){var bT,bU;function bV(b7){var b9,b_,b$,ca,cb,cc,cd,ce;function b8(cf){var cg;cg=b7.getAttribute(cf);cg===null?void 0:b7.setAttribute(cf,cg.toLowerCase());}b9=b7.attributes;b_=[];b$=[];ca=[];for(cb=0,cc=b9.length-1;cb<=cc;cb++){cd=b9.item(cb);bv.StartsWith(cd.nodeName,"ws-on")&&cd.nodeName!=="ws-onafterrender"&&cd.nodeName!=="ws-on"?(b_.push(cd.nodeName),b$.push(bP.string(cd.nodeName,{$:1,$0:"ws-on".length},null)+":"+cd.nodeValue.toLowerCase())):!bv.StartsWith(cd.nodeName,"ws-")&&(new a.RegExp(_9.TextHoleRE())).test(cd.nodeValue)?(cd.nodeValue=(ce=new a.RegExp(_9.TextHoleRE(),"g"),cd.nodeValue.replace(ce,function(cf,cg){return"${"+cg.toLowerCase()+"}";})),ca.push(cd.nodeName)):void 0;}!(b$.length==0)?b7.setAttribute("ws-on",bv.concat(" ",b$)):void 0;!(ca.length==0)?b7.setAttribute("ws-attr-holes",bv.concat(" ",ca)):void 0;b8("ws-hole");b8("ws-replace");b8("ws-attr");b8("ws-onafterrender");b8("ws-var");bt.iter(function(cf){b7.removeAttribute(cf);},b_);}function bW(b7){var b8,b9,b_,b$,ca,cb;b8=null;b9=0;b$=b7.textContent;ca=new a.RegExp(_9.TextHoleRE(),"g");while(b8=ca.exec(b$),b8!==null){b7.parentNode.insertBefore(self.document.createTextNode(bP.string(b$,{$:1,$0:b9},{$:1,$0:ca.lastIndex-bt.get(b8,0).length-1})),b7);b9=ca.lastIndex;cb=self.document.createElement("span");cb.setAttribute("ws-replace",bt.get(b8,1).toLowerCase());b7.parentNode.insertBefore(cb,b7);}ca.lastIndex=0;b7.textContent=bP.string(b$,{$:1,$0:b9},null);}function bX(b7,b8){function b9(b_){r.IterSelector(b7,"["+b_+"]",function(b$){var ca,cb;ca=(cb=null,[b8.TryGetValue(b$.getAttribute(b_).toLowerCase(),{get:function(){return cb;},set:function(cc){cb=cc;}}),cb]);ca[0]?b$.setAttribute(b_,ca[1]):void 0;});}b9("ws-hole");b9("ws-replace");b9("ws-attr");b9("ws-onafterrender");b9("ws-var");r.IterSelector(b7,"[ws-on]",function(b_){b_.setAttribute("ws-on",bv.concat(" ",bt.map(function(b$){var ca,cb,cc;ca=bv.SplitChars(b$,[":"],1);cb=(cc=null,[b8.TryGetValue(bt.get(ca,1),{get:function(){return cc;},set:function(cd){cc=cd;}}),cc]);return cb[0]?bt.get(ca,0)+":"+cb[1]:b$;},bv.SplitChars(b_.getAttribute("ws-on"),[" "],1))));});return r.IterSelector(b7,"[ws-attr-holes]",function(b_){var b$,ca,cb;b$=bv.SplitChars(b_.getAttribute("ws-attr-holes"),[" "],1);for(ca=0,cb=b$.length-1;ca<=cb;ca++)(function(){var cc;function cd(ce,cf){var cg;cg=bH.KeyValue(cf);return ce.replace(new a.RegExp("\\${"+cg[0]+"}","ig"),"${"+cg[1]+"}");}cc=bt.get(b$,ca);return b_.setAttribute(cc,(((bB.Curried3(bz.fold))(cd))(b_.getAttribute(cc)))(b8));}());});}function bY(b7,b8){var b9,b_,b$,ca,cb;bV(b8);b9=b8.nodeName.toLowerCase();b_=b7.querySelector("[ws-attr="+b9+"]");if(bC.Equals(b_,null))return bD.warn("Filling non-existent attr hole",b9);else{b_.removeAttribute("ws-attr");for(b$=0,ca=b8.attributes.length-1;b$<=ca;b$++){cb=b8.attributes.item(b$);cb.name==="class"&&b_.hasAttribute("class")?b_.setAttribute("class",b_.getAttribute("class")+" "+cb.nodeValue):b_.setAttribute(cb.name,cb.nodeValue);}return;}}function bZ(b7,b8){function b9(b_){r.IterSelector(b7,"["+b_+"]",function(b$){if(!b8.Contains(b$.getAttribute(b_)))b$.removeAttribute(b_);});}b9("ws-attr");b9("ws-onafterrender");b9("ws-var");r.IterSelector(b7,"[ws-hole]",function(b_){if(!b8.Contains(b_.getAttribute("ws-hole"))){b_.removeAttribute("ws-hole");while(b_.hasChildNodes())b_.removeChild(b_.lastChild);}});r.IterSelector(b7,"[ws-replace]",function(b_){if(!b8.Contains(b_.getAttribute("ws-replace")))b_.parentNode.removeChild(b_);});r.IterSelector(b7,"[ws-on]",function(b_){b_.setAttribute("ws-on",bv.concat(" ",bt.filter(function(b$){return b8.Contains(bt.get(bv.SplitChars(b$,[":"],1),1));},bv.SplitChars(b_.getAttribute("ws-on"),[" "],1))));});return r.IterSelector(b7,"[ws-attr-holes]",function(b_){var b$,ca,cb,cc,cd;b$=bv.SplitChars(b_.getAttribute("ws-attr-holes"),[" "],1);for(ca=0,cb=b$.length-1;ca<=cb;ca++){cc=bt.get(b$,ca);b_.setAttribute(cc,(cd=new a.RegExp(_9.TextHoleRE(),"g"),b_.getAttribute(cc).replace(cd,function(ce,cf){return b8.Contains(cf)?ce:"";})));}});}function b0(b7,b8){var b9;b9=b7.querySelector("[ws-replace]");return bC.Equals(b9,null)?(bD.warn("Filling non-existent text hole",bR),null):(b9.parentNode.replaceChild(new a.Text(b8),b9),{$:1,$0:b9.getAttribute("ws-replace")});}function b1(b7,b8,b9){while(true)if(b7.hasChildNodes())b9=b8.insertBefore(b7.lastChild,b9);else return null;}function b2(b7,b8,b9){var b_,b$,ca,cb,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy;function cc(cz){}while(true)switch(b7){case 0:cd=bP.string(b8.nodeName,{$:1,$0:3},null).toLowerCase();ce=(b_=cd.indexOf("."),b_===-1?[bQ,cd]:[bP.string(cd,null,{$:1,$0:b_-1}),bP.string(cd,{$:1,$0:b_+1},null)]);cf=ce[1];cg=ce[0];if(!_9.LoadedTemplates().ContainsKey(cg))return bD.warn("Instantiating non-loaded template",cf);else{ch=_9.LoadedTemplates().get_Item(cg);if(!ch.ContainsKey(cf))return bD.warn("Instantiating non-loaded template",cf);else{ci=ch.get_Item(cf);cj=ci.cloneNode(true);ck=new by.New$3();cl=new bK.New$5();cm=b8.attributes;for(cn=0,co=cm.length-1;cn<=co;cn++){cp=cm.item(cn).name.toLowerCase();cl.set_Item(cp,(cq=cm.item(cn).nodeValue,cq===""?cp:cq.toLowerCase()));!ck.Add(cp)?bD.warn("Hole mapped twice",cp):void 0;}for(cr=0,cs=b8.childNodes.length-1;cr<=cs;cr++){ct=b8.childNodes[cr];bC.Equals(ct.nodeType,bN.ELEMENT_NODE)?!ck.Add(ct.nodeName.toLowerCase())?bD.warn("Hole filled twice",cf):void 0:void 0;}cu=b8.childNodes.length===1&&bC.Equals(b8.firstChild.nodeType,bN.TEXT_NODE);if(cu){ca=b0(cj,b8.firstChild.textContent);((function(cz){return function(cA){if(cA!=null)cz(cA.$0);};}((cb=function(cz){return function(cA){return cz.Add(cA);};}(ck),function(cz){return cc(cb(cz));})))(ca));}bZ(cj,ck);if(!cu){for(cv=0,cw=b8.childNodes.length-1;cv<=cw;cv++){cx=b8.childNodes[cv];bC.Equals(cx.nodeType,bN.ELEMENT_NODE)?cx.hasAttributes()?bY(cj,cx):b3(cj,cx):void 0;}}bX(cj,cl);(((function(cz){function cA(cB,cC){return b1(cz,cB,cC);}return function(cB){return function(cC){return cA(cB,cC);};};}(cj))(b8.parentNode))(b8));b8.parentNode.removeChild(b8);return;}}break;case 1:if(b9!==null){cy=b9.nextSibling;if(bC.Equals(b9.nodeType,bN.TEXT_NODE))bW(b9);else if(bC.Equals(b9.nodeType,bN.ELEMENT_NODE))b5(b9);b9=cy;}else return null;break;}}function b3(b7,b8){var b9,b$,ca;function b_(cb,cc){var cd,ce,cf;if(b$==="title"&&b8.hasChildNodes()){cd=bO.parseHTML(b8.textContent);b8.removeChild(b8.firstChild);for(ce=0,cf=cd.length-1;ce<=cf;ce++)b8.appendChild(bt.get(cd,ce));}else null;b5(b8);return b1(b8,cb,cc);}b$=b8.nodeName.toLowerCase();r.IterSelector(b7,"[ws-attr-holes]",function(cb){var cc,cd,ce,cf,cg;cc=bv.SplitChars(cb.getAttribute("ws-attr-holes"),[" "],1);for(cd=0,ce=cc.length-1;cd<=ce;cd++){cf=bt.get(cc,cd);cb.setAttribute(cf,(cg=new a.RegExp("\\${"+b$+"}","ig"),cb.getAttribute(cf).replace(cg,b8.textContent)));}});ca=b7.querySelector("[ws-hole="+b$+"]");if(bC.Equals(ca,null)){b9=b7.querySelector("[ws-replace="+b$+"]");return bC.Equals(b9,null)?null:(b_(b9.parentNode,b9),void b9.parentNode.removeChild(b9));}else{while(ca.hasChildNodes())ca.removeChild(ca.lastChild);ca.removeAttribute("ws-hole");return b_(ca,null);}}function b4(b7){return b2(0,b7);}function b5(b7){var b8,b9;if(bv.StartsWith(b7.nodeName.toLowerCase(),"ws-")&&!b7.hasAttribute("ws-template"))b4(b7);else{bV(b7);b8=b7.getAttribute("ws-template");if(b8===null){b9=b7.getAttribute("ws-children-template");if(b9===null)b6(b7,b7.firstChild);else{b7.removeAttribute("ws-children-template");_.PrepareTemplate(bQ,{$:1,$0:b9},function(){return r.ChildrenArray(b7);});while(b7.hasChildNodes())b7.removeChild(b7.lastChild);}}else _.PrepareSingleTemplate(bQ,{$:1,$0:b8},b7);}}function b6(b7,b8){return b2(1,b7,b8);}bT=_.FakeRoot(bS);bU=(bR==null?"":bR.$0).toLowerCase();_9.LoadedTemplateFile(bQ).set_Item(bU,bT);bt.length(bS)>0?b6(bT,bt.get(bS,0)):void 0;};_.ComposeName=function(bQ,bR){return(bQ+"/"+(bR==null?"":bR.$0)).toLowerCase();};_.PrepareSingleTemplate=function(bQ,bR,bS){var bT,bU,bV;bS.removeAttribute("ws-template");bT=bS.getAttribute("ws-replace");bT===null?void 0:(bS.removeAttribute("ws-replace"),bU=bS.parentNode,bC.Equals(bU,null)?void 0:(bV=self.document.createElement(bS.tagName),bV.setAttribute("ws-replace",bT),bU.replaceChild(bV,bS)));_.PrepareTemplateStrict(bQ,bR,[bS]);};_.FakeRoot=function(bQ){var bR,bS,bT;bR=self.document.createElement("div");for(bS=0,bT=bQ.length-1;bS<=bT;bS++)bR.appendChild(bt.get(bQ,bS));return bR;};_.ChildrenTemplate=function(bQ,bR){var bS,bT,bU,bV,bW,bZ,b0,b1,b2,b3,b4,b5;function bX(b6,b7){var b8,b9,b_;b8=_0.Insert(b6,b7);b0.push(_0.Updates(b8));b1.push([b6,b8]);b9=bB.GetOptional(b8.OnAfterRender);return b9==null?null:(b_=b9.$0,void b2.push(function(){b_(b6);}));}function bY(b6){var b7,b8;b7=(b8=null,[b3.TryGetValue(b6,{get:function(){return b8;},set:function(b9){b8=b9;}}),b8]);return b7[0]?b7[1].$==0?{$:1,$0:b7[1].$1}:b7[1].$==1?{$:1,$0:_.TextNode(b7[1].$1)}:b7[1].$==2?{$:1,$0:_.TextView(b7[1].$1)}:b7[1].$==6?{$:1,$0:_.TextView(b7[1].$1.RView())}:b7[1].$==7?{$:1,$0:_.TextView(z.Map(a.String,b7[1].$1.RView()))}:b7[1].$==8?{$:1,$0:_.TextView(z.Map(function(b9){return b9.get_Input();},b7[1].$1.RView()))}:b7[1].$==9?{$:1,$0:_.TextView(z.Map(a.String,b7[1].$1.RView()))}:b7[1].$==10?{$:1,$0:_.TextView(z.Map(function(b9){return b9.get_Input();},b7[1].$1.RView()))}:b7[1].$==11?{$:1,$0:_.TextView(z.Map(a.String,b7[1].$1.RView()))}:(bD.warn("Content hole filled with attribute data",b6),null):null;}bZ=[];b0=[];b1=[];b2=[];b3=new bK.New$5();b4=bu.Get(bR);try{while(b4.MoveNext()){b5=b4.Current();b3.set_Item(b5.$0,b5);}}finally{if(typeof b4=="object"&&"Dispose"in b4)b4.Dispose();}bS=r.ChildrenArray(bQ);r.IterSelector(bQ,"[ws-hole]",function(b6){var b7,b8,b9;b9=b6.getAttribute("ws-hole");b6.removeAttribute("ws-hole");while(b6.hasChildNodes())b6.removeChild(b6.lastChild);b7=bY(b9);b7!=null&&b7.$==1?(b8=b7.$0,_9.LinkElement(b6,b8.docNode),bZ.push(_4.New(_0.Empty(b6),b8.docNode,null,b6,h.Int(),null)),b0.push(b8.updates)):void 0;});r.IterSelector(bQ,"[ws-replace]",function(b6){var b7,b8,b9,b_,b$,ca;b7=bY(b6.getAttribute("ws-replace"));b7!=null&&b7.$==1?(b8=b7.$0,b9=b6.parentNode,b_=self.document.createTextNode(""),b9.replaceChild(b_,b6),b$=_9.InsertBeforeDelim(b_,b8.docNode),ca=bt.tryFindIndex(function(cb){return b6===cb;},bS),ca==null?void 0:bt.set(bS,ca.$0,b8.docNode),bZ.push(_4.New(_0.Empty(b9),b8.docNode,{$:1,$0:[b$,b_]},b9,h.Int(),null)),b0.push(b8.updates)):void 0;});r.IterSelector(bQ,"[ws-attr]",function(b6){var b7,b8,b9;b7=b6.getAttribute("ws-attr");b6.removeAttribute("ws-attr");b8=(b9=null,[b3.TryGetValue(b7,{get:function(){return b9;},set:function(b_){b9=b_;}}),b9]);b8[0]?b8[1].$==3?bX(b6,b8[1].$1):bD.warn("Attribute hole filled with non-attribute data",b7):void 0;});r.IterSelector(bQ,"[ws-on]",function(b6){bX(b6,W.Concat(bt.choose(function(b7){var b8,b9,b_;b8=bv.SplitChars(b7,[":"],1);b9=(b_=null,[b3.TryGetValue(bt.get(b8,1),{get:function(){return b_;},set:function(b$){b_=b$;}}),b_]);return b9[0]?b9[1].$==4?{$:1,$0:_2.Handler(bt.get(b8,0),b9[1].$1)}:(bD.warn("Event hole on"+bt.get(b8,0)+" filled with non-event data",bt.get(b8,1)),null):null;},bv.SplitChars(b6.getAttribute("ws-on"),[" "],1))));b6.removeAttribute("ws-on");});r.IterSelector(bQ,"[ws-onafterrender]",function(b6){var b7,b8,b9;b7=b6.getAttribute("ws-onafterrender");b8=(b9=null,[b3.TryGetValue(b7,{get:function(){return b9;},set:function(b_){b9=b_;}}),b9]);b8[0]?b8[1].$==5?(b6.removeAttribute("ws-onafterrender"),bX(b6,_2.OnAfterRender(b8[1].$1))):bD.warn("onafterrender hole filled with non-onafterrender data",b7):void 0;});r.IterSelector(bQ,"[ws-var]",function(b6){var b7,b8,b9;b7=b6.getAttribute("ws-var");b6.removeAttribute("ws-var");b8=(b9=null,[b3.TryGetValue(b7,{get:function(){return b9;},set:function(b_){b9=b_;}}),b9]);b8[0]?b8[1].$==6?bX(b6,_2.Value(b8[1].$1)):b8[1].$==7?bX(b6,_2.Checked(b8[1].$1)):b8[1].$==8?bX(b6,_2.IntValue(b8[1].$1)):b8[1].$==9?bX(b6,_2.IntValueUnchecked(b8[1].$1)):b8[1].$==10?bX(b6,_2.FloatValue(b8[1].$1)):b8[1].$==11?bX(b6,_2.FloatValueUnchecked(b8[1].$1)):bD.warn("Var hole filled with non-Var data",b7):void 0;});r.IterSelector(bQ,"[ws-attr-holes]",function(b6){var b7,b8,b9,b_;b7=new a.RegExp(_9.TextHoleRE(),"g");b8=bv.SplitChars(b6.getAttribute("ws-attr-holes"),[" "],1);b6.removeAttribute("ws-attr-holes");for(b9=0,b_=b8.length-1;b9<=b_;b9++)(function(){var b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl;ci=bt.get(b8,b9);cj=b6.getAttribute(ci);b$=null;ca=0;ck=[];while(b$=b7.exec(cj),b$!==null){cl=bP.string(cj,{$:1,$0:ca},{$:1,$0:b7.lastIndex-bt.get(b$,0).length-1});ca=b7.lastIndex;ck.push([cl,bt.get(b$,1)]);}cc=bP.string(cj,{$:1,$0:ca},null);b7.lastIndex=0;cd=bt.foldBack(function(cm,cn){return(function(co){var cp,cq;cp=co[0];cq=co[1];return function(cr){var cs,ct,cu,cv,cw;cs=cr[0];ct=cr[1];cu=(cv=(cw=null,[b3.TryGetValue(cq,{get:function(){return cw;},set:function(cx){cw=cx;}}),cw]),cv[0]?cv[1].$==1?{$:0,$0:cv[1].$1}:cv[1].$==2?{$:1,$0:cv[1].$1}:cv[1].$==6?{$:1,$0:cv[1].$1.RView()}:cv[1].$==7?{$:1,$0:z.Map(a.String,cv[1].$1.RView())}:cv[1].$==8?{$:1,$0:z.Map(function(cx){return cx.get_Input();},cv[1].$1.RView())}:cv[1].$==9?{$:1,$0:z.Map(a.String,cv[1].$1.RView())}:cv[1].$==10?{$:1,$0:z.Map(function(cx){return cx.get_Input();},cv[1].$1.RView())}:cv[1].$==11?{$:1,$0:z.Map(a.String,cv[1].$1.RView())}:(bD.warn("Attribute value hole filled with non-text data",cq),{$:0,$0:""}):{$:0,$0:""});return cu.$==1?[cp,new bs.T({$:1,$0:cs===""?cu.$0:z.Map(function(cx){return cx+cs;},cu.$0),$1:ct})]:[cp+cu.$0+cs,ct];};}(cm))(cn);},ck,[cc,bs.T.Empty]);return bX(b6,cd[1].$==1?cd[1].$1.$==1?cd[1].$1.$1.$==1?cd[1].$1.$1.$1.$==0?(ce=cd[0],_2.Dynamic(ci,z.Map3(function(cm,cn,co){return ce+cm+cn+co;},cd[1].$0,cd[1].$1.$0,cd[1].$1.$1.$0))):(cf=cd[0],_2.Dynamic(ci,z.Map(function(cm){return cf+bv.concat("",cm);},z.Sequence(cd[1])))):(cg=cd[0],_2.Dynamic(ci,z.Map2(function(cm,cn){return cg+cm+cn;},cd[1].$0,cd[1].$1.$0))):cd[0]===""?_2.Dynamic(ci,cd[1].$0):(ch=cd[0],_2.Dynamic(ci,z.Map(function(cm){return ch+cm;},cd[1].$0))):W.Create(ci,cd[0]));}());});bT=bB.DeleteEmptyFields({Els:bS,Dirty:true,Holes:bZ,Attrs:b1,Render:(bU=b2.length==0?null:{$:1,$0:function(b6){bt.iter(function(b7){b7(b6);},b2);}},bU?bU.$0:void 0)},["Render"]);bV=e.TreeReduce(z.Const(),z.Map2Unit,b0);return!bC.Equals(bS,null)&&bS.length===1&&(bt.get(bS,0)instanceof bN&&(bC.Equals(bt.get(bS,0).nodeType,bN.ELEMENT_NODE)&&(bW=bt.get(bS,0),true)))?$.TreeNode(bT,bV):_.Mk({$:6,$0:bT},bV);};_.Template=function(bQ,bR){return _.ChildrenTemplate(_.FakeRoot(bQ),bR);};_.TextView=function(bQ){var bR;bR=_9.CreateTextNode();return _.Mk({$:4,$0:bR},z.Map(function(bS){_9.UpdateTextNode(bR,bS);},bQ));};_.RunReplaceById=function(bQ,bR){var bS;bS=r.Doc().getElementById(bQ);bC.Equals(bS,null)?bH.FailWith("invalid id: "+bQ):bR.ReplaceInDom(bS);};_.RunById=function(bQ,bR){var bS;bS=r.Doc().getElementById(bQ);bC.Equals(bS,null)?bH.FailWith("invalid id: "+bQ):_.Run(bS,bR);};_.Run=function(bQ,bR){var bS;_.LoadLocalTemplates$1();bS=bR.docNode;_9.LinkElement(bQ,bS);z.Sink(n.StartProcessor(_9.PerformAnimatedUpdate(_9.CreateRunState(bQ,bS),bS)),bR.updates);};_.RunPrependById=function(bQ,bR){var bS;bS=r.Doc().getElementById(bQ);bC.Equals(bS,null)?bH.FailWith("invalid id: "+bQ):_.RunPrepend(bS,bR);};_.RunPrepend=function(bQ,bR){var bS;bS=self.document.createTextNode("");bQ.insertBefore(bS,bQ.firstChild);_.RunBefore(bS,bR);};_.RunAppendById=function(bQ,bR){var bS;bS=r.Doc().getElementById(bQ);bC.Equals(bS,null)?bH.FailWith("invalid id: "+bQ):_.RunAppend(bS,bR);};_.RunAppend=function(bQ,bR){var bS;bS=self.document.createTextNode("");bQ.appendChild(bS);_.RunBefore(bS,bR);};_.RunAfterById=function(bQ,bR){var bS;bS=r.Doc().getElementById(bQ);bC.Equals(bS,null)?bH.FailWith("invalid id: "+bQ):_.RunAfter(bS,bR);};_.RunAfter=function(bQ,bR){var bS;bS=self.document.createTextNode("");bQ.parentNode.insertBefore(bS,bQ.nextSibling);_.RunBetween(bQ,bS,bR);};_.RunBeforeById=function(bQ,bR){var bS;bS=r.Doc().getElementById(bQ);bC.Equals(bS,null)?bH.FailWith("invalid id: "+bQ):_.RunBefore(bS,bR);};_.RunBefore=function(bQ,bR){var bS;bS=self.document.createTextNode("");bQ.parentNode.insertBefore(bS,bQ);_.RunBetween(bS,bQ,bR);};_.RunBetween=function(bQ,bR,bS){_9.LinkPrevElement(bR,bS.docNode);z.Sink(n.StartProcessor(_9.PerformAnimatedUpdate(_9.CreateDelimitedRunState(bQ,bR,bS.docNode),bS.docNode)),bS.updates);};_.Async=function(bQ){return _.EmbedView(z.MapAsync(a.id,z.Const(bQ)));};_.BindView=function(bQ,bR){return _.EmbedView(z.Map(bQ,bR));};_.EmbedView=function(bQ){var bR;bR=_9.CreateEmbedNode();return _.Mk({$:2,$0:bR},z.Map(a.ignore,z.Bind(function(bS){_9.UpdateEmbedNode(bR,bS.docNode);return bS.updates;},bQ)));};_.Static=function(bQ){return $.New(bQ,_0.EmptyAttr(),_.Empty());};_.Mk=function(bQ,bR){return new _.New(bQ,bR);};_.New=bB.Ctor(function(bQ,bR){k.New.call(this);this.docNode=bQ;this.updates=bR;},_);$=d.Elt=bB.Class({AddClass:function(bQ){return this.elt.className+=" "+bQ;},SetStyle:function(bQ,bR){this.elt.style[bQ]=bR;},HasClass:function(bQ){return(new a.RegExp("(\\s|^)"+bQ+"(\\s|$)")).test(this.elt.className);},RemoveClass:function(bQ){this.elt.className=this.elt.className.replace(new a.RegExp("(?:(\\s|^)"+bQ+")+(\\s|$)","g"),"$1");},GetProperty:function(bQ){return this.elt[bQ];},SetProperty:function(bQ,bR){this.elt[bQ]=bR;},RemoveAttribute:function(bQ){this.elt.removeAttribute(bQ);},HasAttribute:function(bQ){return this.elt.hasAttribute(bQ);},GetAttribute:function(bQ){return this.elt.getAttribute(bQ);},SetAttribute:function(bQ,bR){this.elt.setAttribute(bQ,bR);},SetText:function(bQ){var bR;bR=this.docNode$1;bR!=null&&bR.$==1?bR.$0.Children=null:bR!=null&&bR.$==6?(bR.$0.Els=[],this.ClearHoles()):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(z.Const());this.elt.textContent=bQ;},GetText:function(){return this.elt.textContent;},SetValue:function(bQ){this.elt.value=bQ;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var bQ;bQ=this.docNode$1;bQ!=null&&bQ.$==1?bQ.$0.Children=null:bQ!=null&&bQ.$==6?(bQ.$0.Els=[],this.ClearHoles()):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(z.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(bQ){var bR,bS,bT,bU,bV;bR=this.docNode$1;bR!=null&&bR.$==1?(bS=bR.$0,bS.Children={$:0,$0:bQ.docNode,$1:bS.Children},_9.InsertDoc(this.elt,bQ.docNode,(bT=this.elt.firstChild,bC.Equals(bT,null)?null:bT))):bR!=null&&bR.$==6?(bU=this.elt.insertBefore(self.document.createTextNode(""),this.elt.firstChild),bV=_9.InsertBeforeDelim(bU,bQ.docNode),this.AddHole(_4.New(_0.Empty(this.elt),bQ.docNode,{$:1,$0:[bV,bU]},this.elt,h.Int(),null))):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(z.Map2Unit(this.rvUpdates.c,bQ.updates));},Append:function(bQ){var bR,bS,bT,bU;bR=this.docNode$1;bR!=null&&bR.$==1?(bS=bR.$0,bS.Children={$:0,$0:bS.Children,$1:bQ.docNode},_9.InsertDoc(this.elt,bQ.docNode,null)):bR!=null&&bR.$==6?(bT=this.elt.appendChild(self.document.createTextNode("")),bU=_9.InsertBeforeDelim(bT,bQ.docNode),this.AddHole(_4.New(_0.Empty(this.elt),bQ.docNode,{$:1,$0:[bU,bT]},this.elt,h.Int(),null))):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(z.Map2Unit(this.rvUpdates.c,bQ.updates));},ToUpdater:function(){var bQ,bR;return new ba.New((bQ=this.docNode$1,bQ!=null&&bQ.$==1?bB.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,bQ.$0.Attr]],Render:(bR=null,bR?bR.$0:void 0)},["Render"]):bQ!=null&&bQ.$==6?bQ.$0:bH.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,x.Create$1([]));},OnAfterRenderView:function(bQ,bR){var bS,bT;bS=this;bT=h.Id();this.Append(_.BindView(function(bU){bS.elt[bT]=bU;return _.Empty();},bQ));return this.OnAfterRender(function(bU){bR(bU,bU[bT]);});},OnAfterRender:function(bQ){var bR,bS,bT,bU,bV,bW,bX;bR=this.docNode$1;bR!=null&&bR.$==1?(bS=bR.$0,bB.SetOptional(bS,"Render",(bT=bB.GetOptional(bS.Render),bT!=null&&bT.$==1?(bU=bT.$0,{$:1,$0:function(bY){bU(bY);bQ(bY);}}):{$:1,$0:bQ}))):bR!=null&&bR.$==6?(bV=bR.$0,bB.SetOptional(bV,"Render",(bW=bB.GetOptional(bV.Render),bW!=null&&bW.$==1?(bX=bW.$0,{$:1,$0:function(bY){bX(bY);bQ(bY);}}):{$:1,$0:bQ}))):bH.FailWith("Invalid docNode in Elt");return this;},onView:function(bQ,bR,bS){var bT;bT=bS(this.elt);this.elt.addEventListener(bQ,function(bU){return z.Get(bT(bU),bR);},false);return this;},on:function(bQ,bR){this.elt.addEventListener(bQ,function(bS){return bR(bS.target,bS);},false);return this;},ClearHoles:function(){var bQ;bQ=this.docNode$1;bQ!=null&&bQ.$==6?bQ.$0.Holes=[]:void 0;},AddHole:function(bQ){var bR;bR=this.docNode$1;bR!=null&&bR.$==6?bR.$0.Holes.push(bQ):void 0;}},_,$);$.TreeNode=function(bQ,bR){var bS,bT;function bU(bV){return bV[1];}bS=y.Create(bR);return new $.New$1({$:6,$0:bQ},z.Map2Unit((bT=bt.map(function(bV){return _0.Updates(bU(bV));},bQ.Attrs),e.TreeReduce(z.Const(),z.Map2Unit,bT)),bS.v),bt.get(bQ.Els,0),bS);};$.New=function(bQ,bR,bS){var bT,bU;bT=_9.CreateElemNode(bQ,bR,bS.docNode);bU=y.Create(bS.updates);return new $.New$1({$:1,$0:bT},z.Map2Unit(_0.Updates(bT.Attr),bU.v),bQ,bU);};$.New$1=bB.Ctor(function(bQ,bR,bS,bT){_.New.call(this,bQ,bR);this.docNode$1=bQ;this.updates$1=bR;this.elt=bS;this.rvUpdates=bT;},$);ba=X.EltUpdater=bB.Class({ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];x.Set(this.holeUpdates,[]);},AddHole:function(bQ){this.origHoles.push(bQ);this.treeNode.Holes=this.treeNode.Holes.concat([bQ]);},RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;x.Set(this.holeUpdates,[]);},RemoveUpdated:function(bQ){var bR,bS;function bT(bU){return bU!==bS;}bR=bQ.docNode;bR!=null&&bR.$==1?(bS=bR.$0.ElKey,this.treeNode.Holes=bt.filter(function(bU){return bU.ElKey!==bS;},this.treeNode.Holes),x.Set(this.holeUpdates,bt.filter(function(bU){return bT(bU[0]);},this.holeUpdates.c))):bH.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(bQ){var bR,bS,bT;bR=bQ.docNode;bR!=null&&bR.$==1?(bS=bR.$0,this.treeNode.Holes=this.treeNode.Holes.concat([bS]),bT=this.holeUpdates.c,bT.push([bS.ElKey,bQ.updates]),x.Set(this.holeUpdates,bT)):bH.FailWith("DocUpdater.AddUpdated expects a single element node");}},$,ba);ba.New=bB.Ctor(function(bQ,bR,bS,bT,bU){var bV,bW,bX;function bY(bZ){return bZ[1];}$.New$1.call(this,{$:6,$0:bQ},z.Map2Unit(bR,z.BindInner((bV=function(bZ){return bt.map(bY,bZ);},(bW=(bX=z.Const(),function(bZ){return e.TreeReduce(bX,z.Map2Unit,bZ);}),function(bZ){return bW(bV(bZ));})),bU.v)),bS,bT);this.treeNode=bQ;this.holeUpdates=bU;this.origHoles=this.treeNode.Holes;},ba);bb.$cctor=function(){bb.$cctor=a.ignore;bb.LoadedTemplates=new bK.New$5();bb.LocalTemplatesLoaded=false;bb.TextHoleRE="\\${([^}]+)}";};bc=d.Flow=bB.Class({get_Render:function(){return this.render;}},k,bc);bc.New=bB.Ctor(function(bQ){bc.New$1.call(this,function(bR){return function(bS){return x.Set(bR,bQ(bS));};});},bc);bc.New$1=bB.Ctor(function(bQ){k.New.call(this);this.render=bQ;},bc);bc.get_Do=function(){return new bd.New();};bc.Static=function(bQ){return new bc.New$1(function(bR){return function(bS){x.Set(bR,bQ);return bS();};});};bc.Define=function(bQ){return new bc.New(function(bR){return bQ(function(bS){bR(bS);});});};bc.Embed=function(bQ){var bR;bR=x.Create$1(_.Empty());((bQ.get_Render())(bR))(a.ignore);return _.EmbedView(bR.v);};bc.Return=function(bQ){return new bc.New$1(function(){return function(bR){return bR(bQ);};});};bc.Bind=function(bQ,bR){return new bc.New$1(function(bS){return function(bT){return((bQ.get_Render())(bS))(function(bU){((bR(bU).get_Render())(bS))(bT);});};});};bc.Map=function(bQ,bR){return new bc.New$1(function(bS){return function(bT){return((bR.get_Render())(bS))(function(bU){bT(bQ(bU));});};});};bd=d.FlowBuilder=bB.Class({ReturnFrom:a.id,Return:function(bQ){return bc.Return(bQ);},Bind:function(bQ,bR){return bc.Bind(bQ,bR);}},k,bd);bd.New=bB.Ctor(function(){k.New.call(this);},bd);bf=be.attr=bB.Class({},k,bf);bf.New=bB.Ctor(function(){k.New.call(this);},bf);bg.Append=function(bQ,bR){return{$:0,$0:p.Append(bQ.$0,bR.$0),$1:bF.FoldBack(function(bS,bT,bU){return bU.Add(bS,bT);},bQ.$1,bR.$1)};};bg.FromList=function(bQ,bR){return{$:0,$0:p.FromArray(bt.ofList(bQ)),$1:bR};};bg.ToList=function(bQ){return[bs.ofArray(p.ToArray(bQ.$0)),bQ.$1];};bg.SameHash=function(bQ,bR){return bg.NoHash(bQ)===bg.NoHash(bR);};bg.MakeHash=function(bQ){var bR,bS;bR=bQ.$1;bS=bv.concat("/",bt.map(function(bT){return a.encodeURIComponent(bT);},p.ToArray(bQ.$0)));return bR.get_IsEmpty()?bS:bS+"?"+bv.concat("&",bz.map(function(bT){var bU;bU=bH.KeyValue(bT);return a.encodeURIComponent(bU[0])+"="+a.encodeURIComponent(bU[1]);},bR));};bg.ParseHash=function(bQ){var bR,bS,bT,bU;bR=bg.NoHash(bQ);bS=(bT=bR.indexOf("?"),bT===-1?[bR,""]:[bP.string(bR,null,{$:1,$0:bT-1}),bP.string(bR,{$:1,$0:bT+1},null)]);bU=bS[0];return{$:0,$0:p.FromArray(bU===""?[]:bt.map(function(bV){return a.decodeURIComponent(bV);},bv.SplitChars(bU,["/"],0))),$1:bF.OfArray(bt.map(function(bV){var bW;bW=bV.indexOf("=");return bW===-1?[a.decodeURIComponent(bV),""]:[a.decodeURIComponent(bP.string(bV,null,{$:1,$0:bW-1})),a.decodeURIComponent(bP.string(bV,{$:1,$0:bW+1},null))];},bv.SplitChars(bS[1],["&"],0)))};};bg.NoHash=function(bQ){return bv.StartsWith(bQ,"#")?bQ.substring(1):bQ;};bi.New=function(bQ,bR,bS,bT){return{Bodies:bQ,CurrentRoute:bR,CurrentSite:bS,Selection:bT};};bh.Install=function(bQ,bR){var bS,bT,bU,bV,bW,bX,bY;function bZ(b2,b3){var b4;b4=b3.$0;return b3.$1({UpdateRoute:function(b5){bh.OnInternalSiteUpdate(bU,b4,b2,b5);}});}function b0(b2){return t.Lookup(bV,(bg.ToList(b2))[0]);}function b1(b2){var b3;b3=b0(b2);b3.$==1?void 0:bh.OnGlobalRouteChange(bU,b3.$0,bg.FromList(b3.$1,new bG.New([])));}bS=bR.$0;bT=bh.InstallMap({Des:function(b2){return bg.FromList(b2[0],b2[1]);},Ser:bg.ToList});bU=bi.New(void 0,bT,0,void 0);bV=t.Map(function(b2){return function(b3){return bZ(b2,b3);};},bR.$1);bU.Bodies=bh.ComputeBodies(bV);bW=(bX=b0(bT.c),bX.$==0?(bY=bX.$0,(bU.CurrentSite=bY.RouteId,x.Create$1(bY.RouteValue))):x.Create$1(bS!=null&&bS.$==1?bS.$0:bH.FailWith("Site.Install fails on empty site")));bU.Selection=bW;z.Sink(function(b2){bh.OnSelectSite(bU,bQ(b2));},bW.v);b1(bT.c);z.Sink(b1,bT.v);return bW;};bh.OnSelectSite=function(bQ,bR){var bS;bS=bR.$0;bQ.CurrentSite!==bS?(bQ.CurrentSite=bS,bQ.Bodies.get_Item(bS).OnSelect()):void 0;};bh.OnInternalSiteUpdate=function(bQ,bR,bS,bT){if(bQ.CurrentSite===bR)bh.SetCurrentRoute(bQ,bg.Append(bg.FromList(bS,new bG.New([])),bT));};bh.OnGlobalRouteChange=function(bQ,bR,bS){bQ.CurrentSite!==bR.RouteId?(bQ.CurrentSite=bR.RouteId,x.Set(bQ.Selection,bR.RouteValue)):void 0;bR.OnRouteChanged(bS);};bh.SetCurrentRoute=function(bQ,bR){if(!bC.Equals(bQ.CurrentRoute.c,bR))x.Set(bQ.CurrentRoute,bR);};bh.ComputeBodies=function(bQ){var bR;bR=new bK.New$5();bt.iter(function(bS){bR.set_Item(bS.RouteId,bS);},t.ToArray(bQ));return bR;};bh.MergeRouters=function(bQ){var bR,bS,bT;bR=e.ofSeqNonCopying(bQ);bS=t.Merge(bz.map(function(bU){return bU.$1;},bR));bT=bz.tryPick(function(bU){return bU.$0;},bR);return bS!=null&&bS.$==1?{$:0,$0:bT,$1:bS.$0}:bH.FailWith("Invalid Site.Merge: need more prefix disambiguation");};bh.DefineRoute=function(bQ,bR,bS){var bT,bU,bV;bT=x.Create$1(bR);bU=h.Int();bV=bS({$:0,$0:bU},bT);return{$:0,$0:{$:1,$0:bV},$1:t.Leaf({$:0,$0:bU,$1:function(bW){z.Sink(function(bX){bW.UpdateRoute(bh.DoLink(bQ,bX));},bT.v);return{OnRouteChanged:function(bX){x.Set(bT,bh.DoRoute(bQ,bX));},OnSelect:function(){bW.UpdateRoute(bh.DoLink(bQ,bT.c));},RouteId:bU,RouteValue:bV};}})};};bh.DoLink=function(bQ,bR){var bS;bS=bQ.Ser(bR);return bg.FromList(bS[0],bS[1]);};bh.DoRoute=function(bQ,bR){return bQ.Des(bg.ToList(bR));};bh.InstallMap=function(bQ){var bR;function bS(bW,bX){return bC.Equals(bQ.Ser(bW),bQ.Ser(bX));}function bT(){return bQ.Des(bg.ToList(bg.ParseHash(self.location.hash)));}function bU(bW){if(!bS(bR.c,bW))x.Set(bR,bW);}function bV(bW){return bU(bT());}bR=x.Create$1(bT());self.onpopstate=bV;self.onhashchange=bV;z.Sink(function(bW){var bX,bY;bX=bg.MakeHash((bY=bQ.Ser(bW),bg.FromList(bY[0],bY[1])));!bg.SameHash(self.location.hash,bX)?self.location.replace("#"+bX):void 0;},bR.v);return bR;};bj.Install=function(bQ){return bh.InstallMap(bQ);};bj.Create=function(bQ,bR){function bS(bT){return bT[0];}return{Des:function(bT){return bR(bS(bT));},Ser:function(bT){return[bQ(bT),new bG.New([])];}};};bj.CreateWithQuery=function(bQ,bR){return{Des:bR,Ser:bQ};};bk.Route=function(bQ,bR,bS){return bh.DefineRoute(bQ,bR,bS);};bk.Prefix=function(bQ,bR){return{$:0,$0:bR.$0,$1:t.Prefix(bQ,bR.$1)};};bk.Merge=function(bQ){return bh.MergeRouters(bQ);};bk.Install=function(bQ,bR){return bh.Install(bQ,bR);};bk.Dir=function(bQ,bR){return bk.Prefix(bQ,bk.Merge(bR));};bm.New=function(bQ,bR){return{Active:bQ,PosV:bR};};bn.New=function(bQ,bR,bS,bT){return{Active:bQ,Left:bR,Middle:bS,Right:bT};};bo.get_MousePressed=function(){bl.ActivateButtonListener();return z.Apply(z.Apply(z.Apply(z.Const(bB.Curried3(function(bQ,bR,bS){return bQ||bR||bS;})),bl.MouseBtnSt$1().Left.v),bl.MouseBtnSt$1().Middle.v),bl.MouseBtnSt$1().Right.v);};bo.get_RightPressed=function(){bl.ActivateButtonListener();return bl.MouseBtnSt$1().Right.v;};bo.get_MiddlePressed=function(){bl.ActivateButtonListener();return bl.MouseBtnSt$1().Middle.v;};bo.get_LeftPressed=function(){bl.ActivateButtonListener();return bl.MouseBtnSt$1().Left.v;};bo.get_Position=function(){!bl.MousePosSt$1().Active?(self.document.addEventListener("mousemove",function(bQ){x.Set(bl.MousePosSt$1().PosV,[bQ.clientX,bQ.clientY]);},false),bl.MousePosSt$1().Active=true):void 0;return bl.MousePosSt$1().PosV.v;};bp.New=function(bQ,bR,bS){return{KeysPressed:bQ,KeyListenerActive:bR,LastPressed:bS};};bq.IsPressed=function(bQ){function bR(bS){return bS===bQ;}bl.ActivateKeyListener();return z.Map(function(bS){return bs.exists(bR,bS);},bl.KeyListenerState().KeysPressed.v);};bq.get_LastPressed=function(){bl.ActivateKeyListener();return bl.KeyListenerState().LastPressed.v;};bq.get_KeysPressed=function(){bl.ActivateKeyListener();return bl.KeyListenerState().KeysPressed.v;};bl.ActivateKeyListener=function(){br.$cctor();return br.ActivateKeyListener;};bl.KeyListenerState=function(){br.$cctor();return br.KeyListenerState;};bl.ActivateButtonListener=function(){br.$cctor();return br.ActivateButtonListener;};bl.MouseBtnSt$1=function(){br.$cctor();return br.MouseBtnSt;};bl.MousePosSt$1=function(){br.$cctor();return br.MousePosSt;};br.$cctor=function(){br.$cctor=a.ignore;function bQ(bR,bS){var bT;bT=bR.button;return bT===0?x.Set(bl.MouseBtnSt$1().Left,bS):bT===1?x.Set(bl.MouseBtnSt$1().Middle,bS):bT===2?x.Set(bl.MouseBtnSt$1().Right,bS):null;}br.MousePosSt=bm.New(false,x.Create$1([0,0]));br.MouseBtnSt=bn.New(false,x.Create$1(false),x.Create$1(false),x.Create$1(false));br.ActivateButtonListener=!bl.MouseBtnSt$1().Active?(bl.MouseBtnSt$1().Active=true,self.document.addEventListener("mousedown",function(bR){return bQ(bR,true);},false),self.document.addEventListener("mouseup",function(bR){return bQ(bR,false);},false)):null;br.KeyListenerState=bp.New(x.Create$1(bs.T.Empty),false,x.Create$1(-1));br.ActivateKeyListener=!bl.KeyListenerState().KeyListenerActive?(bO(self.document).keydown(function(bR){var bS,bT;bS=bR.which;x.Set(bl.KeyListenerState().LastPressed,bS);bT=bl.KeyListenerState().KeysPressed.c;return!bs.exists(function(bU){return bU===bS;},bT)?x.Set(bl.KeyListenerState().KeysPressed,bs.append(bT,bs.ofArray([bS]))):null;}),void bO(self.document).keyup(function(bR){var bS;function bT(bU){return bU!==bS;}bS=bR.which;return x.Update(bl.KeyListenerState().KeysPressed,function(bU){return bs.filter(bT,bU);});})):null;};}());
